<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="The Bridge - Data visualization and analysis tool" />
  <title>The Bridge</title>
  <link rel="icon" type="image/png" href="LOGOTAB_rounded.png" />

<!-- ========================================
     SISTEMA DE DISEÑO - CARGA ORDENADA
     ========================================
     1. Variables CSS (PRIMERO - Base del sistema)
     2. Estilos base y componentes
     3. Estilos específicos de módulos
     4. Overrides y unificaciones (ÚLTIMO)
     ======================================== -->

<!-- 1. VARIABLES CSS - DEBE CARGARSE PRIMERO -->
<link rel="stylesheet" href="src/styles/00-design-system.css" />

<!-- 1.1. CLASES UTILITARIAS - PARA REEMPLAZAR ESTILOS INLINE -->
<link rel="stylesheet" href="src/styles/01-utility-classes.css" />

<!-- 2. ESTILOS BASE Y COMPONENTES -->
<link rel="stylesheet" href="src/styles/common.css" />
<link rel="stylesheet" href="src/styles/layout.css" />
<link rel="stylesheet" href="src/styles/sidebar-scroll.css" />
<link rel="stylesheet" href="src/styles/table.css" />
<link rel="stylesheet" href="src/styles/filters.css" />
<link rel="stylesheet" href="src/styles/filter-chips-new.css" />
<link rel="stylesheet" href="src/styles/saved-filters.css" />
<link rel="stylesheet" href="src/styles/columns.css" />
<link rel="stylesheet" href="src/styles/modals.css" />
<link rel="stylesheet" href="src/styles/customColumns.css" />
<link rel="stylesheet" href="src/styles/custom-columns.css" />
<link rel="stylesheet" href="src/styles/customSummary.css" />

<!-- 3. ESTILOS ESPECÍFICOS DE MÓDULOS -->
<link rel="stylesheet" href="src/styles/dashboard.css" />
<link rel="stylesheet" href="src/styles/dq-hub.css" />
<link rel="stylesheet" href="src/styles/ops-hub-manager.css" />
<link rel="stylesheet" href="src/styles/orders-hub.css" />
<link rel="stylesheet" href="src/styles/booking-hub.css" />
<link rel="stylesheet" href="src/styles/ops-hub.css" />
<link rel="stylesheet" href="src/styles/modals-glassmorphism.css" />
<link rel="stylesheet" href="src/styles/excel-dropdown-fix.css" />
<link rel="stylesheet" href="src/styles/dashboard-charts.css" />
<link rel="stylesheet" href="src/styles/analytics.css" />
<link rel="stylesheet" href="src/styles/dashboard-override.css" />

<!-- 4. OVERRIDES Y UNIFICACIONES - DEBEN CARGARSE AL FINAL -->
<link rel="stylesheet" href="src/styles/force-light-blue-theme.css" />
<link rel="stylesheet" href="src/styles/unified-color-palette.css" />
<link rel="stylesheet" href="src/styles/unified-scrollbars-buttons.css" />

<!-- 5. MASTER OVERRIDE - MÁXIMA PRIORIDAD - DEBE CARGARSE ÚLTIMO -->
<link rel="stylesheet" href="src/styles/99-master-override.css" />

<!-- FIX PARA DROPDOWNS DE EQUIPOS - Arregla la visibilidad de opciones -->
<style>
/* ==========================================================================
   FIX PARA DROPDOWNS DE EQUIPOS - Estilos de visibilidad mejorados
   ========================================================================== */

/* Estilos base para todos los selects de equipos - UNIFICADO CON PALETA */
select[id*="team"],
select[id*="Team"],
#teamLoginSelect,
#teamStorageLocationSelect,
.team-select,
.filter-select {
  /* Fondo y bordes - PALETA UNIFICADA */
  background: rgba(255, 255, 255, 0.7) !important;
  border: 1px solid rgba(0, 0, 0, 0.2) !important;
  border-radius: 8px !important;
  
  /* Texto - NEGRO */
  color: #000000 !important;
  font-size: 14px !important;
  font-weight: 500 !important;
  
  /* Espaciado */
  padding: 10px 12px !important;
  
  /* Efectos */
  transition: all 0.3s ease !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
}

/* Estados hover y focus - PALETA UNIFICADA */
select[id*="team"]:hover,
select[id*="Team"]:hover,
#teamLoginSelect:hover,
#teamStorageLocationSelect:hover,
.team-select:hover,
.filter-select:hover {
  border-color: rgba(0, 0, 0, 0.3) !important;
  background: rgba(255, 255, 255, 0.9) !important;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
}

select[id*="team"]:focus,
select[id*="Team"]:focus,
#teamLoginSelect:focus,
#teamStorageLocationSelect:focus,
.team-select:focus,
.filter-select:focus {
  outline: none !important;
  border-color: rgba(0, 0, 0, 0.3) !important;
  box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1) !important;
  background: rgba(255, 255, 255, 0.9) !important;
}

/* CRÍTICO: Estilos para las opciones del dropdown */
select[id*="team"] option,
select[id*="Team"] option,
#teamLoginSelect option,
#teamStorageLocationSelect option,
.team-select option,
.filter-select option {
  /* Fondo y texto de las opciones */
  background: #E3F2FD !important;
  background-color: #E3F2FD !important;
  color: #000000 !important;
  
  /* Espaciado */
  
/* ==========================================================================
   GUEST MODE STYLES - Hide team elements by default
   ========================================================================== */

/* Guest mode styles - hide team elements by default */
.guest-mode #teamInfo,
.guest-mode #teamManagementBtn,
.guest-mode #teamManagementBtn + .sidebar-separator {
  display: none !important;
  height: 0 !important;
  margin: 0 !important;
  padding: 0 !important;
  overflow: hidden !important;
  visibility: hidden !important;
  opacity: 0 !important;
  position: absolute !important;
  left: -9999px !important;
  top: -9999px !important;
}

/* Remove the empty space when teamInfo is hidden */
.guest-mode .sidebar-header {
  height: 0 !important;
  margin: 0 !important;
  padding: 0 !important;
  overflow: hidden !important;
  visibility: hidden !important;
  opacity: 0 !important;
  display: none !important;
}

/* Remove sheen effect from Save Configuration and Load Configuration buttons */
#saveConfigurationBtn,
#loadConfigurationBtn {
  background: #1976d2 !important;
  background-image: none !important;
  border: none !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2) !important;
}

#saveConfigurationBtn:hover,
#loadConfigurationBtn:hover {
  background: #1565c0 !important;
  background-image: none !important;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3) !important;
}

/* Duplicate removal search field styles */
.duplicate-columns-search {
  margin: 0.5rem 0;
}

.duplicate-columns-search .search-input {
  width: 100%;
  padding: 0.5rem 0.75rem;
  border: 1px solid rgba(0, 0, 0, 0.2);
  border-radius: 6px;
  background: rgba(255, 255, 255, 0.7);
  color: #000000;
  font-size: 0.9em;
  transition: all 0.3s ease;
}

.duplicate-columns-search .search-input::placeholder {
  color: rgba(0, 0, 0, 0.5);
}

.duplicate-columns-search .search-input:focus {
  outline: none;
  border-color: #47B2E5;
  background: rgba(255, 255, 255, 0.9);
  box-shadow: 0 0 0 2px rgba(71, 178, 229, 0.2);
}

/* Preferences section styles */
.preferences-section {
  border-right: 1px solid rgba(0, 0, 0, 0.1);
  padding-right: 1rem;
  margin-right: 1rem;
}

.preferences-section .modal-btn {
  background: rgba(255, 255, 255, 0.7) !important;
  border: 1px solid rgba(0, 0, 0, 0.2) !important;
  color: #000000 !important;
  transition: all 0.3s ease !important;
}

.preferences-section .modal-btn:hover {
  background: rgba(255, 255, 255, 0.9) !important;
  border-color: rgba(0, 0, 0, 0.3) !important;
  color: #000000 !important;
  transform: translateY(-1px) !important;
}

.footer-actions {
  display: flex !important;
  justify-content: space-between !important;
  align-items: center !important;
  width: 100% !important;
}

/* Modal visibility improvements */
.modal-overlay {
  backdrop-filter: blur(5px) !important;
}

.modal-panel {
  background: #E3F2FD !important;
  box-shadow: 0 20px 60px rgba(0,0,0,0.2) !important;
  border: 1px solid rgba(0,0,0,0.1) !important;
}

/* Preference modal specific styles */
#dqPreferencesModal .modal-panel,
#dqSavePreferencesModal .modal-panel {
  background: #E3F2FD !important;
  box-shadow: 0 25px 80px rgba(0,0,0,0.2) !important;
  border: 2px solid rgba(0,0,0,0.2) !important;
  opacity: 1 !important;
}

#dqPreferencesModal .modal-overlay,
#dqSavePreferencesModal .modal-overlay {
  background: rgba(0,0,0,0.3) !important;
  backdrop-filter: blur(8px) !important;
}

.preference-item {
  background: rgba(255,255,255,0.7) !important;
  border: 2px solid rgba(0,0,0,0.2) !important;
  opacity: 1 !important;
}

.preference-item:hover {
  background: rgba(255,255,255,0.9) !important;
  border-color: rgba(0,0,0,0.3) !important;
}

/* Force opacity on all modal elements */
#dqPreferencesModal *,
#dqSavePreferencesModal * {
  opacity: 1 !important;
}

#dqPreferencesModal .modal-content,
#dqSavePreferencesModal .modal-content {
  background: transparent !important;
}

#dqPreferencesModal .modal-header,
#dqSavePreferencesModal .modal-header {
  background: rgba(0,0,0,0.05) !important;
  border-bottom: 1px solid rgba(0,0,0,0.1) !important;
}

#dqPreferencesModal .modal-footer,
#dqSavePreferencesModal .modal-footer {
  background: rgba(0,0,0,0.05) !important;
  border-top: 1px solid rgba(0,0,0,0.1) !important;
}
  padding: 8px 12px !important;
  
  /* Efectos */
  border: none !important;
  margin: 0 !important;
}

/* Opción seleccionada */
select[id*="team"] option:checked,
select[id*="Team"] option:checked,
#teamLoginSelect option:checked,
#teamStorageLocationSelect option:checked,
.team-select option:checked,
.filter-select option:checked {
  background: #47B2E5 !important;
  background-color: #47B2E5 !important;
  color: #000000 !important;
}

/* Opción hover - PALETA UNIFICADA */
select[id*="team"] option:hover,
select[id*="Team"] option:hover,
#teamLoginSelect option:hover,
#teamStorageLocationSelect option:hover,
.team-select option:hover,
.filter-select option:hover {
  background: rgba(71, 178, 229, 0.2) !important;
  background-color: rgba(71, 178, 229, 0.2) !important;
  color: #000000 !important;
}

/* ==========================================================================
   BUSCADOR Y SELECTOR DE VISTAS - ESTILOS UNIFICADOS
   ========================================================================== */

/* Buscador global - Estados hover y focus */
#globalSearchInput:hover,
.search-input:hover {
  background: rgba(255, 255, 255, 0.9) !important;
  border-color: rgba(0, 0, 0, 0.3) !important;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
}

#globalSearchInput:focus,
.search-input:focus {
  outline: none !important;
  background: rgba(255, 255, 255, 0.9) !important;
  border-color: rgba(0, 0, 0, 0.3) !important;
  box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1) !important;
}

/* Opciones del selector de vistas */
#viewSelect option,
.toolbar-select option {
  background: #E3F2FD !important;
  background-color: #E3F2FD !important;
  color: #000000 !important;
  padding: 8px 12px !important;
}

#viewSelect option:checked,
.toolbar-select option:checked {
  background: rgba(71, 178, 229, 0.3) !important;
  background-color: rgba(71, 178, 229, 0.3) !important;
  color: #000000 !important;
}

/* Selector de semana y selector de vistas - Estados hover y focus unificados */
#dateTimeInfo:hover,
#viewSelect:hover,
.toolbar-select:hover {
  background: rgba(255, 255, 255, 0.9) !important;
  border-color: rgba(0, 0, 0, 0.3) !important;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
  color: #000000 !important;
}

#dateTimeInfo:active,
#dateTimeInfo:focus,
#viewSelect:focus,
.toolbar-select:focus {
  outline: none !important;
  background: rgba(255, 255, 255, 0.9) !important;
  border-color: rgba(0, 0, 0, 0.3) !important;
  box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1) !important;
  color: #000000 !important;
}

/* Asegurar que el texto y los iconos mantengan el color negro */
#dateTimeInfo:hover #weekNumberDisplay,
#dateTimeInfo:hover #calendarIcon,
#dateTimeInfo:hover #chevronIcon {
  color: #000000 !important;
}

#dateTimeInfo:hover #calendarIcon rect,
#dateTimeInfo:hover #calendarIcon path,
#dateTimeInfo:hover #chevronIcon path {
  stroke: #000000 !important;
}

/* ==========================================================================
   FORZAR MISMOS COLORES EN SELECTOR DE SEMANA Y SELECTOR DE VISTAS
   MÁXIMA PRIORIDAD - Sobrescribe todos los estilos
   ========================================================================== */
html body .toolbar .toolbar-right #dateTimeInfo,
html body .toolbar .toolbar-right #dateTimeInfo[style],
html body .toolbar .toolbar-right #viewSelect,
html body .toolbar .toolbar-right #viewSelect[style],
html body .toolbar .toolbar-right .view-controls select,
html body .toolbar .toolbar-right .view-controls select[style],
html body .toolbar .toolbar-right .toolbar-select,
html body .toolbar .toolbar-right .toolbar-select[style] {
  background: rgba(255, 255, 255, 0.7) !important;
  background-color: rgba(255, 255, 255, 0.7) !important;
  border: 1px solid rgba(0, 0, 0, 0.2) !important;
  border-color: rgba(0, 0, 0, 0.2) !important;
  color: #000000 !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
}

/* Estados hover - MÁXIMA PRIORIDAD */
html body .toolbar .toolbar-right #dateTimeInfo:hover,
html body .toolbar .toolbar-right #dateTimeInfo:hover[style],
html body .toolbar .toolbar-right #viewSelect:hover,
html body .toolbar .toolbar-right #viewSelect:hover[style],
html body .toolbar .toolbar-right .view-controls select:hover,
html body .toolbar .toolbar-right .view-controls select:hover[style],
html body .toolbar .toolbar-right .toolbar-select:hover,
html body .toolbar .toolbar-right .toolbar-select:hover[style] {
  background: rgba(255, 255, 255, 0.9) !important;
  background-color: rgba(255, 255, 255, 0.9) !important;
  border-color: rgba(0, 0, 0, 0.3) !important;
  color: #000000 !important;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
}

/* Estados focus/active - MÁXIMA PRIORIDAD */
html body .toolbar .toolbar-right #dateTimeInfo:focus,
html body .toolbar .toolbar-right #dateTimeInfo:active,
html body .toolbar .toolbar-right #dateTimeInfo:focus[style],
html body .toolbar .toolbar-right #dateTimeInfo:active[style],
html body .toolbar .toolbar-right #viewSelect:focus,
html body .toolbar .toolbar-right #viewSelect:focus[style],
html body .toolbar .toolbar-right .view-controls select:focus,
html body .toolbar .toolbar-right .view-controls select:focus[style],
html body .toolbar .toolbar-right .toolbar-select:focus,
html body .toolbar .toolbar-right .toolbar-select:focus[style] {
  background: rgba(255, 255, 255, 0.9) !important;
  background-color: rgba(255, 255, 255, 0.9) !important;
  border-color: rgba(0, 0, 0, 0.3) !important;
  color: #000000 !important;
  box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1) !important;
  outline: none !important;
}

/* ==========================================================================
   ESPACIADO UNIFORME ENTRE ELEMENTOS DE LA TOOLBAR
   ========================================================================== */
.toolbar .toolbar-right {
  gap: 1rem !important;
  display: flex !important;
  align-items: center !important;
}

.toolbar .toolbar-right > * {
  margin-left: 0 !important;
  margin-right: 0 !important;
}

/* Asegurar que los contenedores no añadan espacio extra */
.toolbar .toolbar-right #dateTimeInfo,
.toolbar .toolbar-right .search-container,
.toolbar .toolbar-right .view-controls {
  margin: 0 !important;
  margin-left: 0 !important;
  margin-right: 0 !important;
}

/* Eliminar márgenes específicos de los elementos - MÁXIMA PRIORIDAD */
html body .toolbar .toolbar-right .toolbar-select,
html body .toolbar .toolbar-right .toolbar-select[style] {
  margin-left: 0 !important;
  margin-right: 0 !important;
}

html body .toolbar .toolbar-right .search-container,
html body .toolbar .toolbar-right .search-container[style] {
  margin-left: 0 !important;
  margin-right: 0 !important;
}

html body .toolbar .toolbar-right .view-controls,
html body .toolbar .toolbar-right .view-controls[style] {
  margin-left: 0 !important;
  margin-right: 0 !important;
}

html body .toolbar .toolbar-right #dateTimeInfo,
html body .toolbar .toolbar-right #dateTimeInfo[style] {
  margin-left: 0 !important;
  margin-right: 0 !important;
}

/* Margen derecho para el selector de vistas para evitar que se corte */
html body .toolbar .toolbar-right .view-controls,
html body .toolbar .toolbar-right .view-controls[style] {
  margin-right: 1rem !important;
}

/* Opción desabilitada */
select[id*="team"] option:disabled,
select[id*="Team"] option:disabled,
#teamLoginSelect option:disabled,
#teamStorageLocationSelect option:disabled,
.team-select option:disabled,
.filter-select option:disabled {
  background: rgba(26, 35, 50, 0.5) !important;
  color: #7BA7CC !important;
  cursor: not-allowed !important;
}

/* Placeholder option (primera opción vacía) - PALETA UNIFICADA */
select[id*="team"] option[value=""],
select[id*="Team"] option[value=""],
#teamLoginSelect option[value=""],
#teamStorageLocationSelect option[value=""],
.team-select option[value=""],
.filter-select option[value=""] {
  background: rgba(255, 255, 255, 0.95) !important;
  color: #666666 !important;
  font-style: italic !important;
}

/* Flecha del dropdown personalizada */
select[id*="team"],
select[id*="Team"],
#teamLoginSelect,
#teamStorageLocationSelect,
.team-select,
.filter-select {
  /* Ocultar la flecha por defecto */
  -webkit-appearance: none !important;
  -moz-appearance: none !important;
  appearance: none !important;
  
  /* Agregar flecha personalizada */
  background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2347B2E5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e") !important;
  background-repeat: no-repeat !important;
  background-position: right 12px center !important;
  background-size: 16px !important;
  
  /* Espacio para la flecha */
  padding-right: 40px !important;
}

/* Firefox específico - PALETA UNIFICADA */
@-moz-document url-prefix() {
  select[id*="team"] option,
  select[id*="Team"] option,
  #teamLoginSelect option,
  #teamStorageLocationSelect option,
  .team-select option,
  .filter-select option {
    background: rgba(255, 255, 255, 0.95) !important;
    color: #000000 !important;
  }
}

/* Compatibilidad con Choices.js - PALETA UNIFICADA */
.choices[data-type*="select-one"] .choices__inner {
  background: rgba(255, 255, 255, 0.7) !important;
  border: 1px solid rgba(0, 0, 0, 0.2) !important;
  border-radius: 8px !important;
  color: #000000 !important;
  padding: 8px 12px !important;
}

.choices[data-type*="select-one"] .choices__list--dropdown .choices__item {
  background: rgba(255, 255, 255, 0.95) !important;
  color: #000000 !important;
  padding: 8px 12px !important;
}

.choices[data-type*="select-one"] .choices__list--dropdown .choices__item--selectable.is-highlighted {
  background: rgba(71, 178, 229, 0.2) !important;
  color: #000000 !important;
}
</style>

<!-- Estilos para CSV Comparison -->
<style> 
  /* Estilos mejorados para Choices.js en CSV Comparison Modal */
  #csvComparisonModal .choices {
    position: relative;
    width: 100%;
    margin-bottom: 0.5rem;
  }

  #csvComparisonModal .choices__inner {
    background: #ffffff !important;
    border: 2px solid #e0e7ef !important;
    border-radius: 8px !important;
    min-height: 50px !important;
    max-height: none !important;
    padding: 8px 12px !important;
    font-size: 0.95rem !important;
    color: #1a2332 !important;
    transition: all 0.2s ease !important;
    display: flex !important;
    flex-wrap: wrap !important;
    align-items: center !important;
    gap: 6px !important;
    overflow: visible !important;
  }

  /* Contenedor de items seleccionados - sin scroll */
  #csvComparisonModal .choices__list--multiple {
    display: flex !important;
    flex-wrap: wrap !important;
    gap: 6px !important;
    overflow: visible !important;
    max-height: none !important;
    height: auto !important;
  }

  #csvComparisonModal .choices__inner:hover {
    border-color: #47B2E5 !important;
    box-shadow: 0 0 0 3px rgba(71, 178, 229, 0.1) !important;
  }

  #csvComparisonModal .choices__inner.is-focused {
    border-color: #47B2E5 !important;
    box-shadow: 0 0 0 3px rgba(71, 178, 229, 0.2) !important;
    outline: none !important;
  }

  /* Items seleccionados (chips) */
  #csvComparisonModal .choices__item--selectable {
    background: #47B2E5 !important;
    color: #ffffff !important;
    border: none !important;
    border-radius: 6px !important;
    padding: 6px 10px 6px 12px !important;
    margin: 0 !important;
    font-size: 0.9rem !important;
    font-weight: 500 !important;
    display: inline-flex !important;
    align-items: center !important;
    gap: 6px !important;
    line-height: 1.4 !important;
    transition: all 0.2s ease !important;
  }

  #csvComparisonModal .choices__item--selectable:hover {
    background: #1976d2 !important;
    transform: translateY(-1px) !important;
    box-shadow: 0 2px 6px rgba(71, 178, 229, 0.3) !important;
  }

  /* Botón de eliminar (X) - mejorado */
  #csvComparisonModal .choices__button {
    background: rgba(255, 255, 255, 0.3) !important;
    border: none !important;
    border-radius: 50% !important;
    width: 18px !important;
    height: 18px !important;
    padding: 0 !important;
    margin: 0 !important;
    margin-left: 4px !important;
    cursor: pointer !important;
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    transition: all 0.2s ease !important;
    opacity: 0.8 !important;
    position: relative !important;
  }

  #csvComparisonModal .choices__button:hover {
    background: rgba(255, 255, 255, 0.5) !important;
    opacity: 1 !important;
    transform: scale(1.1) !important;
  }

  #csvComparisonModal .choices__button:active {
    transform: scale(0.95) !important;
  }

  /* Icono X dentro del botón */
  #csvComparisonModal .choices__button::after {
    content: 'X' !important;
    color: #ffffff !important;
    font-size: 16px !important;
    font-weight: 700 !important;
    line-height: 1 !important;
    display: block !important;
    margin: 0 !important;
    padding: 0 !important;
  }

  /* Contenedor del dropdown - sin scroll interno */
  #csvComparisonModal .choices__list {
    overflow: visible !important;
    max-height: none !important;
  }

  /* Dropdown desplegable */
  #csvComparisonModal .choices__list--dropdown {
    background: #ffffff !important;
    border: 2px solid #e0e7ef !important;
    border-top: none !important;
    border-radius: 0 0 8px 8px !important;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15) !important;
    max-height: 250px !important;
    overflow-y: auto !important;
    overflow-x: hidden !important;
    z-index: 10000 !important;
    margin-top: -2px !important;
    position: absolute !important;
    width: 100% !important;
  }

  /* Contenedor interno del dropdown - sin scroll */
  #csvComparisonModal .choices__list--dropdown .choices__list {
    overflow: visible !important;
    max-height: none !important;
  }

  /* Items en el dropdown */
  #csvComparisonModal .choices__list--dropdown .choices__item {
    background: #ffffff !important;
    color: #1a2332 !important;
    padding: 10px 14px !important;
    border-bottom: 1px solid #f0f0f0 !important;
    cursor: pointer !important;
    transition: background-color 0.2s ease, color 0.2s ease !important;
    font-size: 0.95rem !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    box-sizing: border-box !important;
    width: 100% !important;
    margin: 0 !important;
    line-height: 1.5 !important;
    font-weight: 400 !important;
    display: block !important;
    position: relative !important;
  }

  #csvComparisonModal .choices__list--dropdown .choices__item:last-child {
    border-bottom: none !important;
  }

  /* Hover sin cambios de tamaño */
  #csvComparisonModal .choices__list--dropdown .choices__item:hover {
    background: #f5f7fa !important;
    color: #1976d2 !important;
    padding: 10px 14px !important;
    margin: 0 !important;
    transform: none !important;
    width: 100% !important;
    box-sizing: border-box !important;
  }

  #csvComparisonModal .choices__list--dropdown .choices__item.is-highlighted {
    background: #e3f2fd !important;
    color: #1976d2 !important;
    font-weight: 500 !important;
    padding: 10px 14px !important;
    margin: 0 !important;
    transform: none !important;
    width: 100% !important;
    box-sizing: border-box !important;
  }

  /* Asegurar que el contenido interno no cause cambios de tamaño */
  #csvComparisonModal .choices__list--dropdown .choices__item--choice {
    display: block !important;
    width: 100% !important;
    padding: 0 !important;
    margin: 0 !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    box-sizing: border-box !important;
  }

  /* Input de búsqueda */
  #csvComparisonModal .choices__input {
    background: transparent !important;
    border: none !important;
    color: #1a2332 !important;
    font-size: 0.95rem !important;
    padding: 4px 0 !important;
    margin: 0 !important;
    min-width: 100px !important;
  }

  #csvComparisonModal .choices__input::placeholder {
    color: #9ca3af !important;
  }

  /* Placeholder */
  #csvComparisonModal .choices__placeholder {
    color: #9ca3af !important;
    opacity: 1 !important;
    font-size: 0.95rem !important;
  }

  /* Scrollbar personalizado para el dropdown */
  #csvComparisonModal .choices__list--dropdown::-webkit-scrollbar {
    width: 8px;
  }

  #csvComparisonModal .choices__list--dropdown::-webkit-scrollbar-track {
    background: #f5f5f5;
    border-radius: 4px;
  }

  #csvComparisonModal .choices__list--dropdown::-webkit-scrollbar-thumb {
    background: #cbd5e0;
    border-radius: 4px;
  }

  #csvComparisonModal .choices__list--dropdown::-webkit-scrollbar-thumb:hover {
    background: #a0aec0;
  }

  .comparison-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.98em;
    min-width: 900px;
    background: #fff;
  }
  .comparison-table th, .comparison-table td {
    border: 1px solid #e0e0e0;
    padding: 7px 10px;
    text-align: left;
    vertical-align: top;
    background: #fff;
  }
  .comparison-table th {
    background: #f5f7fa;
    font-weight: 600;
    position: sticky;
    top: 0;
    z-index: 2;
  }
  .comparison-table tr.changed {
    background: #fffbe7;
  }
  .comparison-table tr.new {
    background: #e3f2fd;
  }
  .comparison-table tr.deleted {
    background: #ffebee;
  }
  .comparison-table .changed-column {
    background: #fff3e0 !important;
    border: 2px solid #ff9800;
  }
  .comparison-table .changed-column .old-value {
    color: #d32f2f;
    text-decoration: line-through;
    font-size: 0.9em;
    margin-bottom: 2px;
  }
  .comparison-table .changed-column .new-value {
    color: #2e7d32;
    font-weight: 600;
    font-size: 1em;
  }
  .results-table-container {
    max-height: 350px;
    overflow-x: auto;
    overflow-y: auto;
    border: 1px solid #e0e0e0;
    border-radius: 4px;
    background: #fff;
  }
  @media (max-width: 1100px) {
    .comparison-table { font-size: 0.92em; min-width: 600px; }
  }
  
  .results-summary {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
    flex-wrap: wrap;
  }
  
  .summary-item {
    padding: 0.5rem 1rem;
    border-radius: 4px;
    font-weight: 600;
    font-size: 0.9em;
  }
  
  .summary-item.unchanged {
    background-color: #e8f5e8;
    color: #2e7d32;
  }
  
  .summary-item.changed {
    background-color: #fff3e0;
    color: #ef6c00;
  }
  
  .summary-item.new {
    background-color: #e3f2fd;
    color: #1565c0;
  }
  
  .summary-item.deleted {
    background-color: #ffebee;
    color: #c62828;
  }
  
  /* Version status styles */
  .version-status {
    padding: 0.5rem;
    margin-top: 0.5rem;
    border-radius: 4px;
    font-size: 0.9rem;
    font-weight: 500;
  }
  
  .version-status.success {
    background-color: #e8f5e8;
    color: #2e7d32;
    border: 1px solid #4caf50;
  }
  
  .version-status.error {
    background-color: #ffebee;
    color: #c62828;
    border: 1px solid #f44336;
  }
  
  .version-status.info {
    background-color: #e3f2fd;
    color: #1565c0;
    border: 1px solid #2196f3;
  }
  
  /* Backend Configuration Modal Styles */
  #backendConfigModal {
    transition: all 0.3s ease;
  }
  
  #backendConfigModal .modal-panel {
    background: #1a2332 !important;
    opacity: 1 !important;
    backdrop-filter: none !important;
  }
  
  #backendConfigModal .modal-panel {
    animation: modalSlideIn 0.3s ease-out;
  }
  
  @keyframes modalSlideIn {
    from {
      opacity: 0;
      transform: translateY(-20px) scale(0.95);
    }
    to {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }
  
  #backendConfigModal .modal-header {
    background: #2a3441;
    border-bottom: 1px solid rgba(71, 178, 229, 0.3);
  }
  
  #backendConfigModal .modal-content {
    background: #1a2332 !important;
    opacity: 1 !important;
  }
  
  #backendConfigModal .modal-header,
  #backendConfigModal .modal-footer {
    background: #2a3441 !important;
    opacity: 1 !important;
  }
  
  #backendConfigModal select,
  #backendConfigModal input {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(71, 178, 229, 0.3);
    color: #E8F4F8;
    transition: all 0.3s ease;
  }
  
  #backendConfigModal select:focus,
  #backendConfigModal input:focus {
    background: rgba(255, 255, 255, 0.08);
    border-color: #47B2E5;
    box-shadow: 0 0 0 3px rgba(71, 178, 229, 0.1);
    outline: none;
  }
  
  #backendConfigModal .config-section {
    background: #2a3441 !important;
    padding: 1rem;
    border-radius: 8px;
    border: 1px solid rgba(71, 178, 229, 0.2);
    margin-bottom: 1rem;
    opacity: 1 !important;
  }
  
  #backendConfigModal .modal-footer {
    background: #2a3441;
    border-top: 1px solid rgba(71, 178, 229, 0.3);
  }
  
  #backendConfigModal .modal-btn {
    background: rgba(71, 178, 229, 0.1);
    border: 1px solid rgba(71, 178, 229, 0.3);
    color: #E8F4F8;
    transition: all 0.3s ease;
    backdrop-filter: blur(5px);
  }
  
  #backendConfigModal .modal-btn:hover {
    background: rgba(71, 178, 229, 0.2);
    border-color: #47B2E5;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(71, 178, 229, 0.2);
  }
  
  #backendConfigModal .modal-btn.primary {
    background: linear-gradient(135deg, rgba(71, 178, 229, 0.2), rgba(25, 118, 210, 0.2));
    border-color: #47B2E5;
  }
  
  #backendConfigModal .modal-btn.primary:hover {
    background: linear-gradient(135deg, rgba(71, 178, 229, 0.3), rgba(25, 118, 210, 0.3));
    box-shadow: 0 6px 20px rgba(71, 178, 229, 0.3);
  }
  
  /* Source tabs styles */
  .input-source-tabs {
    display: flex;
    margin-bottom: 0.5rem;
    border-bottom: 1px solid #e0e0e0;
  }
  
  .source-tab {
    padding: 0.5rem 1rem;
    background: none;
    border: none;
    cursor: pointer;
    font-size: 0.9rem;
    color: #666;
    border-bottom: 2px solid transparent;
    transition: all 0.3s ease;
  }
  
  .source-tab.active {
    color: #1976d2;
    border-bottom-color: #1976d2;
    font-weight: 500;
  }
  
  .source-tab:hover {
    color: #1976d2;
    background-color: #f5f5f5;
  }
  
  .source-content {
    position: relative;
  }
  
  .source-file, .source-version {
    transition: opacity 0.3s ease;
  }
  
  .source-file.hidden, .source-version.hidden {
    display: none;
  }
  
  .version-select {
    width: 100% !important;
    padding: 0.5rem !important;
    margin-bottom: 0.5rem !important;
    border: 1px solid #47B2E5 !important;
    border-radius: 4px !important;
    font-size: 0.9rem !important;
    background: #1a2332 !important;
    background-color: #1a2332 !important;
    color: #E8F4F8 !important;
    -webkit-appearance: none !important;
    -moz-appearance: none !important;
    appearance: none !important;
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2347B2E5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e") !important;
    background-repeat: no-repeat !important;
    background-position: right 0.7rem center !important;
    background-size: 1em !important;
    padding-right: 2.5rem !important;
  }
  
  .version-select option {
    background: #1a2332 !important;
    background-color: #1a2332 !important;
    color: #E8F4F8 !important;
    padding: 0.5rem !important;
  }
  
  .version-select:focus {
    outline: none !important;
    border-color: #47B2E5 !important;
    box-shadow: 0 0 0 2px rgba(71, 178, 229, 0.2) !important;
    background: #1a2332 !important;
    background-color: #1a2332 !important;
    color: #E8F4F8 !important;
  }
  
  .version-select:hover {
    border-color: #5AC8FA !important;
    background: #1a2332 !important;
    background-color: #1a2332 !important;
    color: #E8F4F8 !important;
  }
  
  /* Estilos específicos para Firefox */
  @-moz-document url-prefix() {
    .version-select {
      background: #1a2332 !important;
      color: #E8F4F8 !important;
    }
    .version-select option {
      background: #1a2332 !important;
      color: #E8F4F8 !important;
    }
  }
  
  /* Estilos específicos para WebKit/Chrome */
  .version-select::-webkit-scrollbar {
    width: 8px;
  }
  
  .version-select::-webkit-scrollbar-track {
    background: #1a2332;
  }
  
  .version-select::-webkit-scrollbar-thumb {
    background: #47B2E5;
    border-radius: 4px;
  }
  
  /* Animación de spin para el botón de conexión */
  @keyframes spin {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(360deg);
    }
  }
  
  /* Estilos adicionales para forzar tema oscuro */
  #csvComparisonModal .version-select,
  #csvComparisonModal .version-select option {
    background: #1a2332 !important;
    background-color: #1a2332 !important;
    color: #E8F4F8 !important;
    border: 1px solid #47B2E5 !important;
  }
  
  #csvComparisonModal .version-select:focus,
  #csvComparisonModal .version-select:hover {
    background: #1a2332 !important;
    background-color: #1a2332 !important;
    color: #E8F4F8 !important;
  }
  
  .load-version-btn {
    padding: 0.5rem 1rem;
    background: #1976d2;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.9rem;
    transition: background-color 0.3s ease;
  }
  
  .load-version-btn:hover:not(:disabled) {
    background: #1565c0;
  }
  
  .load-version-btn:disabled {
    background: #ccc;
    cursor: not-allowed;
  }
  
  /* Ops Hub Filter Summary Popup Styles - Toast Notification */
  .ops-hub-filter-popup {
    position: fixed;
    top: 50%;
    right: 20px;
    width: 320px;
    max-width: calc(100vw - 40px);
    max-height: 80vh;
    z-index: 10002;
    opacity: 0;
    transform: translateX(100%) translateY(-50%);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    pointer-events: auto;
    box-sizing: border-box;
  }
  
  .ops-hub-filter-popup.show {
    opacity: 1;
    transform: translateX(0) translateY(-50%);
  }
  
  .ops-hub-filter-popup.fade-out {
    opacity: 0;
    transform: translateX(100%) translateY(-50%);
  }
  
  .ops-filter-popup-content {
    background: #1a2332 !important;
    background-color: #1a2332 !important;
    box-shadow: none !important;
    border-radius: 12px;
    padding: 1.25rem 1.25rem 1.5rem 1.25rem;
    width: 100%;
    max-height: 75vh;
    overflow-y: auto;
    text-align: left;
    position: relative;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  
  .ops-filter-popup-content:hover {
    transform: scale(1.02);
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5);
    border-color: rgba(71, 178, 229, 0.6);
  }
  
  .ops-filter-popup-close {
    position: absolute;
    top: 0.75rem;
    right: 0.75rem;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: rgba(255, 255, 255, 0.7);
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.2s ease;
    z-index: 1;
  }
  
  .ops-filter-popup-close:hover {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    transform: scale(1.1);
  }
  
  .ops-filter-auto-close-indicator {
    position: absolute;
    bottom: 0;
    left: 0;
    height: 2px;
    background: linear-gradient(90deg, #47B2E5 0%, #1976d2 100%);
    border-radius: 0 0 12px 12px;
    animation: autoCloseProgress 4s linear forwards;
    opacity: 0.8;
  }
  
  .ops-filter-auto-close-indicator.paused {
    animation-play-state: paused;
  }
  
  .ops-filter-auto-close-indicator.fast {
    animation: autoCloseProgress 2s linear forwards;
  }
  
  @keyframes autoCloseProgress {
    from {
      width: 100%;
    }
    to {
      width: 0%;
    }
  }
  

  
  .ops-filter-title {
    color: white;
    font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
    font-size: 1rem;
    font-weight: 600;
    margin: 0 0 0.25rem 0;
    padding-right: 2rem;
  }
  
  .ops-filter-subtitle {
    color: #47B2E5;
    font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
    font-size: 0.8rem;
    font-weight: 400;
    margin: 0 0 0.75rem 0;
    opacity: 0.9;
  }
  
  .ops-filter-stats {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.5rem;
    margin-bottom: 0.75rem;
  }
  
  .ops-filter-stat {
    background: rgba(71, 178, 229, 0.1);
    border: 1px solid rgba(71, 178, 229, 0.3);
    border-radius: 8px;
    padding: 0.6rem;
    text-align: center;
    flex: 1;
  }
  
  .ops-filter-number {
    font-size: 1.1rem;
    font-weight: 700;
    color: #47B2E5;
    margin-bottom: 0.1rem;
    font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
  }
  
  .ops-filter-label {
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.7rem;
    font-weight: 500;
  }
  
  .ops-filter-filters {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    padding: 0.6rem;
    margin-bottom: 0.6rem;
  }
  
  .ops-filter-filters-title {
    color: white;
    font-size: 0.75rem;
    font-weight: 600;
    margin-bottom: 0.3rem;
  }
  
  .ops-filter-filters-list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.25rem;
    justify-content: flex-start;
  }
  
  .ops-filter-chip {
    background: rgba(71, 178, 229, 0.2);
    color: #47B2E5;
    padding: 0.15rem 0.5rem;
    border-radius: 10px;
    font-size: 0.65rem;
    font-weight: 500;
    border: 1px solid rgba(71, 178, 229, 0.3);
  }
  
  .ops-filter-actions {
    display: flex;
    gap: 0.4rem;
    justify-content: space-between;
    align-items: center;
    margin-top: 0.2rem;
  }
  
  .ops-filter-view-table {
    background: linear-gradient(135deg, #47B2E5 0%, #1976d2 100%);
    border: none;
    border-radius: 6px;
    color: white;
    padding: 0.4rem 0.6rem;
    cursor: pointer;
    font-size: 0.75rem;
    font-weight: 600;
    transition: all 0.2s ease;
    font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
    box-shadow: 0 2px 8px rgba(71, 178, 229, 0.3);
    flex: 1;
  }
  
  .ops-filter-view-table:hover {
    background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(71, 178, 229, 0.4);
  }
  
  .ops-filter-close {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 6px;
    color: rgba(255, 255, 255, 0.8);
    padding: 0.4rem 0.6rem;
    cursor: pointer;
    font-size: 0.75rem;
    font-weight: 500;
    transition: all 0.2s ease;
    font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
    flex: 1;
  }
  
  .ops-filter-close:hover {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    transform: translateY(-1px);
  }
  
  /* Responsive Design para Ops Hub Toast */
  @media (max-width: 768px) {
    .ops-hub-filter-popup {
      top: 10px;
      right: 10px;
      left: 10px;
      width: auto;
      max-width: none;
      max-height: 70vh;
    }
    
    .ops-filter-popup-content {
      padding: 1rem 1rem 1.25rem 1rem;
      max-height: 65vh;
    }
    
    .ops-filter-title {
      font-size: 0.95rem;
      padding-right: 2rem;
    }
    
    .ops-filter-subtitle {
      font-size: 0.75rem;
    }
    
    .ops-filter-stats {
      gap: 0.4rem;
    }
    
    .ops-filter-stat {
      padding: 0.5rem;
    }
    
    .ops-filter-number {
      font-size: 1rem;
    }
    
    .ops-filter-label {
      font-size: 0.65rem;
    }
    
    .ops-filter-actions {
      gap: 0.3rem;
    }
    
    .ops-filter-view-table,
    .ops-filter-close {
      padding: 0.35rem 0.5rem;
      font-size: 0.7rem;
    }
    
    .ops-filter-popup-close {
      width: 20px;
      height: 20px;
      font-size: 0.9rem;
      top: 0.6rem;
      right: 0.6rem;
    }
  }
  
  @media (max-width: 480px) {
    .ops-hub-filter-popup {
      top: 5px;
      right: 5px;
      left: 5px;
      max-height: 60vh;
    }
    
    .ops-filter-popup-content {
      padding: 0.8rem 0.8rem 1rem 0.8rem;
      max-height: 55vh;
    }
    
    .ops-filter-title {
      font-size: 0.9rem;
    }
    
    .ops-filter-subtitle {
      font-size: 0.7rem;
    }
    
    .ops-filter-filters-list {
      gap: 0.2rem;
    }
    
    .ops-filter-chip {
      font-size: 0.6rem;
      padding: 0.1rem 0.4rem;
    }
    
    .ops-filter-popup-close {
      width: 18px;
      height: 18px;
      font-size: 0.8rem;
      top: 0.5rem;
      right: 0.5rem;
    }
  }

  /* Comparison Summary Popup Styles */
  .comparison-summary-popup {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 10001;
    opacity: 0;
    transform: scale(0.9);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  .comparison-summary-popup.show {
    opacity: 1;
    transform: scale(1);
  }
  
  .comparison-summary-popup.fade-out {
    opacity: 0;
    transform: scale(0.95);
  }
  
  .popup-overlay {
    width: 100%;
    height: 100%;
    background: transparent;
    backdrop-filter: none;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem;
    box-sizing: border-box;
  }
  
  .popup-content {
    background: linear-gradient(135deg, #1a2332 0%, #0f1419 100%);
    border-radius: 20px;
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
    border: 1px solid rgba(71, 178, 229, 0.2);
    max-width: 600px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    position: relative;
  }
  
  .popup-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 2rem 2rem 1rem 2rem;
    border-bottom: 1px solid rgba(71, 178, 229, 0.1);
  }
  
  .popup-icon {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.8rem;
    flex-shrink: 0;
  }
  
  .popup-icon.changes {
    background: linear-gradient(135deg, #47B2E5 0%, #1976d2 100%);
    box-shadow: 0 8px 20px rgba(71, 178, 229, 0.3);
  }
  
  .popup-icon.no-changes {
    background: linear-gradient(135deg, #10B981 0%, #059669 100%);
    box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
  }
  
  .popup-title {
    color: white;
    font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
    font-size: 1.8rem;
    font-weight: 600;
    margin: 0;
    flex: 1;
  }
  
  .popup-close {
    position: absolute;
    top: 1.5rem;
    right: 1.5rem;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: rgba(255, 255, 255, 0.7);
    font-size: 1.5rem;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  
  .popup-close:hover {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    transform: scale(1.1);
  }
  
  .popup-body {
    padding: 1.5rem 2rem;
  }
  
  .summary-stats {
    text-align: center;
    margin-bottom: 2rem;
  }
  
  .stat-item.total {
    background: rgba(71, 178, 229, 0.1);
    border: 1px solid rgba(71, 178, 229, 0.3);
    border-radius: 16px;
    padding: 1.5rem;
    display: inline-block;
  }
  
  .stat-number {
    font-size: 3rem;
    font-weight: 700;
    color: #47B2E5;
    margin-bottom: 0.5rem;
    font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
  }
  
  .stat-label {
    color: rgba(255, 255, 255, 0.8);
    font-size: 1.1rem;
    font-weight: 500;
  }
  
  .summary-breakdown {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    margin-bottom: 2rem;
  }
  
  .breakdown-item {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 1.25rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    transition: all 0.3s ease;
    opacity: 0.6;
  }
  
  .breakdown-item.has-data {
    opacity: 1;
    transform: translateY(0);
  }
  
  .breakdown-item.unchanged.has-data {
    border-color: rgba(16, 185, 129, 0.3);
    background: rgba(16, 185, 129, 0.1);
  }
  
  .breakdown-item.changed.has-data {
    border-color: rgba(251, 191, 36, 0.3);
    background: rgba(251, 191, 36, 0.1);
  }
  
  .breakdown-item.new.has-data {
    border-color: rgba(59, 130, 246, 0.3);
    background: rgba(59, 130, 246, 0.1);
  }
  
  .breakdown-item.deleted.has-data {
    border-color: rgba(239, 68, 68, 0.3);
    background: rgba(239, 68, 68, 0.1);
  }
  
  .breakdown-icon {
    font-size: 1.5rem;
    flex-shrink: 0;
  }
  
  .breakdown-content {
    flex: 1;
  }
  
  .breakdown-number {
    font-size: 1.8rem;
    font-weight: 700;
    color: white;
    margin-bottom: 0.25rem;
  }
  
  .breakdown-label {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.9rem;
    font-weight: 500;
  }
  
  .breakdown-percentage {
    color: rgba(255, 255, 255, 0.8);
    font-size: 1.1rem;
    font-weight: 600;
    flex-shrink: 0;
  }
  
  .summary-message {
    text-align: center;
    background: rgba(71, 178, 229, 0.1);
    border: 1px solid rgba(71, 178, 229, 0.2);
    border-radius: 12px;
    padding: 1.5rem;
  }
  
  .summary-message p {
    color: white;
    margin: 0;
    font-size: 1.1rem;
    line-height: 1.5;
  }
  
  .popup-footer {
    padding: 1.5rem 2rem 2rem 2rem;
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
    border-top: 1px solid rgba(71, 178, 229, 0.1);
  }
  
  .popup-btn {
    padding: 0.75rem 1.5rem;
    border-radius: 10px;
    font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
    font-weight: 600;
    font-size: 0.95rem;
    cursor: pointer;
    transition: all 0.3s ease;
    border: none;
  }
  
  .popup-btn.primary {
    background: linear-gradient(135deg, #47B2E5 0%, #1976d2 100%);
    color: white;
    box-shadow: 0 4px 12px rgba(71, 178, 229, 0.3);
  }
  
  .popup-btn.primary:hover {
    background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(71, 178, 229, 0.4);
  }
  
  .popup-btn.secondary {
    background: rgba(255, 255, 255, 0.1);
    color: rgba(255, 255, 255, 0.9);
    border: 1px solid rgba(255, 255, 255, 0.2);
  }
  
  .popup-btn.secondary:hover {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    transform: translateY(-1px);
  }
  
  /* Responsive Design */
  @media (max-width: 768px) {
    .popup-content {
      margin: 1rem;
      border-radius: 16px;
    }
    
    .popup-header {
      padding: 1.5rem 1.5rem 1rem 1.5rem;
    }
    
    .popup-title {
      font-size: 1.5rem;
    }
    
    .popup-body {
      padding: 1rem 1.5rem;
    }
    
    .summary-breakdown {
      grid-template-columns: 1fr;
    }
    
    .breakdown-item {
      padding: 1rem;
    }
    
    .stat-number {
      font-size: 2.5rem;
    }
    
    .breakdown-number {
      font-size: 1.5rem;
    }
    
    .popup-footer {
      padding: 1rem 1.5rem 1.5rem 1.5rem;
      flex-direction: column;
    }
    
    .popup-btn {
      width: 100%;
      justify-content: center;
    }
  }

  /* --- OPS HUB SUMMARY MODAL MODERN LAYOUT --- */
  #opsSummaryModal .modal-panel {
    max-width: 1600px !important;
    width: 90vw !important;
    min-width: 900px !important;
    padding: 0 !important;
    border-radius: 20px !important;
    box-shadow: 0 20px 60px rgba(0,0,0,0.45) !important;
  }
  #opsSummaryModal .modal-content {
    padding: 2.5rem 2.5rem 2rem 2.5rem;
  }
  .summary-config-section {
    display: grid;
    grid-template-columns: 660px 1fr;
    gap: 1.5rem;
    align-items: flex-start;
  }
  .cards-selection-section {
    min-width: 340px;
    max-width: 480px;
    padding: 1.5rem 1.2rem;
  }
  .summary-preview-section {
    min-width: 480px;
    max-width: 100%;
    width: 100%;
    padding: 1.5rem 1.2rem;
  }
  .summary-preview {
    min-width: 420px;
    max-width: 100%;
    width: 100%;
    min-height: 340px;
    max-height: 520px;
    padding: 2rem 2.5rem;
    margin: 0 auto;
    box-shadow: 0 2px 16px rgba(71,178,229,0.07);
  }
  /* Responsive: una columna en móvil */
  @media (max-width: 900px) {
    #opsSummaryModal .modal-panel {
      min-width: 0 !important;
      width: 99vw !important;
      max-width: 99vw !important;
      border-radius: 10px !important;
    }
    #opsSummaryModal .modal-content {
      padding: 1rem 0.5rem 1.5rem 0.5rem;
    }
    .summary-config-section {
      display: flex;
      flex-direction: column;
      gap: 1.2rem;
    }
    .cards-selection-section, .summary-preview-section {
      min-width: 0;
      max-width: 100vw;
      padding: 0.7rem 0.2rem;
    }
    .summary-preview {
      min-width: 0;
      padding: 1rem 0.5rem;
      max-height: 350px;
    }
  }
</style>

<!-- Dependencias externas -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
<script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

<!-- CSS INLINE PARA FORZAR ABSOLUTAMENTE LA VISIBILIDAD -->
<style>
       /* OVERRIDE ABSOLUTO PARA DROPDOWNS DE FILTROS */
   .excel-dropdown * {
     color: #47B2E5 !important;
     text-shadow: none !important;
   }
   
   .excel-checkbox-list * {
     color: #47B2E5 !important;
     text-shadow: none !important;
   }
   
   .excel-checkbox-list label {
     color: #47B2E5 !important;
     text-shadow: none !important;
     background: transparent !important;
   }
   
   .excel-checkbox-list label span {
     color: #47B2E5 !important;
     text-shadow: none !important;
     background: transparent !important;
     font-size: 0.9rem !important;
   }
  
       .excel-dropdown {
     background: #fff !important;
     color: #47B2E5 !important;
   }
   
   /* Forzar en cualquier contexto */
   th .excel-dropdown *,
   th .excel-checkbox-list *,
   table th .excel-dropdown *,
   table th .excel-checkbox-list *,
   .data-table th .excel-dropdown *,
   .data-table th .excel-checkbox-list * {
     color: #47B2E5 !important;
     text-shadow: none !important;
   }
   
   /* Override con máxima especificidad */
   html body .excel-dropdown *,
   html body .excel-checkbox-list *,
   html body th .excel-dropdown *,
   html body th .excel-checkbox-list * {
     color: #47B2E5 !important;
     text-shadow: none !important;
   }
  
  /* Excepciones para botones Apply */
  .excel-dropdown .apply-btn,
  .excel-dropdown .filter-apply-btn {
    color: #fff !important;
    background: #10B981 !important;
  }
  
       /* ULTRA ESPECÍFICO - SOBRESCRIBIR TODO */
   * * * .excel-dropdown * * *,
   * * * .excel-checkbox-list * * *,
   html body div table thead tr th div .excel-dropdown * * *,
   html body div table thead tr th div .excel-checkbox-list * * * {
     color: #47B2E5 !important;
     text-shadow: none !important;
     opacity: 1 !important;
     visibility: visible !important;
   }
   
   /* FORZAR ABSOLUTAMENTE TODO ELEMENTO */
   [class*="excel"] *,
   [class*="checkbox"] * {
     color: #47B2E5 !important;
     text-shadow: none !important;
   }
  
       /* ESPECÍFICO PARA SPANS Y LABELS */
   .excel-dropdown span,
   .excel-dropdown label,
   .excel-checkbox-list span,
   .excel-checkbox-list label {
     color: #47B2E5 !important;
     text-shadow: none !important;
     background: transparent !important;
     font-size: 0.9rem !important;
     line-height: 1.4 !important;
     opacity: 1 !important;
     visibility: visible !important;
     display: block !important;
   }
   
   /* MÉTODO EXTREMO: USAR PSEUDO-ELEMENTOS */
   .excel-checkbox-list label::after {
     content: attr(data-text) !important;
     color: #47B2E5 !important;
     font-size: 0.9rem !important;
     margin-left: 0.5rem !important;
   }
   
   /* FORZAR TODO CON WEBKIT */
   .excel-dropdown *,
   .excel-checkbox-list * {
     -webkit-text-fill-color: #47B2E5 !important;
     -webkit-text-stroke: none !important;
   }

   /* ========================================
      WELCOME SCREEN - NUEVO DESDE CERO
      ======================================== */
   #welcomeScreen {
     position: fixed;
     top: 0;
     left: 0;
     width: 100%;
     height: 100%;
     background: #E3F2FD;
     display: flex;
     align-items: center;
     justify-content: center;
     z-index: 9999;
     padding: 2rem;
   }

   .welcome-container {
     width: 100%;
     max-width: 450px;
     text-align: center;
   }

   .welcome-logo {
     margin-bottom: 2rem;
   }

   .welcome-logo img {
     width: 100px;
     height: 100px;
     border-radius: 20px;
     box-shadow: 0 8px 24px rgba(71, 178, 229, 0.3);
     object-fit: contain;
     background: transparent;
     display: block;
     margin: 0 auto;
   }

  .welcome-title {
    font-size: 3.6rem;
    font-weight: 350;
    color: #15364A;
    margin: 0 0 1.5rem 0;
    font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
    letter-spacing: 0.08em;
    text-align: center;
    position: relative;
    display: inline-block;
    width: 100%;
    text-transform: none;
    line-height: 1.3;
    opacity: 0.92;
  }

  .welcome-title::after {
    content: '';
    position: absolute;
    bottom: -8px;
    left: 50%;
    transform: translateX(-50%);
    width: 60%;
    height: 2px;
    background: linear-gradient(90deg, transparent 0%, #47B2E5 20%, #47B2E5 80%, transparent 100%);
    opacity: 0.35;
    transition: opacity 0.3s ease;
    border-radius: 2px;
  }

  .welcome-subtitle {
    font-size: 1.15rem;
    color: #15364A;
    margin: 0 0 3rem 0;
    font-weight: 400;
    font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
    text-align: center;
    letter-spacing: 0.05em;
    text-transform: none;
    opacity: 0.85;
    line-height: 1.6;
  }

   .welcome-buttons {
     display: flex;
     flex-direction: column;
     gap: 1rem;
     margin-bottom: 3rem;
   }

   .welcome-btn,
   #onedriveLoginBtn,
   #guestLoginBtn {
     width: 100%;
     min-height: 60px;
     height: 60px;
     display: flex;
     align-items: center;
     gap: 0.75rem;
     padding: 0.875rem 1.25rem;
     background: #47B2E5;
     color: #000000;
     border: none;
     border-radius: 10px;
     font-size: 0.95rem;
     font-weight: 600;
     cursor: pointer;
     transition: background 0.3s ease, box-shadow 0.3s ease;
     box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
     text-align: left;
     font-family: 'Roboto', sans-serif;
     box-sizing: border-box;
   }

   .welcome-btn:hover,
   #onedriveLoginBtn:hover,
   #guestLoginBtn:hover {
     background: #1976d2;
     box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
   }

   .welcome-btn:active,
   #onedriveLoginBtn:active,
   #guestLoginBtn:active {
     background: #1976d2;
     box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
   }

   .welcome-btn svg,
   #onedriveLoginBtn svg,
   #guestLoginBtn svg {
     width: 24px;
     height: 24px;
     flex-shrink: 0;
     fill: #000000;
   }

   .welcome-btn-text {
     flex: 1;
     text-align: left;
   }

   .welcome-btn-title {
     font-size: 1rem;
     font-weight: 600;
     color: #000000;
     margin: 0 0 0.2rem 0;
   }

   .welcome-btn-desc {
     font-size: 0.85rem;
     font-weight: 400;
     color: #333333;
     margin: 0;
   }

   /* Spinner para estado de carga */
   .welcome-btn .loading-spinner {
     width: 24px;
     height: 24px;
     border: 2px solid rgba(0, 0, 0, 0.3);
     border-top: 2px solid #000000;
     border-radius: 50%;
     animation: spin 1s linear infinite;
     flex-shrink: 0;
   }

   @keyframes spin {
     0% { transform: rotate(0deg); }
     100% { transform: rotate(360deg); }
   }

   .welcome-footer {
     font-size: 0.9rem;
     color: #000000;
     opacity: 0.7;
     margin-top: 2rem;
     cursor: default;
     pointer-events: none;
     font-weight: 400;
     letter-spacing: 0.3px;
     font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
     user-select: none;
   }

   #csvLoadingBar {
     width: 0;
     height: 4px;
     background: linear-gradient(90deg, #47B2E5, #1976d2);
     margin: 2rem auto 0;
     transition: width 0.3s ease;
     display: none;
     border-radius: 2px;
   }

   /* Modal Select Version Styles - Estilo similar a la pantalla de bienvenida */
   #selectVersionModal {
     background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 50%, #E3F2FD 100%);
     backdrop-filter: none;
     overflow-y: auto;
     overflow-x: hidden;
     padding: 1rem 0;
     box-sizing: border-box;
   }

   #selectVersionModal .modal-panel {
     background: rgba(255, 255, 255, 0.5);
     backdrop-filter: none;
     border: 1px solid rgba(0, 0, 0, 0.1);
     border-radius: 20px;
     box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
     color: #000000;
     max-width: 700px;
     width: 90%;
     max-height: 90vh;
     overflow-y: auto;
   }

   #selectVersionModal .modal-header {
     background: rgba(0, 0, 0, 0.05);
     border-bottom: 1px solid rgba(0, 0, 0, 0.1);
     border-radius: 20px 20px 0 0;
     padding: 1.5rem 2rem;
   }

   #selectVersionModal .panel-header-title {
     color: #000000;
     font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
     font-weight: 600;
     font-size: 1.5rem;
     margin: 0;
   }

   /* Estilos de close-btn unificados en 99-master-override.css */

   #selectVersionModal .modal-content {
     padding: 2rem;
   }

   #versionSearchInput {
     background: rgba(255, 255, 255, 0.7);
     border: 1px solid rgba(0, 0, 0, 0.2);
     border-radius: 12px;
     padding: 1rem 1.5rem;
     color: #000000;
     font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
     font-size: 1rem;
     width: 100%;
     box-sizing: border-box;
     backdrop-filter: none;
     transition: all 0.3s ease;
   }

   #versionSearchInput::placeholder {
     color: rgba(0, 0, 0, 0.5);
   }

   #versionSearchInput:focus {
     outline: none;
     border-color: #47B2E5;
     box-shadow: 0 0 0 3px rgba(71, 178, 229, 0.2);
     background: rgba(255, 255, 255, 0.9);
   }

   .versions-list {
     max-height: 400px;
     overflow-y: auto;
     border-radius: 16px;
     background: rgba(0, 0, 0, 0.05);
     border: 1px solid rgba(0, 0, 0, 0.1);
     backdrop-filter: none;
     margin-top: 1rem;
   }

   .version-item {
     display: flex;
     align-items: center;
     justify-content: space-between;
     padding: 1.5rem 2rem;
     border-bottom: 1px solid rgba(0, 0, 0, 0.1);
     cursor: pointer;
     transition: all 0.3s ease;
     background: transparent;
   }

   .version-item:hover {
     background: rgba(71, 178, 229, 0.15);
     transform: translateX(8px);
     border-radius: 12px;
     margin: 0 0.5rem;
     border-bottom: 1px solid rgba(71, 178, 229, 0.2);
   }

   .version-item:last-child {
     border-bottom: none;
     border-radius: 0 0 16px 16px;
   }

   .version-item:hover:last-child {
     border-radius: 12px;
     margin: 0 0.5rem 0.5rem 0.5rem;
   }

   .version-info {
     flex: 1;
   }

   .version-name {
     font-weight: 600;
     color: #47B2E5;
     font-size: 1.2rem;
     margin-bottom: 0.5rem;
     font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
   }

   .version-date {
     color: rgba(0, 0, 0, 0.7);
     font-size: 0.95rem;
     font-family: 'Courier New', monospace;
     opacity: 0.8;
   }

   .version-load-btn {
     padding: 0.75rem 1.5rem;
     background: linear-gradient(135deg, #47B2E5 0%, #1976d2 100%);
     color: white;
     border: none;
     border-radius: 10px;
     cursor: pointer;
     font-weight: 600;
     font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
     font-size: 0.95rem;
     transition: all 0.3s ease;
     box-shadow: 0 4px 12px rgba(71, 178, 229, 0.3);
   }

   .version-load-btn:hover {
     background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
     transform: scale(1.05);
     box-shadow: 0 6px 16px rgba(71, 178, 229, 0.4);
   }

   .version-load-btn:active {
     transform: scale(0.98);
   }

   .no-versions-message {
     text-align: center;
     color: rgba(0, 0, 0, 0.6);
     padding: 3rem 2rem;
     font-style: italic;
     font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
     font-size: 1.1rem;
   }

   /* Scrollbar personalizado para la lista de versiones */
   .versions-list::-webkit-scrollbar {
     width: 8px;
   }

   .versions-list::-webkit-scrollbar-track {
     background: rgba(255, 255, 255, 0.1);
     border-radius: 10px;
   }

   .versions-list::-webkit-scrollbar-thumb {
     background: rgba(71, 178, 229, 0.5);
     border-radius: 10px;
   }

   .versions-list::-webkit-scrollbar-thumb:hover {
     background: rgba(71, 178, 229, 0.7);
   }


   .welcome-loading-state {
     position: absolute;
     top: 50%;
     left: 50%;
     transform: translate(-50%, -50%);
     text-align: center;
     width: 100%;
     max-width: 300px;
   }
   
   .welcome-loading-state .loading-message {
     font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
     font-size: 1rem;
     color: #47B2E5;
     margin: 0;
     opacity: 0.9;
     font-weight: 400;
     animation: fadeInOut 2s ease-in-out infinite;
   }
   
   @keyframes fadeInOut {
     0%, 100% { opacity: 0.6; }
     50% { opacity: 1; }
   }

   .welcome-copyright {
     margin-top: 3rem;
     padding-top: 2rem;
     font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
     font-size: 0.9rem;
     color: var(--tb-text-muted);
     text-align: center;
     user-select: none;
   }

   /* Progress Bar */
   #csvLoadingBar {
     width: 0;
     height: 4px;
     background: linear-gradient(90deg, #47B2E5, #1976d2);
     margin: 2rem auto 0;
     transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
     display: none;
     border-radius: 2px;
   }

   .loading-spinner {
     display: flex;
     justify-content: center;
     align-items: center;
     margin-bottom: 1.5rem;
     width: 100%;
   }

   .spinner {
     width: 24px;
     height: 24px;
     border: 2px solid rgba(71, 178, 229, 0.2);
     border-top: 2px solid #47B2E5;
     border-radius: 50%;
     animation: spin 1s linear infinite;
     margin: 0 auto;
   }



   @keyframes fadeIn {
     from { 
       opacity: 0; 
       transform: scale(0.95);
     }
     to { 
       opacity: 1; 
       transform: scale(1);
     }
   }

   @keyframes slideUp {
     from {
       opacity: 0;
       transform: translateY(20px) scale(0.98);
     }
     to {
       opacity: 1;
       transform: translateY(0) scale(1);
     }
   }

   @keyframes pulse {
     0%, 100% {
       transform: scale(1);
       box-shadow: 0 8px 32px rgba(71, 178, 229, 0.3);
     }
     50% {
       transform: scale(1.05);
       box-shadow: 0 12px 40px rgba(71, 178, 229, 0.5);
     }
   }

   @keyframes spin {
     0% { transform: rotate(0deg); }
     100% { transform: rotate(360deg); }
   }

   /* Loading dots animation */
   .loading-dots {
     display: inline-block;
   }
   
   .loading-dots span {
     opacity: 0;
     animation: loadingDots 1.4s infinite;
   }
   
   .loading-dots span:nth-child(1) {
     animation-delay: 0s;
   }
   
   .loading-dots span:nth-child(2) {
     animation-delay: 0.2s;
   }
   
   .loading-dots span:nth-child(3) {
     animation-delay: 0.4s;
   }
   
   @keyframes loadingDots {
     0%, 80%, 100% {
       opacity: 0;
     }
     40% {
       opacity: 1;
     }
   }

   .welcome-screen.fade-out {
     animation: fadeOut 0.3s ease-in-out forwards;
   }

   @keyframes fadeOut {
     from { 
       opacity: 1; 
       transform: scale(1);
     }
     to { 
       opacity: 0; 
       transform: scale(0.95);
     }
   }

   /* Responsive Design */
   @media (max-width: 1200px) {
     .welcome-content {
       max-width: 600px;
       padding: 2rem 1.5rem 4rem 1.5rem;
     }
     
     .welcome-title {
       font-size: 3rem;
       font-weight: 300;
       letter-spacing: 0.05em;
     }
     
     .welcome-loading-state {
       max-width: 280px;
     }
     
     .spinner {
       width: 24px;
       height: 24px;
       border-width: 2px;
     }
   }

   @media (max-width: 768px) {
     .welcome-content {
       max-width: 90%;
       padding: 1.5rem 1rem 3rem 1rem;
     }
     
     .welcome-title {
       font-size: 2.5rem;
       font-weight: 300;
       letter-spacing: 0.05em;
       line-height: 1.2;
     }
     
     .welcome-hook {
       font-size: 0.95em !important;
       margin: 6px 0 25px 0 !important;
     }
     
     .welcome-subtitle {
       font-size: 1.1rem;
       margin: 0 0 30px 0;
     }
     
     .welcome-option-btn {
       padding: 1.25rem 1.5rem;
       font-size: 0.95rem;
     }
     
     .option-title {
       font-size: 1rem;
     }
     
     .option-desc {
       font-size: 0.85rem;
     }
     
     .welcome-logo img {
       width: 70px !important;
       height: 70px !important;
       margin-bottom: 15px !important;
     }
     
     .welcome-copyright {
       font-size: 0.8rem;
       bottom: 1.5rem;
     }
     
     .welcome-loading-state {
       max-width: 250px;
     }
     
     .spinner {
       width: 24px;
       height: 24px;
       border-width: 2px;
     }
     
     .welcome-loading-state .loading-message {
       font-size: 0.9rem;
     }
     
     .in-app-loading-content {
       max-width: 350px;
       padding: 0 1rem;
     }
     
     .in-app-title {
       font-size: 1.8rem;
       margin-bottom: 1.5rem;
     }
     
     .in-app-logo img {
       width: 70px;
       height: 70px;
     }
     
     .in-app-loading-content .spinner {
       width: 24px;
       height: 24px;
       border-width: 2px;
     }
     
     .loading-message {
       font-size: 1rem;
     }
   }

   @media (max-width: 480px) {
     .welcome-content {
       max-width: 95%;
       padding: 1rem 0.75rem 2.5rem 0.75rem;
     }
     
     .welcome-title {
       font-size: 2.2rem;
       font-weight: 300;
       letter-spacing: 0.05em;
       margin: 0 0 2rem 0;
     }
     
     .welcome-hook {
       font-size: 0.9em !important;
       margin: 4px 0 20px 0 !important;
     }
     
     .welcome-subtitle {
       font-size: 1rem;
       margin: 0 0 25px 0;
     }
     
     .welcome-options {
       gap: 0.8rem;
       margin-bottom: 1.5rem;
     }
     
     .welcome-option-btn {
       padding: 1rem 1.25rem;
       font-size: 0.9rem;
       gap: 0.8rem;
     }
     
     .welcome-option-btn svg {
       width: 20px;
       height: 20px;
     }
     
     .option-title {
       font-size: 0.95rem;
     }
     
     .option-desc {
       font-size: 0.8rem;
     }
     
     .welcome-logo img {
       width: 60px !important;
       height: 60px !important;
       margin-bottom: 12px !important;
     }
     
     .welcome-copyright {
       font-size: 0.75rem;
       bottom: 1rem;
       padding: 0 1rem;
     }
     
     .welcome-loading-state {
       max-width: 220px;
     }
     
     .spinner {
       width: 24px;
       height: 24px;
       border-width: 2px;
     }
     
     .welcome-loading-state .loading-message {
       font-size: 0.85rem;
     }
     
     .in-app-loading-content {
       max-width: 300px;
       padding: 0 0.75rem;
     }
     
     .in-app-title {
       font-size: 1.6rem;
       margin-bottom: 1.2rem;
     }
     
     .in-app-logo img {
       width: 60px;
       height: 60px;
     }
     
     .in-app-loading-content .spinner {
       width: 24px;
       height: 24px;
       border-width: 2px;
     }
     
     .loading-message {
       font-size: 0.95rem;
     }
   }

   @media (max-width: 320px) {
     .welcome-title {
       font-size: 2rem;
       font-weight: 300;
       letter-spacing: 0.05em;
     }
     
     .welcome-hook {
       font-size: 0.85em !important;
     }
     
     .welcome-subtitle {
       font-size: 0.95rem;
     }
     
     .welcome-option-btn {
       padding: 0.9rem 1rem;
       font-size: 0.85rem;
     }
     
     .option-title {
       font-size: 0.9rem;
     }
     
     .option-desc {
       font-size: 0.75rem;
     }
     
     .welcome-logo img {
       width: 50px !important;
       height: 50px !important;
       margin-bottom: 10px !important;
     }
     
     .welcome-loading-state {
       max-width: 200px;
       transform: translate(-50%, -50%) scale(0.9);
     }
     
     .spinner {
       width: 24px;
       height: 24px;
       border-width: 2px;
     }
     
     .welcome-loading-state .loading-message {
       font-size: 0.8rem;
     }
     
     .in-app-loading-content {
       max-width: 260px;
       padding: 0 0.5rem;
       transform: scale(0.9);
     }
     
     .in-app-title {
       font-size: 1.4rem;
       margin-bottom: 1rem;
     }
     
     .in-app-logo img {
       width: 50px;
       height: 50px;
     }
     
     .in-app-loading-content .spinner {
       width: 24px;
       height: 24px;
       border-width: 2px;
     }
     
     .loading-message {
       font-size: 0.9rem;
     }
   }

   /* Calendar Dark Theme Styles */
   #calendarPopup {
     z-index: 10000;
   }
   
   .calendar-day-hover {
     background: rgba(71,178,229,0.2) !important;
     transform: scale(1.05);
   }
   
   .calendar-today {
     background: #47B2E5 !important;
     color: #ffffff !important;
     font-weight: 700 !important;
     border-radius: 8px !important;
     box-shadow: 0 2px 8px rgba(71,178,229,0.3) !important;
   }

   /* High Zoom / Accessibility Support */
   @media (min-height: 1px) and (max-height: 600px) {
     .welcome-screen {
       align-items: flex-start;
       padding: 1rem 0.5rem;
     }
     
     .welcome-content {
       min-height: auto;
       padding: 1rem 2rem 2rem 2rem;
       justify-content: flex-start;
       margin-top: 1rem;
     }
     
     .welcome-title {
       font-size: 2rem;
       margin: 1rem 0 0.5rem 0;
     }
     
     .welcome-hook {
       font-size: 0.9em !important;
       margin: 4px 0 15px 0 !important;
     }
     
     .welcome-subtitle {
       font-size: 1rem;
       margin: 0 0 20px 0;
     }
     
     .welcome-options {
       gap: 0.7rem;
       margin-bottom: 1rem;
     }
     
     .welcome-option-btn {
       padding: 1rem 1.5rem;
       font-size: 0.9rem;
     }
     
     .welcome-logo img {
       width: 60px !important;
       height: 60px !important;
       margin-bottom: 10px !important;
     }
     
     .welcome-copyright {
       padding-top: 1rem;
       font-size: 0.8rem;
     }
     
     .welcome-loading-state {
       position: relative;
       transform: none;
       top: auto;
       left: auto;
       margin: 2rem auto;
       max-width: 250px;
     }
   }

   /* Zoom extremo o pantallas muy pequeñas en altura */
   @media (max-height: 500px) {
     .welcome-screen {
       align-items: flex-start;
       padding: 0.5rem;
     }
     
     .welcome-content {
       min-height: auto;
       padding: 0.5rem 1rem 1rem 1rem;
       justify-content: flex-start;
       margin-top: 0.5rem;
     }
     
     .welcome-logo {
       margin-bottom: 10px;
     }
     
     .welcome-logo img {
       width: 50px !important;
       height: 50px !important;
       margin-bottom: 8px !important;
     }
     
     .welcome-title {
       font-size: 1.8rem;
       margin: 0.5rem 0 0.3rem 0;
     }
     
     .welcome-hook {
       font-size: 0.85em !important;
       margin: 2px 0 10px 0 !important;
     }
     
     .welcome-subtitle {
       font-size: 0.95rem;
       margin: 0 0 15px 0;
     }
     
     .welcome-options {
       gap: 0.5rem;
       margin-bottom: 0.8rem;
     }
     
     .welcome-option-btn {
       padding: 0.8rem 1.2rem;
       font-size: 0.85rem;
     }
     
     .welcome-copyright {
       padding-top: 0.5rem;
       font-size: 0.75rem;
       margin-top: 0.5rem;
     }
     
     .welcome-loading-state {
       position: relative;
       transform: none;
       top: auto;
       left: auto;
       margin: 1rem auto;
       max-width: 200px;
     }
     
     .welcome-loading-state .spinner {
       width: 24px;
       height: 24px;
       border-width: 2px;
     }
     
     .welcome-loading-state .loading-message {
       font-size: 0.8rem;
     }
   }

   /* Modal Select Version Responsive */
   @media (max-width: 768px) {
     #selectVersionModal .modal-panel {
       width: 95%;
       max-width: none;
       margin: 2rem 1rem;
       border-radius: 16px;
     }
     
     #selectVersionModal .modal-header {
       padding: 1.5rem 1.5rem 1.2rem 1.5rem;
     }
     
     #selectVersionModal .panel-header-title {
       font-size: 1.8rem;
     }
     
     #selectVersionModal .modal-header p {
       font-size: 1rem !important;
     }
     
     #selectVersionModal .welcome-logo img {
       width: 70px !important;
       height: 70px !important;
       margin-bottom: 15px !important;
     }
     
     #selectVersionModal .modal-content {
       padding: 1.5rem;
     }
     
     .version-item {
       padding: 1.2rem 1.5rem;
     }
     
     .version-name {
       font-size: 1.1rem;
     }
     
     .version-date {
       font-size: 0.9rem;
     }
     
     .version-load-btn {
       padding: 0.6rem 1.2rem;
       font-size: 0.9rem;
     }
   }

   @media (max-width: 480px) {
     #selectVersionModal .modal-panel {
       width: 98%;
       margin: 1rem 0.5rem;
       border-radius: 12px;
     }
     
     #selectVersionModal .modal-header {
       padding: 1.2rem 1rem 1rem 1rem;
     }
     
     #selectVersionModal .panel-header-title {
       font-size: 1.6rem;
     }
     
     #selectVersionModal .modal-header p {
       font-size: 0.95em !important;
     }
     
     #selectVersionModal .welcome-logo img {
       width: 60px !important;
       height: 60px !important;
       margin-bottom: 12px !important;
     }
     
     #selectVersionModal .modal-content {
       padding: 1rem;
     }
     
     .version-item {
       padding: 1rem 1.2rem;
       flex-direction: column;
       align-items: flex-start;
       gap: 1rem;
     }
     
     .version-info {
       width: 100%;
     }
     
     .version-name {
       font-size: 1rem;
     }
     
     .version-date {
       font-size: 0.85rem;
     }
     
     .version-load-btn {
       width: 100%;
       padding: 0.8rem 1rem;
       font-size: 0.9rem;
       justify-content: center;
     }
     
     .versions-list {
       max-height: 300px;
     }
     
             #versionSearchInput {
        padding: 0.8rem 1.2rem;
        font-size: 0.95rem;
      }
    }

    /* Modal High Zoom Support */
    @media (min-height: 1px) and (max-height: 700px) {
      #selectVersionModal {
        align-items: flex-start;
        padding: 0.5rem 0;
      }
      
      #selectVersionModal .modal-panel {
        margin: 0.5rem auto;
        max-height: calc(100vh - 1rem);
      }
      
      #selectVersionModal .modal-header {
        padding: 1rem 1.5rem 0.8rem 1.5rem;
      }
      
      #selectVersionModal .panel-header-title {
        font-size: 1.5rem;
      }
      
      #selectVersionModal .modal-header p {
        font-size: 0.9em !important;
      }
      
      #selectVersionModal .welcome-logo img {
        width: 60px !important;
        height: 60px !important;
        margin-bottom: 10px !important;
      }
      
      #selectVersionModal .modal-content {
        padding: 1rem 1.5rem 1.5rem 1.5rem;
      }
      
      .versions-list {
        max-height: 250px;
      }
      
      .version-item {
        padding: 1rem 1.5rem;
      }
      
      .version-name {
        font-size: 1rem;
      }
      
      .version-load-btn {
        padding: 0.5rem 1rem;
        font-size: 0.85rem;
      }
    }

      /* Ops Hub Summary Modal Styles */
  #opsSummaryModal .modal-panel {
    background: #1a2332 !important;
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
    backdrop-filter: none !important;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3) !important;
  }

  #opsSummaryModal .modal-content {
    padding: 1.5rem;
    max-height: calc(90vh - 140px);
    overflow-y: auto;
  }

  #opsSummaryModal.modal-overlay {
    background: transparent !important;
    backdrop-filter: none !important;
  }

  .summary-config-section {
    display: grid;
    grid-template-columns: 660px 1fr;
    gap: 1.5rem;
    align-items: flex-start;
  }

  .summary-header-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 1.5rem;
  }

  .summary-date-time,
  .summary-priority {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .summary-label {
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.7);
    font-weight: 500;
  }

  .summary-value {
    font-size: 1.1rem;
    color: #47B2E5;
    font-weight: 600;
  }

  .cards-selection-section {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 1.5rem;
  }

  .section-title {
    color: white;
    font-size: 1.2rem;
    font-weight: 600;
    margin: 0 0 1rem 0;
    font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
  }

  .cards-selection-controls {
    display: flex;
    gap: 0.7em;
    justify-content: stretch;
    width: 100%;
  }

  .cards-selection-controls button {
    flex: 1 1 0;
  }

  .selection-btn {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    color: white;
    padding: 0.6rem 1.2rem;
    font-size: 0.9rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
  }

  .selection-btn:hover {
    background: rgba(71, 178, 229, 0.2);
    border-color: #47B2E5;
    transform: translateY(-1px);
  }

  .cards-selection-grid {
    display: flex !important;
    flex-direction: column !important;
    gap: 1.3rem !important;
    width: 100%;
    max-height: 600px;
    overflow-y: auto;
    padding: 0.5rem 0.2rem 0.5rem 0.2rem;
  }

  .card-selection-item {
    background: rgba(255, 255, 255, 0.08);
    border: 2px solid rgba(255, 255, 255, 0.13);
    border-radius: 14px;
    padding: 1.3rem 1.5rem !important;
    margin: 0;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
    font-size: 1.15rem !important;
    min-width: 0;
    width: 100%;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .card-selection-item:hover {
    background: rgba(255, 255, 255, 0.08);
    border-color: rgba(71, 178, 229, 0.3);
    transform: translateY(-2px);
  }

  .card-selection-item.selected {
    background: rgba(71, 178, 229, 0.18);
    border-color: #47B2E5;
    box-shadow: 0 4px 15px rgba(71, 178, 229, 0.13);
  }

  .card-selection-checkbox {
    position: absolute;
    top: 0.8rem;
    right: 0.8rem;
    width: 20px;
    height: 20px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 4px;
    background: transparent;
    transition: all 0.3s ease;
  }

  .card-selection-item.selected .card-selection-checkbox {
    background: #47B2E5;
    border-color: #47B2E5;
  }

  .card-selection-item.selected .card-selection-checkbox::after {
    content: '✓';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-size: 12px;
    font-weight: bold;
  }

  .card-selection-content {
    padding-right: 2rem;
  }

  .card-selection-name {
    color: white;
    font-size: 1.18rem !important;
    font-weight: 700;
    margin-bottom: 0.2rem;
  }

  .card-selection-count {
    color: #47B2E5;
    font-size: 1.05rem !important;
    font-weight: 500;
  }

  .card-selection-status {
    display: inline-block;
    padding: 0.2rem 0.6rem;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 500;
    margin-top: 0.5rem;
  }

  .card-selection-status.active {
    background: rgba(16, 185, 129, 0.2);
    color: #10B981;
    border: 1px solid rgba(16, 185, 129, 0.3);
  }

  .card-selection-status.inactive {
    background: rgba(255, 255, 255, 0.1);
    color: rgba(255, 255, 255, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.2);
  }

  .summary-preview-section {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 1.5rem;
  }

  .summary-preview {
    background: white;
    border-radius: 8px;
    padding: 1.5rem;
    min-height: 300px;
    color: #333;
    font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    overflow-y: auto;
    max-height: 400px;
  }

  .summary-preview-header {
    text-align: center;
    margin-bottom: 2rem;
    padding-bottom: 1.5rem;
    border-bottom: 2px solid #47B2E5;
  }

  .summary-preview-title {
    font-size: 2rem;
    font-weight: 700;
    color: #1a2332;
    margin: 0 0 0.5rem 0;
  }

  .summary-preview-subtitle {
    font-size: 1.1rem;
    color: #47B2E5;
    font-weight: 500;
    margin: 0;
  }

  .summary-preview-meta {
    display: flex;
    justify-content: space-between;
    margin-bottom: 2rem;
    padding: 1rem;
    background: #f8f9fa;
    border-radius: 8px;
    font-size: 0.9rem;
  }

  .summary-preview-meta-item {
    display: flex;
    flex-direction: column;
    gap: 0.3rem;
  }

  .summary-preview-meta-label {
    font-weight: 600;
    color: #666;
  }

  .summary-preview-meta-value {
    color: #333;
  }

  .summary-preview-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
  }

  .summary-preview-card {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 10px;
    padding: 1rem;
    text-align: center;
    transition: all 0.3s ease;
  }

  .summary-preview-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  }

  .summary-preview-card-name {
    font-size: 1rem;
    font-weight: 600;
    color: #1a2332;
    margin-bottom: 0.8rem;
  }

  .summary-preview-card-count {
    font-size: 2rem;
    font-weight: 700;
    color: #47B2E5;
    margin-bottom: 0.5rem;
  }

  .summary-preview-card-label {
    font-size: 0.9rem;
    color: #666;
    font-weight: 500;
  }

  .summary-preview-footer {
    margin-top: 2rem;
    padding-top: 1.5rem;
    border-top: 1px solid #e9ecef;
    text-align: center;
    color: #666;
    font-size: 0.9rem;
  }

  .footer-actions {
    display: flex;
    gap: 1rem;
    align-items: center;
  }

  .footer-actions .modal-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  /* Dashboard Action Button Styles */
  .dashboard-action-btn {
    background: linear-gradient(135deg, #47B2E5 0%, #1976d2 100%);
    color: white;
    border: none;
    border-radius: 8px;
    padding: 0.6rem 1.2rem;
    font-size: 0.9rem;
    font-weight: 400;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif !important;
    letter-spacing: 0.03em !important;
    box-shadow: 0 2px 8px rgba(71, 178, 229, 0.3);
  }

  .dashboard-action-btn:hover {
    background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(71, 178, 229, 0.4);
  }

  .dashboard-action-btn:active {
    transform: translateY(0);
  }

  /* Dashboard Footer Styles */
  .dashboard-footer {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 1.5rem 2rem;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    background: rgba(255, 255, 255, 0.02);
    backdrop-filter: none;
  }

  .dashboard-footer .dashboard-action-btn {
    background: linear-gradient(135deg, #47B2E5 0%, #1976d2 100%);
    color: white;
    border: none;
    border-radius: 12px;
    padding: 0.8rem 1.5rem;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 0.6rem;
    font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
    box-shadow: 0 4px 12px rgba(71, 178, 229, 0.3);
    min-width: 200px;
    justify-content: center;
  }

  .dashboard-footer .dashboard-action-btn:hover {
    background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(71, 178, 229, 0.4);
  }

  .dashboard-footer .dashboard-action-btn:active {
    transform: translateY(0);
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    #opsSummaryModal .modal-panel {
      width: 98vw !important;
      max-width: none !important;
      margin: 1vh auto !important;
    }

    .summary-config-section {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }

    .summary-header-info {
      flex-direction: column;
      gap: 1rem;
      align-items: flex-start;
    }

    .cards-selection-controls {
      justify-content: center;
    }

    .cards-selection-grid {
      grid-template-columns: 1fr;
      max-height: 200px;
    }

    .summary-preview-meta {
      flex-direction: column;
      gap: 1rem;
    }

    .summary-preview-cards {
      grid-template-columns: 1fr;
    }

    .footer-actions {
      flex-direction: column;
      width: 100%;
    }

    .footer-actions .modal-btn {
      width: 100%;
      justify-content: center;
      }
    }

    /* In-App Loading Styles */
    #inAppLoader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: linear-gradient(135deg, #1a2332 0%, #1a2332 50%, #1a2332 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 8888;
      opacity: 0;
      animation: fadeInSmooth 0.2s ease-out forwards;
      padding: 2rem;
      box-sizing: border-box;
    }

    .in-app-loading-content {
      text-align: center;
      color: white;
      animation: slideUpSmooth 0.3s ease-out;
      width: 100%;
      max-width: 400px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .in-app-logo {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 2rem;
      width: 100%;
    }

    .in-app-logo img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      box-shadow: 0 8px 32px rgba(71, 178, 229, 0.4);
      animation: pulse 2s infinite;
    }

    .in-app-title {
      font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
      font-size: 2.2rem;
      font-weight: 300;
      margin: 0 0 2rem 0;
      color: #fff;
      text-shadow: 0 2px 10px rgba(0,0,0,0.3);
      letter-spacing: 0.05em;
      width: 100%;
    }

    .in-app-loading-content .loading-spinner {
      margin-bottom: 1.5rem;
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .in-app-loading-content .spinner {
      width: 32px;
      height: 32px;
      border: 3px solid rgba(71, 178, 229, 0.2);
      border-top: 3px solid #47B2E5;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }

    .loading-message {
      font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
      font-size: 1.1rem;
      color: #47B2E5;
      margin: 0;
      opacity: 0.9;
      font-weight: 400;
      width: 100%;
      text-align: center;
    }

    #inAppLoader.fade-out {
      animation: fadeOutSmooth 0.2s ease-in-out forwards;
    }

    @keyframes fadeInSmooth {
      from { 
        opacity: 0;
      }
      to { 
        opacity: 1;
      }
    }

    @keyframes slideUpSmooth {
      from {
        opacity: 0;
        transform: translateY(15px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeOutSmooth {
      from { 
        opacity: 1;
      }
      to { 
        opacity: 0;
      }
    }
</style>

<!-- SCRIPT PARA FORZAR ESTILOS CONTINUAMENTE -->
<script>
  // Función para forzar estilos en dropdowns de versiones
  function forceVersionSelectStyles() {
    const versionSelects = document.querySelectorAll('.version-select');
    versionSelects.forEach(select => {
      select.style.setProperty('background', '#E3F2FD', 'important');
      select.style.setProperty('background-color', '#E3F2FD', 'important');
      select.style.setProperty('color', '#000000', 'important');
      select.style.setProperty('border', '1px solid #47B2E5', 'important');
      
      // Forzar estilos en las opciones
      const options = select.querySelectorAll('option');
      options.forEach(option => {
        option.style.setProperty('background', '#E3F2FD', 'important');
        option.style.setProperty('background-color', '#E3F2FD', 'important');
        option.style.setProperty('color', '#000000', 'important');
      });
    });
  }

  // Función para forzar estilos en dropdowns
  function forceDropdownTextVisible() {
    // Buscar todos los dropdowns visibles
    const dropdowns = document.querySelectorAll('.excel-dropdown:not(.hidden)');
    
    dropdowns.forEach(dropdown => {
      // Forzar estilo del dropdown
      dropdown.style.setProperty('background', '#fff', 'important');
      dropdown.style.setProperty('color', '#333', 'important');
      
               // Forzar estilos en todos los elementos
       const allElements = dropdown.querySelectorAll('*');
       allElements.forEach(el => {
         if (el.tagName !== 'INPUT' || el.type !== 'checkbox') {
           el.style.setProperty('color', '#47B2E5', 'important');
           el.style.setProperty('text-shadow', 'none', 'important');
         }
       });
       
       // Forzar específicamente en labels y spans
       const labels = dropdown.querySelectorAll('label');
       labels.forEach(label => {
         label.style.setProperty('color', '#47B2E5', 'important');
         label.style.setProperty('text-shadow', 'none', 'important');
         label.style.setProperty('background', 'transparent', 'important');
       });
       
       const spans = dropdown.querySelectorAll('span');
       spans.forEach(span => {
         span.style.setProperty('color', '#47B2E5', 'important');
         span.style.setProperty('text-shadow', 'none', 'important');
         span.style.setProperty('background', 'transparent', 'important');
         span.style.setProperty('opacity', '1', 'important');
         span.style.setProperty('visibility', 'visible', 'important');
         span.setAttribute('style', 'color: #47B2E5 !important; text-shadow: none !important; background: transparent !important; opacity: 1 !important; visibility: visible !important; font-size: 0.9rem !important;');
       });
    });
  }
  
  // Ejecutar cuando se carga la página
  document.addEventListener('DOMContentLoaded', () => {
    // Ejecutar con menos frecuencia para mejor rendimiento
    setInterval(forceDropdownTextVisible, 2000); // Cambiar de 200ms a 2s
    setInterval(forceVersionSelectStyles, 2000); // Cambiar de 200ms a 2s
    
    // También ejecutar en eventos de click y focus con debounce
    let dropdownTimeout;
    document.addEventListener('click', () => {
      clearTimeout(dropdownTimeout);
      dropdownTimeout = setTimeout(forceDropdownTextVisible, 100);
    });
    document.addEventListener('focus', () => {
      clearTimeout(dropdownTimeout);  
      dropdownTimeout = setTimeout(forceDropdownTextVisible, 100);
    }, true);
    
    let versionTimeout;
    document.addEventListener('click', () => {
      clearTimeout(versionTimeout);
      versionTimeout = setTimeout(forceVersionSelectStyles, 100);
    });
    document.addEventListener('focus', () => {
      clearTimeout(versionTimeout);
      versionTimeout = setTimeout(forceVersionSelectStyles, 100);
    }, true);
    
    // MUTATION OBSERVER OPTIMIZADO PARA DROPDOWNS
    let observerTimeout;
    const globalObserver = new MutationObserver((mutations) => {
      // Usar debounce para evitar ejecuciones muy frecuentes
      clearTimeout(observerTimeout);
      observerTimeout = setTimeout(() => {
        let shouldUpdate = false;
        mutations.forEach((mutation) => {
          if (mutation.type === 'childList') {
            mutation.addedNodes.forEach((node) => {
              if (node.nodeType === Node.ELEMENT_NODE) {
                // Solo verificar si es específicamente un dropdown
                if (node.classList && (node.classList.contains('excel-dropdown') || node.classList.contains('excel-checkbox-list'))) {
                  shouldUpdate = true;
                }
                
                // Buscar dropdowns solo si el nodo podría contenerlos
                if (node.querySelector && (node.classList.contains('table') || node.id === 'tableContainer')) {
                  const dropdowns = node.querySelectorAll('.excel-dropdown, .excel-checkbox-list');
                  if (dropdowns.length > 0) {
                    shouldUpdate = true;
                  }
                }
              }
            });
          }
        });
        
        if (shouldUpdate) {
          forceDropdownTextVisible();
        }
      }, 250); // Debounce de 250ms
    });
    
    // Observar solo el contenedor de la tabla en lugar de todo el documento
    const tableContainer = document.getElementById('tableContainer');
    if (tableContainer) {
      globalObserver.observe(tableContainer, {
        childList: true,
        subtree: true
      });
    }
  });
</script>

<!-- Estilos para logos de modales (NO afectan welcome screen) -->
<style>
  .modal-logo,
  .toolbar-png-logo {
    border-radius: 16px !important;
    box-shadow: none !important;
    filter: none !important;
    background: #E3F2FD !important;
    object-fit: cover !important;
  }
</style>

<style>
  .summary-config-section {
    display: flex !important;
    flex-direction: column !important;
    gap: 1.5rem;
    align-items: stretch;
    width: 100%;
  }
  .cards-selection-section,
  .report-options-section,
  .summary-preview-section {
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
    box-sizing: border-box;
    margin: 0 auto 1.2rem auto !important;
    padding: 1.5rem 0.5rem;
  }
  .summary-preview {
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
    box-sizing: border-box;
    padding: 1.5rem 0.5rem;
    margin: 0 auto;
  }
</style>

<style>
  select.card-view-type, select.card-saved-view {
    background: #1a2332 !important;
    color: #47B2E5 !important;
    border: 1.5px solid #47B2E5 !important;
    border-radius: 6px !important;
    font-size: 1rem !important;
    min-width: 220px !important;
    padding: 0.5rem 2.2rem 0.5rem 1rem !important;
    box-shadow: none !important;
    appearance: none !important;
    -webkit-appearance: none !important;
    -moz-appearance: none !important;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2347B2E5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6,9 12,15 18,9'%3E%3C/polyline%3E%3C/svg%3E") !important;
    background-repeat: no-repeat !important;
    background-position: right 0.7rem center !important;
    background-size: 1.2em !important;
    transition: border-color 0.2s;
  }
  select.card-view-type:focus, select.card-saved-view:focus {
    outline: none !important;
    border-color: #5AC8FA !important;
    box-shadow: 0 0 0 2px rgba(71, 178, 229, 0.18) !important;
  }
  select.card-view-type option, select.card-saved-view option {
    background: #1a2332 !important;
    color: #47B2E5 !important;
    font-size: 1rem !important;
  }
</style>
</head> 
<body>

<!-- Welcome Screen - DISEÑO NUEVO DESDE CERO -->
<div id="welcomeScreen" style="display: none;">
  <div class="welcome-container">
    <div class="welcome-logo">
      <img src="LOGOTAB_rounded.png" alt="The Bridge Logo">
    </div>
    
    <h1 class="welcome-title">The Bridge</h1>
    <p class="welcome-subtitle">Innovation starts inside</p>
    
    <div class="welcome-buttons">
      <button id="onedriveLoginBtn" class="welcome-btn">
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="currentColor"/>
        </svg>
        <div class="welcome-btn-text">
          <div class="welcome-btn-title">Connect with OneDrive</div>
          <div class="welcome-btn-desc">Your data, always available</div>
        </div>
      </button>
      
      <button id="guestLoginBtn" class="welcome-btn">
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="currentColor"/>
        </svg>
        <div class="welcome-btn-text">
          <div class="welcome-btn-title">Local Access</div>
          <div class="welcome-btn-desc">Fast, secure local access</div>
        </div>
      </button>
    </div>
    
    <div class="welcome-footer" title="Built with relentless passion and countless sleepless nights. Every line of code was crafted with the vision of empowering you to do extraordinary work. Thank you for being part of this journey.">
      © 2025 | Pablo Beneitez | Valencia
    </div>
    
    <div id="csvLoadingBar"></div>
  </div>
</div>

<div class="toolbar" style="padding:0;">
  <div class="toolbar-logo">
    <img src="LOGOTAB_rounded.png" alt="Logo" class="toolbar-png-logo" style="padding:0;margin:0;height:40px;vertical-align:middle;margin-right:10px;" />
    <span class="thebridge-title">The Bridge</span>
  </div>

  <div class="toolbar-right" style="margin-left:1rem;">
    <button id="showHiddenColumnsBtn" class="toolbar-button show-hidden-columns-btn" title="Show hidden columns" style="color:#10B981;display:none;">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
        <rect x="3" y="5" width="4" height="14" rx="1" fill="currentColor"/>
        <rect x="9" y="5" width="4" height="14" rx="1" fill="currentColor"/>
        <rect x="15" y="5" width="4" height="14" rx="1" fill="currentColor"/>
        <path d="M2 2l20 20" stroke="#10B981" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </button>
    <div id="dateTimeInfo" style="height:36px; font-size:14px; color:#000000; font-weight:400; cursor:pointer; position:relative; display:flex; align-items:center; justify-content:center; border-radius:6px; background: rgba(255, 255, 255, 0.7); border: 1px solid rgba(0, 0, 0, 0.2); padding: 0 12px; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); box-sizing: border-box; min-width: 150px;">
      <span id="weekNumberDisplay" style="margin-right:0.5em; color:#000000; white-space:nowrap; display:flex; align-items:center; line-height:1;">Week --</span>
      <svg id="calendarIcon" width="18" height="18" viewBox="0 0 24 24" fill="none" style="vertical-align:middle; margin-right:0.4em; flex-shrink:0;"><rect x="3" y="5" width="18" height="16" rx="2" stroke="#000000" stroke-width="2"/><path d="M16 3v4M8 3v4M3 9h18" stroke="#000000" stroke-width="2"/><path d="M9 13h6" stroke="#000000" stroke-width="2" stroke-linecap="round"/></svg>
      <svg id="chevronIcon" width="16" height="16" viewBox="0 0 20 20" fill="none" style="vertical-align:middle; flex-shrink:0;"><path d="M6 8l4 4 4-4" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      <div id="calendarPopup" style="display:none; position:absolute; left:0; top:calc(100% + 6px); z-index:2000;"></div>
    </div>

    <div class="search-container">
      <input 
        type="text" 
        id="globalSearchInput" 
        placeholder="Track..." 
        class="search-input"
        aria-label="Global search"
        tabindex="0"
        style="background: rgba(255, 255, 255, 0.7); color: #000000; border: 1px solid rgba(0, 0, 0, 0.2); border-radius: 6px; padding: 8px 12px; font-size: 14px; width: 300px; outline: none; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);"
      >
    </div>
    <div class="view-controls">
      <select id="viewSelect" class="toolbar-select" aria-label="Select view" style="height:36px; background: rgba(255, 255, 255, 0.7); color: #000000; border: 1px solid rgba(0, 0, 0, 0.2); border-radius: 6px; padding: 0 12px; font-size: 14px; min-width: 150px; outline: none; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); cursor: pointer; box-sizing: border-box; font-weight:400;"
      >
        
      </select>
    </div>
  </div>
</div>



  <div class="app-container">
  <aside class="sidebar" id="sidebar">
      <div class="sidebar-content">
        <!-- HEADER FIXO - Información del equipo y último CSV -->
        <div class="sidebar-header">
          <div id="teamInfo" style="display:none; margin-bottom:0.3rem; padding:0.6rem; background:rgba(255, 255, 255, 0.08); border-radius:6px; border:1px solid rgba(255, 255, 255, 0.15); box-shadow:0 2px 8px rgba(0, 0, 0, 0.1);">
            <div style="color:#000000; font-weight:600; font-size:0.95rem; margin-bottom:0.3rem;" id="currentTeamName">Team Name</div>
            <!-- Storage type indicator -->
            <div id="storageIndicator" class="storage-indicator" style="display:none;"></div>
            <!-- Información del último CSV cargado -->
            <div id="sidebarLastCsvInfo" style="display:none; color:#10B981; font-size:0.8rem; margin-bottom:0.3rem; padding:0.2rem 0.4rem; border-radius:4px; border:1px solid rgba(16, 185, 129, 0.3); background:rgba(16, 185, 129, 0.1);">
              <div style="display:flex; align-items:center; gap:0.3rem; margin-bottom:0.2rem;">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="2" fill="none"/>
                  <polyline points="14,2 14,8 20,8" stroke="currentColor" stroke-width="2"/>
                  <line x1="16" y1="13" x2="8" y2="13" stroke="currentColor" stroke-width="2"/>
                </svg>
                <span style="font-weight:500;">Last CSV:</span>
              </div>
              <div id="sidebarLastCsvText" style="font-size:0.75rem; opacity:0.9;">--</div>
            </div>
            
          </div>
        </div>

        <!-- CONTENIDO SCROLLABLE - Botones de navegación -->
        <div class="sidebar-scrollable">
          <button id="dashboardToggleBtn" class="sidebar-button" style="margin-bottom:0 !important;">
            <svg viewBox="0 0 24 24" style="width:1.2em;height:1.2em;transition:transform 0.2s ease;">
              <path d="M3 13H11V3H3V13ZM3 21H11V15H3V21ZM13 21H21V11H13V21ZM13 3V9H21V3H13Z" fill="currentColor"/>
            </svg>
            Operations Hub
          </button>
          <div class="sidebar-separator" style="margin:0.1rem 0 !important;"></div>
          
          <button id="opsDashboardToggleBtn" class="sidebar-button" style="margin-bottom:0 !important;padding:0.65rem 0.85rem !important;font-size:0.95rem !important;font-weight:600 !important;">
            <svg viewBox="0 0 24 24" style="width:1.2em;height:1.2em;transition:transform 0.2s ease;">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="currentColor"/>
            </svg>
            Ops Hub Manager
          </button>
          <div class="sidebar-separator" style="margin:0.1rem 0 !important;"></div>
          
          <button id="dataQualityBtn" class="sidebar-button" style="margin-bottom:0 !important;background:rgba(139, 92, 246, 0.15) !important;background-color:rgba(139, 92, 246, 0.15) !important;border-color:rgba(139, 92, 246, 0.3) !important;border-width:1.5px !important;border-radius:8px !important;padding:0.65rem 0.85rem !important;font-size:0.95rem !important;font-weight:600 !important;box-shadow:0 2px 4px rgba(139, 92, 246, 0.1) !important;">
            <svg viewBox="0 0 24 24" style="width:1.25em;height:1.25em;transition:transform 0.2s ease;">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="currentColor"/>
            </svg>
            Data Quality
          </button>
          <div class="sidebar-separator" style="margin:0.1rem 0 !important;"></div>
          
          <button id="bookingDashboardToggleBtn" class="sidebar-button" style="margin-bottom:0 !important;background:rgba(245, 158, 11, 0.15) !important;background-color:rgba(245, 158, 11, 0.15) !important;border-color:rgba(245, 158, 11, 0.3) !important;border-width:1.5px !important;border-radius:8px !important;padding:0.65rem 0.85rem !important;font-size:0.95rem !important;font-weight:600 !important;box-shadow:0 2px 4px rgba(245, 158, 11, 0.1) !important;">
            <svg viewBox="0 0 24 24" style="width:1.25em;height:1.25em;transition:transform 0.2s ease;">
              <path d="M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V10h14v10zm0-12H5V6h14v2z" fill="currentColor"/>
            </svg>
            Booking Hub
          </button>
          <div class="sidebar-separator" style="margin:0.1rem 0 !important;"></div>
          
          <button id="ordersHubBtn" class="sidebar-button" style="margin-bottom:0 !important;background:rgba(16, 185, 129, 0.15) !important;background-color:rgba(16, 185, 129, 0.15) !important;border-color:rgba(16, 185, 129, 0.3) !important;border-width:1.5px !important;border-radius:8px !important;padding:0.65rem 0.85rem !important;font-size:0.95rem !important;font-weight:600 !important;box-shadow:0 2px 4px rgba(16, 185, 129, 0.1) !important;">
            <svg viewBox="0 0 24 24" style="width:1.25em;height:1.25em;transition:transform 0.2s ease;">
              <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z" fill="currentColor"/>
            </svg>
            Orders Hub
          </button>
          <div class="sidebar-separator" style="margin:0.2rem 0 !important;"></div>
          
          <button id="columnsBtn" class="sidebar-button" style="margin-bottom:0 !important;padding:0.65rem 0.85rem !important;font-size:0.95rem !important;font-weight:600 !important;">
            <svg viewBox="0 0 24 24" style="width:1.2em;height:1.2em;transition:transform 0.2s ease;"><rect x="4" y="4" width="3" height="16" fill="CurrentColor"/><rect x="10.5" y="4" width="3" height="16" fill="CurrentColor"/><rect x="17" y="4" width="3" height="16" fill="CurrentColor"/></svg>
            Columns
          </button>
          <div class="sidebar-separator" style="margin:0.1rem 0 !important;"></div>
          <button id="compareCSVBtn" class="sidebar-button" style="margin-bottom:0 !important;padding:0.65rem 0.85rem !important;font-size:0.95rem !important;font-weight:600 !important;">
            <svg viewBox="0 0 24 24" style="width:1.2em;height:1.2em;transition:transform 0.2s ease;">
              <path d="M9 17l6-6-6-6" stroke="CurrentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M3 12h18" stroke="CurrentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            Data Comparison
          </button>
          <div class="sidebar-separator" style="margin:0.1rem 0 !important;"></div>
          <button id="openCustomSummaryBtn" class="sidebar-button" style="margin-bottom:0 !important;padding:0.65rem 0.85rem !important;font-size:0.95rem !important;font-weight:600 !important;">
            <svg viewBox="0 0 24 24" style="width:1.2em;height:1.2em;transition:transform 0.2s ease;"><path d="M4 17h4v-6H4v6zm6 0h4V7h-4v10zm6 0h4v-3h-4v3z" fill="CurrentColor"/></svg>
            Custom Summary
          </button>
          <div class="sidebar-separator" style="margin:0.1rem 0 !important;"></div>
          <input 
            type="file" 
            id="csvFileInput" 
            accept=".csv" 
            class="hidden"
            aria-label="Select CSV file"
          >
          <button id="uploadCsvFileBtn" class="sidebar-button" style="margin-bottom:0 !important;padding:0.65rem 0.85rem !important;font-size:0.95rem !important;font-weight:600 !important;">
            <svg viewBox="0 0 24 24" style="width:1.2em;height:1.2em;transition:transform 0.2s ease;"><path d="M12 16v-8M8 12l4 4 4-4" stroke="CurrentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><rect x="4" y="4" width="16" height="16" rx="2" fill="none" stroke="CurrentColor" stroke-width="2"/></svg>
            Upload CSV File
          </button>
          <div class="sidebar-separator" style="margin:0.1rem 0 !important;"></div>
          <button id="userSetUpBtn" class="sidebar-button" style="margin-bottom:0 !important;padding:0.65rem 0.85rem !important;font-size:0.95rem !important;font-weight:600 !important;">
            <svg viewBox="0 0 24 24" style="width:1.2em;height:1.2em;transition:transform 0.2s ease;"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" fill="currentColor"/></svg>
            User Set Up
          </button>
          <div class="sidebar-separator" style="margin:0.1rem 0 !important;"></div>
          
          <!-- Filters Section -->
          <button id="toggleFiltersBtn" class="sidebar-button" style="margin-bottom:0 !important;background:rgba(236, 72, 153, 0.15) !important;background-color:rgba(236, 72, 153, 0.15) !important;border-color:rgba(236, 72, 153, 0.3) !important;border-width:1.5px !important;border-radius:8px !important;padding:0.65rem 0.85rem !important;font-size:0.95rem !important;font-weight:600 !important;box-shadow:0 2px 4px rgba(236, 72, 153, 0.1) !important;">
            <svg viewBox="0 0 24 24" style="width:1.2em;height:1.2em;transition:transform 0.2s ease;">
              <path d="M4 6H20M8 12H16M10 18H14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            Filters
          </button>
          <button id="resetFiltersSidebarBtn" class="sidebar-button" style="margin-bottom:0 !important;background:rgba(239, 68, 68, 0.1) !important;background-color:rgba(239, 68, 68, 0.1) !important;border-color:rgba(239, 68, 68, 0.25) !important;border-width:1.5px !important;border-radius:8px !important;padding:0.65rem 0.85rem !important;font-size:0.95rem !important;font-weight:600 !important;box-shadow:0 2px 4px rgba(239, 68, 68, 0.1) !important;margin-top:0.3rem !important;">
            <svg viewBox="0 0 24 24" style="width:1.2em;height:1.2em;transition:transform 0.2s ease;">
              <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
              <path d="M21 3v5h-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
              <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
              <path d="M3 21v-5h5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
            </svg>
            Reset Filters
          </button>
          <div class="sidebar-separator" style="margin:0.1rem 0 !important;"></div>
          <button id="teamManagementBtn" class="sidebar-button" style="margin-bottom:0.1rem;display:none !important;">
            <svg viewBox="0 0 24 24" style="width:1.2em;height:1.2em;"><path d="M16 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2zm4 18v-6h2.5l-2.54-7.63A1.5 1.5 0 0 0 18.54 8H17c-.8 0-1.54.37-2.01 1l-1.7 2.26A6.003 6.003 0 0 0 10 16v6h2v-6c0-2.21 1.79-4 4-4s4 1.79 4 4v6h2zm-8-2v-6c0-2.21-1.79-4-4-4s-4 1.79-4 4v6h2v-6c0-1.1.9-2 2-2s2 .9 2 2v6h2z" fill="currentColor"/></svg>
            Create Team
          </button>
        </div>

        <!-- FOOTER FIXO - Copyright -->
        <div class="sidebar-footer">
          <div style="text-align:center;font-size:0.9em;color:#000000;opacity:0.7;user-select:none;cursor:default;font-weight:400;letter-spacing:0.3px;font-family:'Roboto', 'Segoe UI', Arial, sans-serif;" id="legalNoticeTrigger" title="Built with relentless passion and countless sleepless nights. Every line of code was crafted with the vision of empowering you to do extraordinary work. Thank you for being part of this journey.">© 2025 | Pablo Beneitez | Valencia</div>
        </div>
      </div>
    
    </aside>

  <main class="main-content">

    <div id="mainTabsBar" class="main-tabs-bar" style="display:flex;justify-content:space-between;align-items:center;margin:0.1em 0 0 0;width:100%;"></div>

    <!-- TABS CONTAINER PARA WORKSPACES -->
    <div id="tableTabsContainer" class="table-tabs-container">
      <div id="tableTabs" class="table-tabs">
        <!-- Aquí se añadirán dinámicamente las pestañas editables -->
      </div>
    </div>
    <!-- FIN TABS CONTAINER -->

    <div id="tableContainer" class="table-container" style="border: 1px solid rgba(0,0,0,0.3) !important; background: var(--sidebar-bg) !important; box-shadow: 0 4px 6px rgba(0,0,0,0.1) !important; border-radius: 12px !important; box-sizing: border-box !important;"></div>
    <div class="table-toolbar">
      <div class="toolbar-left">
      <label class="rows-per-page-control">
          
          <select id="rowsPerPageSelect" aria-label="Select number of rows per page">
          <option value="20">20</option>
          <option value="50" selected>50</option>
          <option value="100">100</option>
          <option value="200">200</option>
          <option value="-1">All</option>
        </select>
      </label>
      <div id="pagination" class="pagination"></div>
      </div>
      <div class="toolbar-right">
        <div class="action-tabs">
          <button id="copyTableBtn" class="tab-btn" title="Copy Table">
            <svg width="18" height="18" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" fill="currentColor"/></svg>
            <span>Copy</span>
          </button>
          <button id="copySummaryBtnToolbar" class="tab-btn" title="Copy Summary">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M8 2v2H6a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-2V2h-4zm0 2h8v2H8V4zm0 4h8v2H8V8zm0 4h8v2H8v-2zm0 4h8v2H8v-2z" fill="currentColor"/></svg>
            <span>Copy Summary</span>
          </button>

          <button id="createEditableTabBtn" class="tab-btn" title="New Tab">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M3 17.25V21h3.75l11.06-11.06-3.75-3.75L3 17.25zM20.71 7.04a1.003 1.003 0 0 0 0-1.42l-2.34-2.34a1.003 1.003 0 0 0-1.42 0l-1.83 1.83 3.75 3.75 1.84-1.82z" fill="currentColor"/></svg>
            <span>New Tab</span>
          </button>
          <button id="resetAllFiltersBtn" class="tab-btn" title="Clear Filters">
            <svg width="18" height="18" viewBox="0 0 24 24"><path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6 0 1.3-.42 2.5-1.13 3.47l1.46 1.46C19.07 16.07 20 14.13 20 12c0-4.42-3.58-8-8-8zm-6.87 3.53L3.67 7.07C2.93 7.93 2 9.87 2 12c0 4.42 3.58 8 8 8v4l5-5-5-5v4c-3.31 0-6-2.69-6-6 0-1.3.42-2.5 1.13-3.47z" fill="currentColor"/></svg>
            <span>Clear Filters</span>
          </button>
          <button id="exportTableToExcelBtn" class="tab-btn" title="Export to Excel">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-1 16H6c-.55 0-1-.45-1-1V6c0-.55.45-1 1-1h12c.55 0 1 .45 1 1v12c0 .55-.45 1-1 1z" fill="currentColor"/></svg>
            <span>Export to Excel</span>
          </button>
          <!-- <button id="removeDuplicatesBtn" class="tab-btn" title="Remove Duplicates">
            <svg width="18" height="18" viewBox="0 0 24 24"><path d="M19 13H5v-2h14v2zm-7-8c-4.42 0-8 3.58-8 8s3.58 8 8 8 8-3.58 8-8-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6z" fill="currentColor"/></svg>
            <span>Deduplicate</span>
          </button> -->
        </div>
      </div>
      <div class="toolbar-right">
      <span id="recordCount"></span>
      </div>
    </div>

    <!-- Notification element -->
    <div id="tableNotification" class="table-notification hidden">
      <div class="notification-content">
        <span id="notificationMessage"></span>
        <button class="notification-close">X</button>
      </div>
    </div>
  </main>
  </div>

<!-- Column Manager Modal -->
<div id="columnManagerModal" class="modal-overlay hidden">
  <div class="modal-panel" style="max-width:900px;">
    <div class="modal-header">
      <div class="header-left">
        <img src="LOGOTAB_rounded.png" alt="Logo" class="modal-logo">
        <h3 class="panel-header-title dashboard-title" style="margin:0;font-size:2rem;">Column Management</h3>
      </div>
      <button id="closeColumnManagerBtn" class="close-btn">X</button>
    </div>
    <div class="modal-content">

      
      <input type="text" id="columnSearchInput" class="input" placeholder="Search columns..." style="margin-bottom: 1rem; width: 100%;" />
      <div id="columnList" class="column-list"></div>
    </div>
    <div class="modal-footer">
      <button id="selectAllBtn" class="modal-btn secondary small uniform">Select All</button>
      <button id="deselectAllBtn" class="modal-btn secondary small uniform">Deselect All</button>
      <button id="saveViewBtn" class="modal-btn secondary small uniform">Save as View</button>
      <button id="manageViewsBtn" class="modal-btn secondary small uniform manage-views-btn">Manage Views</button>
      <button id="refreshViewsBtn" class="modal-btn secondary small uniform" title="Refresh Saved Views" style="font-size: 0.85em; padding: 0.5rem 0.8rem;">
        Refresh
      </button>

      <button id="saveBtn" class="modal-btn primary">Apply</button>
    </div>
  </div>
</div>

  <!-- Manage Views Dialog -->
  <div id="manageViewsDialog" class="modal-overlay hidden">
    <div class="modal-panel">
      <div class="modal-header">
        <div class="header-left">
          <img src="LOGOTAB_rounded.png" alt="Logo" class="modal-logo">
          <h3 class="panel-header-title dashboard-title" style="margin:0;font-size:2rem;">Saved Views Manager</h3>
        </div>
        <button class="close-btn" id="closeManageViewsBtn">X</button>
      </div>
    <div class="modal-content">
      <div class="saved-views-list" id="savedViewsList"></div>
        </div>
      </div>
    </div>

<!-- Analytics Dashboard Panel - Desactivado por rendimiento -->
<!--
<div id="analyticsDashboardOverlay" class="analytics-overlay hidden">
  <div class="analytics-panel">
    <div class="analytics-header">
      <div class="analytics-title">
        <h2>Analytics Dashboard</h2>
        <span class="subtitle">Real-time data insights and trends</span>
      </div>
      <div class="analytics-header-actions">
        <button class="analytics-header-btn" id="analyticsSnapshotBtn">
          <span>Snapshot</span>
        </button>
        <button class="analytics-header-btn" id="analyticsExportBtn">
          <span>Export</span>
        </button>
        <button class="analytics-header-btn" id="analyticsConfigBtn">
          <span>Settings</span>
        </button>
        <button class="analytics-close-btn" id="analyticsDashboardCloseBtn">X</button>
      </div>
    </div>
    
    <div class="analytics-content" id="analyticsDashboardContent">
      <div id="analyticsKpis" class="analytics-kpis-section"></div>
      <div id="analyticsFiltersInfo" class="analytics-filters-section"></div>
      <div id="analyticsChartsContainer" class="analytics-charts-section"></div>
      <div id="analyticsSnapshotsSummary" class="analytics-snapshots-section"></div>
      <div id="analyticsQuickActions" class="analytics-quick-actions-section"></div>
    </div>
  </div>
</div>
-->

<!-- Overlays -->
<div id="overlay" class="overlay hidden"></div>
<div id="rightOverlay" class="right-overlay hidden"></div>

<!-- Filter Modal -->
<div id="filterModal" class="hidden">
  <div class="modal-header">
    <div class="header-left" style="display:flex;align-items:center;gap:1rem;flex:1;">
      <img src="LOGOTAB_rounded.png" alt="Logo" class="modal-logo" style="width:48px;height:48px;border-radius:8px;box-shadow:0 4px 12px rgba(71, 178, 229, 0.3);">
      <h2 class="panel-header-title dashboard-title" style="margin:0;font-size:1.5rem;">Advanced Filters</h2>
    </div>
         <button id="closeFilterModalBtn" class="close-btn">X</button>
  </div>
  
  <!-- Filter Tabs -->
  <div class="filter-tabs">
    <button class="filter-tab" data-target="active">Active Filters</button>
    <button class="filter-tab" data-target="myfilters">My Filters</button>
    <button class="filter-tab" data-target="generic">By Ref/Status</button>
    <button class="filter-tab" data-target="reference">Reference</button>
    <button class="filter-tab" data-target="date">Dates</button>
  </div>
  <div id="activeFiltersSummary" class="active-filters-summary" style="margin: 0.5rem 0 0.5rem 0;"></div>

  <!-- Filter Panels -->
  <div class="filter-panels">
    <div id="activeFilterPanel" class="filter-panel"></div>
    <div id="myfiltersFilterPanel" class="filter-panel"></div>
    <div id="genericFilterPanel" class="filter-panel"></div>
    <div id="referenceFilterPanel" class="filter-panel"></div>
    <div id="dateFilterPanel" class="filter-panel"></div>
  </div>
  
  <!-- Filter Actions -->
  <div class="filter-actions">
    <button id="resetFiltersBtn" class="btn btn-secondary">Reset</button>
    <button id="applyFiltersBtn" class="btn btn-primary">Apply Filters</button>
  </div>
  
  <!-- Filter Actions Bottom Right -->
  <div class="filter-actions-bottom">
    <button id="resetFiltersBtnBottom" class="filter-action-btn filter-reset-btn-bottom">Reset Filters</button>
    <button id="applyFiltersBtnBottom" class="filter-action-btn filter-apply-btn-bottom">Apply Filters</button>
  </div>
</div>

<div id="filterModalOverlay" class="hidden" style="background:transparent;backdrop-filter:none;-webkit-backdrop-filter:none;"></div>

<!-- Filter Block Template -->
<template id="filterBlockTemplate">
  <div class="filter-block">
      <div class="filter-title"></div>
      <button class="filter-reset-btn">✕</button>
    </div>
    <div class="filter-content"></div>
  </div>
</template>

<!-- Date Filter Template -->
<template id="dateFilterTemplate">
  <div class="date-filter-group">
    <div class="date-filter-input">
      <label class="date-filter-label">From</label>
      <input type="date" class="filter-input date-start">
    </div>
    <div class="date-filter-input">
      <label class="date-filter-label">To</label>
      <input type="date" class="filter-input date-end">
    </div>
  </div>
  <div class="filter-input-group">
    <button class="filter-btn secondary empty-toggle">Empty</button>
    <button class="filter-btn secondary today-toggle">From Today</button>
  </div>
</template>

<!-- Reference Filter Template -->
<template id="referenceFilterTemplate">
  <div class="filter-input-group">
    <input type="text" class="filter-input reference-input" placeholder="Search...">
  </div>
  <div class="filter-suggestions hidden"></div>
  <div class="filter-tags"></div>
</template>

<!-- Report Options Modal -->
<div id="reportOptionsModal" class="modal-overlay hidden">
  <div class="modal-panel">
    <div class="modal-header">
      <div class="header-left">
        <img src="LOGOTAB_rounded.png" alt="Logo" class="modal-logo">
        <h3 class="panel-header-title dashboard-title" style="margin:0;font-size:2rem;">Report Generation</h3>
      </div>
      <button id="closeReportOptionsBtn" class="close-btn">X</button>
    </div>
    <div class="modal-content">
      <div class="report-options">
        <div class="report-option" data-type="pdf">
          <div class="option-icon">
            <svg viewBox="0 0 24 24">
              <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z" fill="currentColor"/>
            </svg>
          </div>
          <div class="option-details">
            <h4>PDF Report</h4>
            <p>Complete report with tables and charts</p>
          </div>
        </div>
        <div class="report-option" data-type="excel">
          <div class="option-icon">
            <svg viewBox="0 0 24 24">
              <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-1 16H6c-.55 0-1-.45-1-1V6c0-.55.45-1 1-1h12c.55 0 1 .45 1 1v12c0 .55-.45 1-1 1z" fill="currentColor"/>
            </svg>
          </div>
          <div class="option-details">
            <h4>Excel Export</h4>
            <p>Raw data in Excel format</p>
          </div>
        </div>
        <div class="report-option" data-type="copy">
          <div class="option-icon">
            <svg viewBox="0 0 24 24">
              <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" fill="currentColor"/>
            </svg>
          </div>
          <div class="option-details">
            <h4>Copy to Clipboard</h4>
            <p>Copy data to clipboard for pasting</p>
          </div>
        </div>
      </div>
      <div class="dedupe-section" style="margin-top:1.5rem;">
        <label style="font-weight:600;">Remove duplicates by column:</label>
        <select id="dedupeColumnsSelect" multiple class="dedupe-columns-select" style="width:100%; min-width:200px;"></select>
        <div style="font-size:12px; color:#888; margin-top:0.25rem;">Only one row will be included for each unique combination of the selected columns.</div>
      </div>
    </div>
    <div class="modal-footer">
      <button id="confirmGenerateReportBtn" class="modal-btn primary">Generate</button>
    </div>
  </div>
</div>

<!-- Dashboard Modal -->
<div id="dashboardModal" class="modal-overlay hidden">
  <div class="modal-panel dashboard-panel"
     style="background:#E3F2FD !important; background-color:#E3F2FD !important; backdrop-filter:none !important; -webkit-backdrop-filter:none !important; border:1px solid rgba(0,0,0,0.1) !important; max-width:1400px !important; width:95vw !important; max-height:85vh !important; height:auto !important; margin:7.5vh auto !important; display:flex; flex-direction:column; align-items:center; justify-content:center;">
    <div class="modal-header dashboard-header" style="display:flex; align-items:center; justify-content:space-between; position:relative; padding:1.5rem 2rem 1.5rem 2rem; width:100%; box-sizing:border-box;">
      <div class="header-left" style="display:flex; align-items:center; gap:1rem;">
        <img src="./LOGOTAB_rounded.png" alt="Logo" class="modal-logo" style="width:48px;height:48px;border-radius:8px;box-shadow:0 4px 12px rgba(71,178,229,0.3);" onerror="console.error('Error loading logo:', this.src);">
        <h3 class="panel-header-title dashboard-title" style="margin:0;font-size:2rem;color:#000000;">Operations Hub</h3>
      </div>
      <button id="dashboardCloseBtn" class="close-btn" style="position:static;">X</button>
    </div>
    <div class="modal-content dashboard-body">
      <!-- Bloque unificado de Operations metrics y quick cards -->
      <div style="border-radius:18px; background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.10); padding:0.5rem 1rem 0.7rem 1rem; margin-bottom:1.2rem;">

        <div style="background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15); border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); padding: 1.1rem 1.5rem 1.1rem 1.5rem; margin-bottom: 1.2rem; display: flex; flex-direction: column; align-items: center; gap: 0.7rem; width:100%;">
          <h4 class="dashboard-section-title" style="margin:0 0 0.5rem 0; min-width:180px; width:100%; text-align:center;">Operations Metrics</h4>
          <div class="urgency-cards-container" style="margin:0; gap:1.5rem; justify-content:center; width:100%; display:flex; flex-wrap:wrap;">
            <!-- Cards de urgencia se generan dinámicamente -->
          </div>
        </div>
        <div style="width:100%;height:2px;background:rgba(71,178,229,0.35);border-radius:2px;margin:0.7rem 0 1.1rem 0;"></div>
        <div class="dashboard-quickfilters" style="margin-top:0;">
          <div class="quickfilters-grid">
            <!-- Los contenedores de filtros se generan dinámicamente -->
          </div>
        </div>
      </div>
      
      <!-- Dashboard Footer with Actions -->
      <!-- Eliminado: Footer con botón Generate Summary Report duplicado -->
    </div>
    <div class="dashboard-footer" style="display:flex; justify-content:flex-end; align-items:center; padding:1.5rem 2rem; border-top:1px solid rgba(255,255,255,0.1); background:rgba(255,255,255,0.02); width:100%; box-sizing:border-box;">
      <button id="generateOpsSummaryBtn" class="dashboard-action-btn" title="Generate Summary Report">
        Generate Summary Report
      </button>
    </div>
  </div>
</div>

<!-- DQ Hub Modal -->
<div id="dqDashboardModal" class="modal-overlay hidden">
  <div class="modal-panel dashboard-panel"
     style="background:#E3F2FD !important; background-color:#E3F2FD !important; backdrop-filter:none !important; -webkit-backdrop-filter:none !important; border:1px solid rgba(0,0,0,0.1) !important; max-width:1400px !important; width:95vw !important; max-height:85vh !important; height:auto !important; margin:7.5vh auto !important; display:flex; flex-direction:column; align-items:center; justify-content:center;">
    <div class="modal-header dashboard-header" style="display:flex; align-items:center; justify-content:space-between; position:relative; padding:1.5rem 2rem 1.5rem 2rem; width:100%; box-sizing:border-box;">
      <div class="header-left" style="display:flex; align-items:center; gap:1rem;">
        <img src="./LOGOTAB_rounded.png" alt="Logo" class="modal-logo" style="width:48px;height:48px;border-radius:8px;box-shadow:0 4px 12px rgba(71,178,229,0.3);" onerror="console.error('Error loading logo:', this.src);">
        <h3 class="panel-header-title dashboard-title" style="margin:0;font-size:2rem;">Data Quality Hub</h3>
      </div>
      <button id="dqDashboardCloseBtn" class="close-btn" style="position:static;">X</button>
    </div>
    <div class="modal-content dashboard-body">
      <!-- Bloque unificado de DQ metrics y quick cards -->
      <div style="border-radius:18px; background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.10); padding:0.5rem 1rem 0.7rem 1rem; margin-bottom:1.2rem;">

        <div style="background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15); border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); padding: 1.1rem 1.5rem 1.1rem 1.5rem; margin-bottom: 1.2rem; display: flex; flex-direction: column; align-items: center; gap: 0.7rem; width:100%;">
          <h4 class="dashboard-section-title" style="margin:0 0 0.5rem 0; min-width:180px; width:100%; text-align:center;">Data Quality Metrics</h4>
          <div class="urgency-cards-container" style="margin:0; gap:1.5rem; justify-content:center; width:100%; display:flex; flex-wrap:wrap;">
            <!-- Cards de urgencia se generan dinámicamente -->
          </div>
        </div>
        <div style="width:100%;height:2px;background:rgba(71,178,229,0.35);border-radius:2px;margin:0.7rem 0 1.1rem 0;"></div>
        <div class="dashboard-quickfilters" style="margin-top:0;">
          <div class="quickfilters-grid">
            <!-- Los contenedores de filtros se generan dinámicamente -->
          </div>
        </div>
      </div>
      
      <!-- Dashboard Footer with Actions -->
      <!-- Eliminado: Footer con botón Generate Summary Report duplicado -->
    </div>
    <div class="dashboard-footer" style="display:flex; justify-content:flex-end; align-items:center; padding:1.5rem 2rem; border-top:1px solid rgba(255,255,255,0.1); background:rgba(255,255,255,0.02); width:100%; box-sizing:border-box;">
      <button id="generateDqSummaryBtn" class="dashboard-action-btn" title="Generate DQ Summary Report">
        Generate DQ Summary Report
      </button>
    </div>
  </div>
</div>

<!-- DQ Hub Summary Modal -->
<div id="dqSummaryModal" class="modal-overlay hidden">
  <div class="modal-panel" style="max-width:1200px; width:1200px; max-height:90vh;">
    <div class="modal-header">
      <div class="header-left">
        <img src="./LOGOTAB_rounded.png" alt="Logo" class="modal-logo" style="width:48px;height:48px;border-radius:8px;box-shadow:0 4px 12px rgba(71,178,229,0.3);" onerror="console.error('Error loading logo:', this.src);">
        <h3 class="panel-header-title dashboard-title" style="margin:0;font-size:2rem;">Data Quality Summary Report</h3>
      </div>
      <button id="closeDqSummaryBtn" class="close-btn">X</button>
    </div>
    <div class="modal-content">
      <div class="summary-config-section">
      
        
        <div class="cards-selection-section">
          <h4 class="section-title">Select Quick Cards to Include</h4>
          <!-- Removed static cards-selection-controls to avoid duplicate buttons. Controls are now generated by JS. -->
          <div id="dqQuickCardsSelection" class="cards-selection-grid">
            <!-- Cards se generan dinámicamente -->
          </div>
        </div>
        
        <div class="report-options-section">
          <h4 class="section-title">Report Options</h4>
          
          <!-- Table Data Option -->
          <div class="report-option">
            <label class="checkbox-label">
              <input type="checkbox" id="dqIncludeTableDataCheckbox" checked>
              <span class="checkmark"></span>
              Include table data in report
            </label>
            <div class="option-help">Include the current filtered table data in the report (first 50 rows)</div>
          </div>
          
          <!-- Technical Information Group -->
          <div class="report-option">
            <label class="checkbox-label">
              <input type="checkbox" id="dqIncludeTechnicalInfoCheckbox" checked>
              <span class="checkmark"></span>
              Show technical information
            </label>
            <div class="option-help">Display technical details (card config, summary info, duplicate removal summary)</div>
          </div>
          
          <!-- Duplicate Removal Option -->
          <div class="report-option">
            <label class="checkbox-label">
              <input type="checkbox" id="dqRemoveDuplicatesCheckbox" checked onchange="if(window.dqHubSummaryInstance)window.dqHubSummaryInstance.handleDuplicateRemovalChange()">
              <span class="checkmark"></span>
              Remove duplicates from table data
            </label>
            <div class="option-help">Remove duplicate rows based on selected columns before generating report</div>
          </div>
          

          
          <!-- Duplicate Removal Columns (visible by default) -->
          <div id="dqDuplicateColumnsSection" class="report-option" style="display: block;">
            <label class="option-label">Select fields for duplicate removal:</label>
            <div class="duplicate-info">
              <div class="info-text">Choose which fields to use for identifying duplicate records. Records with identical values in ALL selected fields will be considered duplicates.</div>
            </div>
            <div class="duplicate-columns-controls">
              <button type="button" id="dqSelectAllDuplicateColumnsBtn" class="small-btn">Select All Fields</button>
              <button type="button" id="dqDeselectAllDuplicateColumnsBtn" class="small-btn">Clear All</button>
              <button type="button" id="dqSelectCommonFieldsBtn" class="small-btn">Common Fields</button>
            </div>
            <div class="duplicate-columns-search">
              <input type="text" id="dqDuplicateColumnsSearch" placeholder="Search fields..." class="search-input">
            </div>

            <div id="dqDuplicateColumnsList" class="columns-list">
              <!-- Columns will be populated dynamically -->
            </div>
            <div class="duplicate-summary" id="dqDuplicateSummary" style="display: none;">
              <!-- Summary will be shown here -->
            </div>
            <div class="option-help">Selected fields: <span id="dqSelectedFieldsCount">0</span> | Records will be considered duplicates if ALL selected fields match</div>
          </div>
          
          <!-- Table Data Limit Option -->

          
          <!-- Separate Tables per Quick Card -->
          <!-- Eliminado: sección 'Separate table for each quick card' -->
        </div>
        
        <div class="summary-preview-section">
          <h4 class="section-title">Report Preview</h4>
          <div id="dqSummaryPreview" class="summary-preview">
            <!-- Preview se genera dinámicamente -->
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <div class="footer-actions">
        <div class="preferences-section" style="display: flex; gap: 0.5rem; align-items: center; margin-right: auto;">
          <button id="dqSavePreferencesBtn" class="modal-btn secondary" style="font-size: 0.85em; padding: 0.5rem 0.8rem;">
            Save Preferences
          </button>
          <button id="dqLoadPreferencesBtn" class="modal-btn secondary" style="font-size: 0.85em; padding: 0.5rem 0.8rem;">
            Load Preferences
          </button>
        </div>
        <div class="export-section" style="display: flex; gap: 0.5rem;">
        <button id="dqCopySummaryBtn" class="modal-btn secondary">
          Copy to Clipboard
        </button>
        <button id="dqExportSummaryPdfBtn" class="modal-btn secondary">
          Export PDF
        </button>
        <button id="dqExportSummaryExcelBtn" class="modal-btn primary">
          Export Excel
        </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Orders Hub Modal -->
<div id="ordersDashboardModal" class="modal-overlay hidden">
  <div class="modal-panel dashboard-panel"
     style="background:#E3F2FD !important; background-color:#E3F2FD !important; backdrop-filter:none !important; -webkit-backdrop-filter:none !important; border:1px solid rgba(0,0,0,0.1) !important; max-width:1400px !important; width:95vw !important; max-height:85vh !important; height:auto !important; margin:7.5vh auto !important; display:flex; flex-direction:column; align-items:center; justify-content:center;">
    <div class="modal-header dashboard-header" style="display:flex; align-items:center; justify-content:space-between; position:relative; padding:1.5rem 2rem 1.5rem 2rem; width:100%; box-sizing:border-box;">
      <div class="header-left" style="display:flex; align-items:center; gap:1rem;">
        <img src="./LOGOTAB_rounded.png" alt="Logo" class="modal-logo" style="width:48px;height:48px;border-radius:8px;box-shadow:0 4px 12px rgba(71,178,229,0.3);" onerror="console.error('Error loading logo:', this.src);">
        <h3 class="panel-header-title dashboard-title" style="margin:0;font-size:2rem;">Orders Hub</h3>
      </div>
      <button id="ordersDashboardCloseBtn" class="close-btn" style="position:static;">X</button>
    </div>
    <div class="modal-content dashboard-body">
      <!-- Bloque unificado de Orders metrics y quick cards -->
      <div style="border-radius:18px; background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.10); padding:0.5rem 1rem 0.7rem 1rem; margin-bottom:1.2rem;">

        <div style="background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15); border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); padding: 1.1rem 1.5rem 1.1rem 1.5rem; margin-bottom: 1.2rem; display: flex; flex-direction: column; align-items: center; gap: 0.7rem; width:100%;">
          <h4 class="dashboard-section-title" style="margin:0 0 0.5rem 0; min-width:180px; width:100%; text-align:center;">Orders Metrics</h4>
          <div class="urgency-cards-container" style="margin:0; gap:1.5rem; justify-content:center; width:100%; display:flex; flex-wrap:wrap;">
            <!-- Cards de urgencia se generan dinámicamente -->
          </div>
        </div>
        <div style="width:100%;height:2px;background:rgba(71,178,229,0.35);border-radius:2px;margin:0.7rem 0 1.1rem 0;"></div>
        <div class="dashboard-quickfilters" style="margin-top:0;">
          <div class="quickfilters-grid">
            <!-- Los contenedores de filtros se generan dinámicamente -->
          </div>
        </div>
      </div>
      
      <!-- Dashboard Footer with Actions -->
    </div>
    <div class="dashboard-footer" style="display:flex; justify-content:flex-end; align-items:center; padding:1.5rem 2rem; border-top:1px solid rgba(255,255,255,0.1); background:rgba(255,255,255,0.02); width:100%; box-sizing:border-box;">
      <button id="generateOrdersSummaryBtn" class="dashboard-action-btn" title="Generate Orders Summary Report">
        Generate Orders Summary Report
      </button>
    </div>
  </div>
</div>

<!-- Orders Hub Summary Modal -->
<div id="ordersSummaryModal" class="modal-overlay hidden">
  <div class="modal-panel" style="max-width:1200px; width:1200px; max-height:90vh;">
    <div class="modal-header">
      <div class="header-left">
        <img src="./LOGOTAB_rounded.png" alt="Logo" class="modal-logo" style="width:48px;height:48px;border-radius:8px;box-shadow:0 4px 12px rgba(71,178,229,0.3);" onerror="console.error('Error loading logo:', this.src);">
        <h3 class="panel-header-title dashboard-title" style="margin:0;font-size:2rem;">Orders Summary Report</h3>
      </div>
      <button id="closeOrdersSummaryBtn" class="close-btn">X</button>
    </div>
    <div class="modal-content">
      <div class="summary-config-section">
      
        
        <div class="cards-selection-section">
          <h4 class="section-title">Select Quick Cards to Include</h4>
          <div id="ordersQuickCardsSelection" class="cards-selection-grid">
            <!-- Cards se generan dinámicamente -->
          </div>
        </div>
        
        <div class="report-options-section">
          <h4 class="section-title">Report Options</h4>
          
          <!-- Table Data Option -->
          <div class="report-option">
            <label class="checkbox-label">
              <input type="checkbox" id="ordersIncludeTableDataCheckbox" checked>
              <span class="checkmark"></span>
              Include table data in report
            </label>
            <div class="option-help">Include the current filtered table data in the report (first 50 rows)</div>
          </div>
          
          <!-- Technical Information Group -->
          <div class="report-option">
            <label class="checkbox-label">
              <input type="checkbox" id="ordersIncludeTechnicalInfoCheckbox" checked>
              <span class="checkmark"></span>
              Show technical information
            </label>
            <div class="option-help">Display technical details (card config, summary info, duplicate removal summary)</div>
          </div>
          
          <!-- Duplicate Removal Option -->
          <div class="report-option">
            <label class="checkbox-label">
              <input type="checkbox" id="ordersRemoveDuplicatesCheckbox" checked onchange="if(window.ordersHubSummaryInstance)window.ordersHubSummaryInstance.handleDuplicateRemovalChange()">
              <span class="checkmark"></span>
              Remove duplicates from table data
            </label>
            <div class="option-help">Remove duplicate rows based on selected columns before generating report</div>
          </div>
          

          
          <!-- Duplicate Removal Columns (visible by default) -->
          <div id="ordersDuplicateColumnsSection" class="report-option" style="display: block;">
            <label class="option-label">Select fields for duplicate removal:</label>
            <div class="duplicate-info">
              <div class="info-text">Choose which fields to use for identifying duplicate records. Records with identical values in ALL selected fields will be considered duplicates.</div>
            </div>
            <div class="duplicate-columns-controls">
              <button type="button" id="ordersSelectAllDuplicateColumnsBtn" class="small-btn">Select All Fields</button>
              <button type="button" id="ordersDeselectAllDuplicateColumnsBtn" class="small-btn">Clear All</button>
              <button type="button" id="ordersSelectCommonFieldsBtn" class="small-btn">Common Fields</button>
            </div>
            <div class="duplicate-columns-search">
              <input type="text" id="ordersDuplicateColumnsSearch" placeholder="Search fields..." class="search-input">
            </div>

            <div id="ordersDuplicateColumnsList" class="columns-list">
              <!-- Columns will be populated dynamically -->
            </div>
            <div class="duplicate-summary" id="ordersDuplicateSummary" style="display: none;">
              <!-- Summary will be shown here -->
            </div>
            <div class="option-help">Selected fields: <span id="ordersSelectedFieldsCount">0</span> | Records will be considered duplicates if ALL selected fields match</div>
          </div>
          
        </div>
        
        <div class="summary-preview-section">
          <h4 class="section-title">Report Preview</h4>
          <div id="ordersSummaryPreview" class="summary-preview">
            <!-- Preview se genera dinámicamente -->
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <div class="footer-actions">
        <div class="preferences-section" style="display: flex; gap: 0.5rem; align-items: center; margin-right: auto;">
          <button id="ordersSavePreferencesBtn" class="modal-btn secondary" style="font-size: 0.85em; padding: 0.5rem 0.8rem;">
            Save Preferences
          </button>
          <button id="ordersLoadPreferencesBtn" class="modal-btn secondary" style="font-size: 0.85em; padding: 0.5rem 0.8rem;">
            Load Preferences
          </button>
        </div>
        <div class="export-section" style="display: flex; gap: 0.5rem;">
        <button id="ordersCopySummaryBtn" class="modal-btn secondary">
          Copy to Clipboard
        </button>
        <button id="ordersExportSummaryPdfBtn" class="modal-btn secondary">
          Export PDF
        </button>
        <button id="ordersExportSummaryExcelBtn" class="modal-btn primary">
          Export Excel
        </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Booking Hub Modal -->
<div id="bookingDashboardModal" class="modal-overlay hidden">
  <div class="modal-panel dashboard-panel"
     style="background:#E3F2FD !important; background-color:#E3F2FD !important; backdrop-filter:none !important; -webkit-backdrop-filter:none !important; border:1px solid rgba(0,0,0,0.1) !important; max-width:1400px !important; width:95vw !important; max-height:85vh !important; height:auto !important; margin:7.5vh auto !important; display:flex; flex-direction:column; align-items:center; justify-content:center;">
    <div class="modal-header dashboard-header" style="display:flex; align-items:center; justify-content:space-between; position:relative; padding:1.5rem 2rem 1.5rem 2rem; width:100%; box-sizing:border-box;">
      <div class="header-left" style="display:flex; align-items:center; gap:1rem;">
        <img src="./LOGOTAB_rounded.png" alt="Logo" class="modal-logo" style="width:48px;height:48px;border-radius:8px;box-shadow:0 4px 12px rgba(71,178,229,0.3);" onerror="console.error('Error loading logo:', this.src);">
        <h3 class="panel-header-title dashboard-title" style="margin:0;font-size:2rem;">Booking Hub</h3>
      </div>
      <button id="bookingDashboardCloseBtn" class="close-btn" style="position:static;">X</button>
    </div>
    <div class="modal-content dashboard-body">
      <!-- Bloque unificado de Booking metrics y quick cards -->
      <div style="border-radius:18px; background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.10); padding:0.5rem 1rem 0.7rem 1rem; margin-bottom:1.2rem;">

        <div style="background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15); border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); padding: 1.1rem 1.5rem 1.1rem 1.5rem; margin-bottom: 1.2rem; display: flex; flex-direction: column; align-items: center; gap: 0.7rem; width:100%;">
          <h4 class="dashboard-section-title" style="margin:0 0 0.5rem 0; min-width:180px; width:100%; text-align:center;">Booking Metrics</h4>
          <div class="urgency-cards-container" style="margin:0; gap:1.5rem; justify-content:center; width:100%; display:flex; flex-wrap:wrap;">
            <!-- Cards de urgencia se generan dinámicamente -->
          </div>
        </div>
        <div style="width:100%;height:2px;background:rgba(71,178,229,0.35);border-radius:2px;margin:0.7rem 0 1.1rem 0;"></div>
        <div class="dashboard-quickfilters" style="margin-top:0;">
          <div class="quickfilters-grid">
            <!-- Los contenedores de filtros se generan dinámicamente -->
          </div>
        </div>
      </div>
      
    </div>
    <div class="dashboard-footer" style="display:flex; justify-content:flex-end; align-items:center; padding:1.5rem 2rem; border-top:1px solid rgba(255,255,255,0.1); background:rgba(255,255,255,0.02); width:100%; box-sizing:border-box;">
      <button id="generateBookingSummaryBtn" class="dashboard-action-btn" title="Generate Booking Summary Report">
        Generate Booking Summary Report
      </button>
    </div>
  </div>
</div>

<!-- Booking Hub Summary Modal -->
<div id="bookingSummaryModal" class="modal-overlay hidden">
  <div class="modal-panel" style="max-width:1200px; width:1200px; max-height:90vh;">
    <div class="modal-header">
      <div class="header-left">
        <img src="./LOGOTAB_rounded.png" alt="Logo" class="modal-logo" style="width:48px;height:48px;border-radius:8px;box-shadow:0 4px 12px rgba(71,178,229,0.3);" onerror="console.error('Error loading logo:', this.src);">
        <h3 class="panel-header-title dashboard-title" style="margin:0;font-size:2rem;">Booking Summary Report</h3>
      </div>
      <button id="closeBookingSummaryBtn" class="close-btn">X</button>
    </div>
    <div class="modal-content">
      <div class="summary-config-section">
      
        
        <div class="cards-selection-section">
          <h4 class="section-title">Select Quick Cards to Include</h4>
          <div id="bookingQuickCardsSelection" class="cards-selection-grid">
            <!-- Cards se generan dinámicamente -->
          </div>
        </div>
        
        <div class="report-options-section">
          <h4 class="section-title">Report Options</h4>
          
          <!-- Table Data Option -->
          <div class="report-option">
            <label class="checkbox-label">
              <input type="checkbox" id="bookingIncludeTableDataCheckbox" checked>
              <span class="checkmark"></span>
              Include table data in report
            </label>
            <div class="option-help">Include the current filtered table data in the report (first 50 rows)</div>
          </div>
          
          <!-- Technical Information Group -->
          <div class="report-option">
            <label class="checkbox-label">
              <input type="checkbox" id="bookingIncludeTechnicalInfoCheckbox" checked>
              <span class="checkmark"></span>
              Show technical information
            </label>
            <div class="option-help">Display technical details (card config, summary info, duplicate removal summary)</div>
          </div>
          
          <!-- Duplicate Removal Option -->
          <div class="report-option">
            <label class="checkbox-label">
              <input type="checkbox" id="bookingRemoveDuplicatesCheckbox" checked onchange="if(window.bookingHubSummaryInstance)window.bookingHubSummaryInstance.handleDuplicateRemovalChange()">
              <span class="checkmark"></span>
              Remove duplicates from table data
            </label>
            <div class="option-help">Remove duplicate rows based on selected columns before generating report</div>
          </div>
          

          
          <!-- Duplicate Removal Columns (visible by default) -->
          <div id="bookingDuplicateColumnsSection" class="report-option" style="display: block;">
            <label class="option-label">Select fields for duplicate removal:</label>
            <div class="duplicate-info">
              <div class="info-text">Choose which fields to use for identifying duplicate records. Records with identical values in ALL selected fields will be considered duplicates.</div>
            </div>
            <div class="duplicate-columns-controls">
              <button type="button" id="bookingSelectAllDuplicateColumnsBtn" class="small-btn">Select All Fields</button>
              <button type="button" id="bookingDeselectAllDuplicateColumnsBtn" class="small-btn">Clear All</button>
              <button type="button" id="bookingSelectCommonFieldsBtn" class="small-btn">Common Fields</button>
            </div>
            <div class="duplicate-columns-search">
              <input type="text" id="bookingDuplicateColumnsSearch" placeholder="Search fields..." class="search-input">
            </div>

            <div id="bookingDuplicateColumnsList" class="columns-list">
              <!-- Columns will be populated dynamically -->
            </div>
            <div class="duplicate-summary" id="bookingDuplicateSummary" style="display: none;">
              <!-- Summary will be shown here -->
            </div>
            <div class="option-help">Selected fields: <span id="bookingSelectedFieldsCount">0</span> | Records will be considered duplicates if ALL selected fields match</div>
          </div>
          
        </div>
        
        <div class="summary-preview-section">
          <h4 class="section-title">Report Preview</h4>
          <div id="bookingSummaryPreview" class="summary-preview">
            <!-- Preview se genera dinámicamente -->
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <div class="footer-actions">
        <div class="preferences-section" style="display: flex; gap: 0.5rem; align-items: center; margin-right: auto;">
          <button id="bookingSavePreferencesBtn" class="modal-btn secondary" style="font-size: 0.85em; padding: 0.5rem 0.8rem;">
            Save Preferences
          </button>
          <button id="bookingLoadPreferencesBtn" class="modal-btn secondary" style="font-size: 0.85em; padding: 0.5rem 0.8rem;">
            Load Preferences
          </button>
        </div>
        <div class="export-section" style="display: flex; gap: 0.5rem;">
        <button id="bookingCopySummaryBtn" class="modal-btn secondary">
          Copy to Clipboard
        </button>
        <button id="bookingExportSummaryPdfBtn" class="modal-btn secondary">
          Export PDF
        </button>
        <button id="bookingExportSummaryExcelBtn" class="modal-btn primary">
          Export Excel
        </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Ops Hub Summary Modal -->
<div id="opsSummaryModal" class="modal-overlay hidden">
  <div class="modal-panel" style="max-width:1200px; width:1200px; max-height:90vh;">
    <div class="modal-header">
      <div class="header-left">
        <img src="./LOGOTAB_rounded.png" alt="Logo" class="modal-logo" style="width:48px;height:48px;border-radius:8px;box-shadow:0 4px 12px rgba(71,178,229,0.3);" onerror="console.error('Error loading logo:', this.src);">
        <h3 class="panel-header-title dashboard-title" style="margin:0;font-size:2rem;">Operations Summary Report</h3>
      </div>
      <button id="closeOpsSummaryBtn" class="close-btn">X</button>
    </div>
    <div class="modal-content">
      <div class="summary-config-section">
      
        
        <div class="cards-selection-section">
          <h4 class="section-title">Select Quick Cards to Include</h4>
          <!-- Removed static cards-selection-controls to avoid duplicate buttons. Controls are now generated by JS. -->
          <div id="quickCardsSelection" class="cards-selection-grid">
            <!-- Cards se generan dinámicamente -->
          </div>
        </div>
        
        <div class="report-options-section">
          <h4 class="section-title">Report Options</h4>
          
          <!-- Table Data Option -->
          <div class="report-option">
            <label class="checkbox-label">
              <input type="checkbox" id="includeTableDataCheckbox" checked>
              <span class="checkmark"></span>
              Include table data in report
            </label>
            <div class="option-help">Include the current filtered table data in the report (first 50 rows)</div>
          </div>
          
          <!-- Technical Information Group -->
          <div class="report-option">
            <label class="checkbox-label">
              <input type="checkbox" id="includeTechnicalInfoCheckbox" checked>
              <span class="checkmark"></span>
              Show technical information
            </label>
            <div class="option-help">Display technical details (card config, summary info, duplicate removal summary)</div>
          </div>
          
          <!-- Duplicate Removal Option -->
          <div class="report-option">
            <label class="checkbox-label">
              <input type="checkbox" id="removeDuplicatesCheckbox">
              <span class="checkmark"></span>
              Remove duplicates from table data
            </label>
            <div class="option-help">Remove duplicate rows based on selected columns before generating report</div>
          </div>
          

          
          <!-- Duplicate Removal Columns (hidden by default) -->
          <div id="duplicateColumnsSection" class="report-option" style="display: none;">
            <label class="option-label">Select fields for duplicate removal:</label>
            <div class="duplicate-info">
              <div class="info-text">Choose which fields to use for identifying duplicate records. Records with identical values in ALL selected fields will be considered duplicates.</div>
            </div>
            <div class="duplicate-columns-controls">
              <button type="button" id="selectAllDuplicateColumnsBtn" class="small-btn">Select All Fields</button>
              <button type="button" id="deselectAllDuplicateColumnsBtn" class="small-btn">Clear All</button>
              <button type="button" id="selectCommonFieldsBtn" class="small-btn">Common Fields</button>
            </div>
            <div class="duplicate-columns-search">
              <input type="text" id="duplicateColumnsSearch" placeholder="Search fields..." class="search-input">
            </div>
            <div id="duplicateColumnsList" class="columns-list">
              <!-- Columns will be populated dynamically -->
            </div>
            <div class="duplicate-summary" id="duplicateSummary" style="display: none;">
              <!-- Summary will be shown here -->
            </div>
            <div class="option-help">Selected fields: <span id="selectedFieldsCount">0</span> | Records will be considered duplicates if ALL selected fields match</div>
          </div>
          
          <!-- Table Data Limit Option -->

          
          <!-- Separate Tables per Quick Card -->
          <!-- Eliminado: sección 'Separate table for each quick card' -->
        </div>
        
        <div class="summary-preview-section">
          <h4 class="section-title">Report Preview</h4>
          <div id="summaryPreview" class="summary-preview">
            <!-- Preview se genera dinámicamente -->
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <div class="footer-actions">
        <div class="preferences-section" style="display: flex; gap: 0.5rem; align-items: center; margin-right: auto;">
          <button id="opsSavePreferencesBtn" class="modal-btn secondary" style="font-size: 0.85em; padding: 0.5rem 0.8rem;">
            Save Preferences
          </button>
          <button id="opsLoadPreferencesBtn" class="modal-btn secondary" style="font-size: 0.85em; padding: 0.5rem 0.8rem;">
            Load Preferences
          </button>
        </div>
        <div class="export-section" style="display: flex; gap: 0.5rem;">
        <button id="copySummaryBtn" class="modal-btn secondary">
          Copy to Clipboard
        </button>
        <button id="exportSummaryPdfBtn" class="modal-btn secondary">
          Export PDF
        </button>
        <button id="exportSummaryExcelBtn" class="modal-btn primary">
          Export Excel
        </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal Remove Duplicates -->
<div id="removeDuplicatesModal" class="modal-overlay hidden">
  <div class="modal-panel">
    <div class="modal-header">
      <div class="header-left">
        <img src="LOGOTAB_rounded.png" alt="Logo" class="modal-logo">
        <h3 class="panel-header-title">Duplicate Removal Tool</h3>
      </div>
      <button id="closeRemoveDuplicatesModalBtn" class="close-btn">X</button>
    </div>
    <div class="modal-content">
      <p>Select columns to use as key for removing duplicates:</p>
      <input id="removeDuplicatesSearch" type="text" placeholder="Search columns..." style="margin-bottom:0.5rem; width:100%; padding:0.4em; border-radius:4px; border:1px solid #ccc;" />
      <div style="display:flex; gap:0.5rem; margin-bottom:0.5rem;">
        <button type="button" id="removeDuplicatesSelectAllBtn" class="modal-btn secondary" style="flex:1;">Select All</button>
        <button type="button" id="removeDuplicatesDeselectAllBtn" class="modal-btn secondary" style="flex:1;">Deselect All</button>
      </div>
      <form id="removeDuplicatesForm" style="display:flex; flex-direction:column; gap:0.5rem;"></form>
    </div>
    <div class="modal-footer">
      <button id="confirmRemoveDuplicatesBtn" class="modal-btn primary">Remove</button>
    </div>
  </div>
</div>

<!-- Modal Show Duplicates -->
<div id="showDuplicatesModal" class="modal-overlay hidden">
  <div class="modal-panel" style="max-width:1200px;">
    <div class="modal-header">
      <div class="header-left">
        <img src="LOGOTAB_rounded.png" alt="Logo" class="modal-logo">
        <h3 class="panel-header-title">Duplicate Records Viewer</h3>
      </div>
      <button id="closeShowDuplicatesModalBtn" class="close-btn">X</button>
    </div>
    <div class="modal-content">
      <div style="margin-bottom:1rem;">
        <p style="margin-bottom:0.5rem; color:#666;">Select columns to use as key for identifying duplicates:</p>
        <input id="showDuplicatesSearch" type="text" placeholder="Search columns..." style="margin-bottom:0.5rem; width:100%; padding:0.4em; border-radius:4px; border:1px solid #ccc;" />
        <div style="display:flex; gap:0.5rem; margin-bottom:0.5rem;">
          <button type="button" id="showDuplicatesSelectAllBtn" class="modal-btn secondary" style="flex:1;">Select All</button>
          <button type="button" id="showDuplicatesDeselectAllBtn" class="modal-btn secondary" style="flex:1;">Deselect All</button>
        </div>
        <form id="showDuplicatesForm" style="display:flex; flex-direction:column; gap:0.5rem; margin-bottom:1rem;"></form>
        <button id="analyzeDuplicatesBtn" class="modal-btn primary" style="width:100%;">Analyze Duplicates</button>
      </div>
      <div id="duplicatesSummary" style="margin-bottom:1rem; padding:1rem; background:#e8f5e8; border-radius:8px; border-left:4px solid #4caf50; display:none;">
        <!-- Summary will be shown here -->
      </div>
      <div id="duplicatesTableSection" style="max-height:500px; overflow-y:auto; display:none;">
        <div id="duplicatesTableContainer">
          <!-- Table will be generated here -->
        </div>
      </div>
    </div>
    <div class="modal-footer" id="duplicatesModalFooter" style="display:none;">
      <button id="applyAsFilterBtn" class="modal-btn primary" style="background: #4caf50;">
        Apply Duplicates
      </button>

      <button id="createAnalysisTabBtn" class="modal-btn primary" style="background: #17a2b8;">
        Create Analysis Tab
      </button>
      <button id="saveDuplicatesAsQuickFilterBtn" class="modal-btn primary" style="background: #47B2E5;">
        Save as Quick Filter
      </button>
    </div>
  </div>
</div>

<!-- Backup Modal -->
<div id="backupModal" class="modal-overlay hidden">
  <div class="modal-panel" style="max-width:1200px;">
    <div class="modal-header">
      <div class="header-left">
        <img src="LOGOTAB_rounded.png" alt="Logo" class="modal-logo">
        <h3 class="panel-header-title">User Settings</h3>
      </div>
      <button id="closeBackupModalBtn" class="close-btn">X</button>
    </div>
    <div class="modal-content">
      <div class="backup-options">
        <div class="backup-section">
          <h4>Dashboard Configuration</h4>
          <div class="backup-actions">
            <button id="saveDashboardConfigBtn" class="modal-btn primary">Save Dashboard Config</button>
            <button id="saveToFolderBtn" class="modal-btn primary">Save to Folder</button>
            <button id="loadFromFolderBtn" class="modal-btn secondary">Load from Folder</button>
          </div>
        </div>
        <div id="userSetUpStatus" style="margin-top:1rem; font-size:0.95em; color:#1976d2;"></div>
      </div>
    </div>
  </div>
</div>

<!-- Snapshot Manager Modal -->
<div id="snapshotManagerModal" class="modal-overlay hidden">
  <div class="modal-panel" style="max-width:600px;">
    <div class="modal-header">
      <div class="header-left">
        <img src="LOGOTAB_rounded.png" alt="Logo" class="modal-logo">
        <h3 class="panel-header-title">Snapshot Manager</h3>
      </div>
      <button id="closeSnapshotManagerModalBtn" class="close-btn">X</button>
    </div>
    <div class="modal-content">
      <div style="margin-bottom:1.2rem;">Save or restore a complete snapshot of your workspace, including filters, views, favorites, table data, and dashboard configuration.</div>
      <div class="backup-actions" style="margin-bottom:1.2rem;">
        <button id="saveSnapshotBtn" class="modal-btn primary">Save Snapshot</button>
        <button id="restoreSnapshotBtn" class="modal-btn secondary">Restore Snapshot</button>
      </div>
      <div id="snapshotStatus" style="margin-top:1rem; font-size:0.95em; color:#1976d2;"></div>
    </div>
  </div>
</div>

<!-- Data Version Modal -->
<div id="dataVersionModal" class="modal-overlay hidden">
  <div class="modal-panel" style="max-width:1200px;">
    <div class="modal-header">
      <div class="header-left">
        <img src="LOGOTAB_rounded.png" alt="Logo" class="modal-logo">
        <h3 class="panel-header-title">Data Version Manager</h3>
      </div>
      <button id="closeDataVersionModalBtn" class="close-btn">X</button>
    </div>
    <div class="modal-content">
       <div style="margin-bottom:1.2rem;">Save, search, load or delete versions of your table data (CSV snapshots). Only table data is included in these versions.</div>
      <input id="dataVersionsSearch" type="text" placeholder="Search by file or date..." style="width:100%;margin-bottom:0.5rem;padding:0.4em; border-radius:4px; border:1px solid #ccc;" />
      <div id="dataVersionsList" style="max-height:260px;overflow-y:auto;"></div>
    </div>
  </div>
</div>

<!-- User Set Up Modal -->
<div id="userSetUpModal" class="modal-overlay hidden">
  <div class="modal-panel" style="max-width:500px;">
    <div class="modal-header">
      <div class="header-left">
        <img src="LOGOTAB_rounded.png" alt="Logo" class="modal-logo">
        <h3 class="panel-header-title dashboard-title" style="margin:0;font-size:2rem;">User Setup</h3>
      </div>
      <button id="closeUserSetUpModalBtn" class="close-btn">X</button>
    </div>
    <div class="modal-content" style="padding: 2rem;">
      
          <!-- Manual Storage Actions (Legacy) -->
          <div style="padding:1.5rem; background:rgba(255, 255, 255, 0.05); border-radius:8px; border:1px solid rgba(255, 255, 255, 0.1);">
            <h4 style="color:#000000; margin-bottom:1.5rem; font-size:1.1em; font-weight: 600;">Manual Storage</h4>
            <div class="manual-actions" style="display:flex; gap:1rem; flex-wrap:wrap; align-items:center;">
              <button id="saveToFolderBtn_user" class="modal-btn primary" title="Save or load your configuration to manage your workspace settings" style="cursor:pointer; font-weight: 600; font-size: 0.95em; padding: 0.8rem 1.5rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2); transition: all 0.3s ease; flex: 1; min-width: 150px;">Save to Folder</button>
              <button id="loadFromFolderBtn_user" class="modal-btn secondary" title="Save or load your configuration to manage your workspace settings" style="cursor:pointer; font-weight: 600; font-size: 0.95em; padding: 0.8rem 1.5rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2); transition: all 0.3s ease; flex: 1; min-width: 150px;">Load from Folder</button>
            </div>
          </div>
          

      </div>

      <div id="userSetUpStatus_user" style="margin-top:1.5rem; font-size:0.95em; color:#1976d2; text-align: center;"></div>
    </div>
  </div>
</div>

<!-- Custom Summary Modal -->
<div id="summaryModal" class="modal-overlay hidden">
  <div class="modal-panel" style="max-width:1200px;">
    <div class="modal-header">
      <div class="header-left">
        <img src="LOGOTAB_rounded.png" alt="Logo" class="modal-logo">
        <h3 class="panel-header-title">Custom Summary Builder</h3>
      </div>
      <button id="closeSummaryModalBtn" class="close-btn">X</button>
    </div>
    <div class="modal-content">
      <div class="summary-actions" style="justify-content: flex-start; margin-bottom:1.2em; gap:0.7em;">
        <button id="saveSummaryBtn" class="secondary">Save Summary</button>
        <button id="manageSummariesBtn" class="secondary">Manage Summaries</button>
      </div>
      <div class="pivot-section">
        <h3>Rows</h3>
        <select id="pivotRowsSelect" multiple size="5"></select>
        <div class="pivot-help">Select one or more fields to group your rows.</div>
      </div>
      <div class="pivot-section">
        <h3>Columns</h3>
        <select id="pivotColumnsSelect" multiple size="3"></select>
        <div class="pivot-help">Select fields to create dynamic columns (optional).</div>
      </div>
      <div class="pivot-section">
        <h3>Remove duplicates by</h3>
        <select id="removeDuplicatesSelect" multiple size="3"></select>
        <div class="pivot-help">Select fields to remove duplicate rows (default: same as Group by).</div>
      </div>
      <div class="pivot-section">
        <h3>Order By</h3>
        <select id="orderBySelect" multiple size="3"></select>
        <div class="pivot-help">Select fields to order the results (optional).</div>
      </div>
      <div class="pivot-section">
        <h3>Values</h3>
        <div id="metricsList"></div>
        <button id="addMetricBtn" type="button" class="add-metric-btn">+ Add metric</button>
        <div class="pivot-help">Choose which metrics to calculate and for which field.</div>
      </div>
      <div id="pivotPreviewContainer"></div>
    </div>
    <div class="modal-footer" style="display:flex; justify-content:space-between; align-items:center;">
      <button id="resetSummaryBtn" class="modal-btn secondary">Reset</button>
      <div style="display:flex; gap:0.7em; align-items:center;">
        <button id="generateSummaryBtn" class="modal-btn secondary">Generate PDF</button>
        <button id="exportSummaryExcelBtn" class="modal-btn secondary">Export to Excel</button>
        <button id="viewSummaryBtn" class="modal-btn primary">View summary</button>
      </div>
    </div>
  </div>
</div>

<!-- Manage Summaries Modal -->
<div id="manageSummariesModal" class="modal-overlay hidden">
  <div class="modal-panel" style="max-width:520px;">
    <div class="modal-header">
      <div class="header-left">
        <img src="LOGOTAB_rounded.png" alt="Logo" class="modal-logo">
        <h3 class="panel-header-title">Summaries Manager</h3>
      </div>
      <button class="close-btn" id="closeManageSummariesBtn">X</button>
    </div>
    <div class="modal-content">
      <div class="saved-summaries-list" id="savedSummariesList"></div>
      <div id="summaryRenameSection" style="display:none; margin-top:1em;">
        <input id="renameSummaryInput" type="text" class="input" style="width:70%;margin-right:0.5em;" />
        <button id="confirmRenameSummaryBtn" class="modal-btn primary small">Rename</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal para copiar resumen -->
<div id="copySummaryModal" class="modal-overlay hidden" style="z-index:12001;">
  <div class="modal-panel" style="max-width:900px;">
    <div class="modal-header">
      <div class="header-left">
        <img src="LOGOTAB_rounded.png" alt="Logo" class="modal-logo">
        <h3 class="panel-header-title">Summary Preview</h3>
      </div>
      <button id="closeCopySummaryModalBtn" class="close-btn">X</button>
    </div>
    <div class="modal-content">
      <div id="copySummaryContent" style="overflow-x:auto;"></div>
      <button id="copySummaryToClipboardBtn" class="modal-btn primary" style="margin-top:1em;">Copy to clipboard</button>
    </div>
  </div>
</div>

<!-- Manage Dashboard Config Modal -->
<div id="manageDashboardConfigModal" class="modal-overlay hidden">
  <div class="modal-panel" style="max-width:500px;">
    <div class="modal-header">
      <div class="header-left">
        <img src="LOGOTAB_rounded.png" alt="Logo" class="modal-logo">
        <h3 class="panel-header-title">Dashboard Configurations</h3>
      </div>
      <button id="closeManageDashboardConfigBtn" class="close-btn">X</button>
    </div>
    <div class="modal-content" id="dashboardConfigsList"></div>
    <div class="modal-footer">
      <input id="newDashboardConfigName" class="input" placeholder="New config name" style="width:60%;" />
      <button id="saveNewDashboardConfigBtn" class="modal-btn primary">Save Current as New</button>
    </div>
  </div>
</div>

<!-- CSV Comparison Modal -->
<div id="csvComparisonModal" class="modal-overlay hidden">
  <div class="modal-panel" style="max-width:1100px; min-height:600px; max-height:96vh;">
    <div class="modal-header">
      <div class="header-left">
        <img src="LOGOTAB_rounded.png" alt="Logo" class="modal-logo">
        <h3 class="panel-header-title dashboard-title" style="margin:0;font-size:2rem;">Data Comparison</h3>
      </div>
      <button id="closeCSVComparisonBtn" class="close-btn">X</button>
    </div>
    <div class="modal-content">
      <div class="csv-comparison-section">
        <div class="file-input-section">
          <div class="file-input-group">
            <label>Original Data:</label>
            <div class="input-source-tabs">
              <button type="button" class="source-tab active upload-file-btn" data-source="file" data-target="original" data-input="originalCSVInput">Upload File</button>
            </div>
            <div class="source-content">
              <input type="file" id="originalCSVInput" accept=".csv" class="file-input source-file active" style="display:none;">
              <div id="originalFileInfo" class="file-info" style="display:none; margin-top:0.5rem; padding:0.5rem; background:#e3f2fd; border-radius:6px; color:#1976d2; font-size:0.9rem;">
                <span class="file-name"></span>
              </div>
              <div class="source-version hidden">
                <select id="originalVersionSelect" class="version-select">
                  <option value="">Select a saved version...</option>
                </select>
                <button type="button" id="loadOriginalVersionBtn" class="load-version-btn" disabled>Load Version</button>
              </div>
            </div>
          </div>
          <div class="file-input-group">
            <label>New Data:</label>
            <div class="input-source-tabs">
              <button type="button" class="source-tab active upload-file-btn" data-source="file" data-target="new" data-input="newCSVInput">Upload File</button>
            </div>
            <div class="source-content">
              <input type="file" id="newCSVInput" accept=".csv" class="file-input source-file active" style="display:none;">
              <div id="newFileInfo" class="file-info" style="display:none; margin-top:0.5rem; padding:0.5rem; background:#e3f2fd; border-radius:6px; color:#1976d2; font-size:0.9rem;">
                <span class="file-name"></span>
              </div>
              <div class="source-version hidden">
                <select id="newVersionSelect" class="version-select">
                  <option value="">Select a saved version...</option>
                </select>
                <button type="button" id="loadNewVersionBtn" class="load-version-btn" disabled>Load Version</button>
              </div>
            </div>
          </div>
        </div>
        <div class="comparison-config-section" style="gap:2.5rem;">
          <fieldset class="config-group" style="background:#f8fafc; border-radius:10px; border:1px solid #e0e7ef; padding:1.2em 1em 1em 1em; min-width:260px;">
            <legend style="font-size:1.08em;font-weight:600;color:#1976d2;margin-bottom:0.5em;">Key Columns <span title='Required. Used to match rows between files' style='color:#e53935;font-size:0.9em;'>(required)</span></legend>
            <div style="font-size:1em;color:#b71c1c;margin-bottom:0.5em;font-weight:400;">You must select at least one key column (e.g., Booking Number, Reference, ID, etc). It will be used to match rows between files and detect changes.</div>
            <div style="display:flex;gap:0.5em;margin-bottom:0.5em;">
              <button type="button" id="selectAllKeyBtn" class="modal-btn secondary small" style="font-size:0.95em;">Select All</button>
              <button type="button" id="deselectAllKeyBtn" class="modal-btn secondary small" style="font-size:0.95em;">Deselect All</button>
            </div>
            <select id="keyColumnsSelect" multiple class="column-select" placeholder="Select key column(s)..."></select>
            <div id="keyColumnsWarning" style="color:#e53935;font-size:0.98em;display:none;margin-top:0.5em;font-weight:600;">You must select at least one key column to compare.</div>
          </fieldset>
          <fieldset class="config-group" style="background:#f8fafc; border-radius:10px; border:1px solid #e0e7ef; padding:1.2em 1em 1em 1em; min-width:260px;">
            <legend style="font-size:1.08em;font-weight:600;color:#1976d2;margin-bottom:0.5em;">Columns to Compare <span title='Used to detect which rows have changes' style='color:#888;font-size:0.9em;'>(for detecting changes)</span></legend>
            <div style="font-size:0.97em;color:#555;margin-bottom:0.5em;">Select columns to monitor for changes. Rows with changes in these columns will be highlighted, but ALL data from those rows will be shown in the results.</div>
            <div style="display:flex;gap:0.5em;margin-bottom:0.5em;">
              <button type="button" id="selectAllCompareBtn" class="modal-btn secondary small" style="font-size:0.95em;">Select All</button>
              <button type="button" id="deselectAllCompareBtn" class="modal-btn secondary small" style="font-size:0.95em;">Deselect All</button>
            </div>
            <select id="compareColumnsSelect" multiple class="column-select"></select>
          </fieldset>
        </div>
      </div>
    </div>
    <div class="modal-footer" style="display:flex; justify-content:space-between; align-items:center;">
      <button id="resetComparisonBtn" class="modal-btn secondary">Reset</button>
      <div style="display:flex; gap:0.7em; align-items:center;">
        <button id="startComparisonBtn" class="modal-btn primary" disabled>Compare Files</button>
        <button id="exportComparisonBtn" class="modal-btn secondary" style="display:none;">Export Results</button>
        <button id="sendComparisonToMainTableBtn" class="modal-btn primary" style="margin-right:1em;">View result in main table</button>
      </div>
    </div>
  </div>
</div>

<!-- Comparison Results Modal -->
<div id="comparisonResultsModal" class="modal-overlay hidden">
  <div class="modal-panel" style="max-width:1400px; min-height:700px; max-height:96vh; background:#E3F2FD !important; background-color:#E3F2FD !important; border:1px solid rgba(0,0,0,0.1) !important; backdrop-filter:none !important;">
    <div class="modal-header">
      <div class="header-left">
        <img src="LOGOTAB_rounded.png" alt="Logo" class="modal-logo">
        <h3 class="panel-header-title dashboard-title" style="margin:0;font-size:2rem;">Comparison Results</h3>
      </div>
      <button id="closeResultsModalBtn" class="close-btn">X</button>
    </div>
    <div class="modal-content">
      <div id="comparisonSummary" class="comparison-summary" style="margin-bottom:1.2em;"></div>
      <div class="results-table-container" style="min-height:300px;">
        <table id="comparisonResultsTable" class="comparison-table"></table>
      </div>
    </div>
    <div class="modal-footer">
      <button id="backToConfigBtn" class="modal-btn secondary" style="margin-right:1em;">← Back</button>
      <button id="exportToExcelBtn" class="modal-btn secondary">Export to Excel</button>
      <button id="exportToPdfBtn" class="modal-btn secondary">Generate PDF</button>
      <button id="copyResultsBtn" class="modal-btn secondary">Copy Results</button>
      <span style="flex:1"></span>
      <span class="summary-item unchanged">Unchanged: <span id="unchangedCount">0</span></span>
      <span class="summary-item changed">Changed: <span id="changedCount">0</span></span>
      <span class="summary-item new">New: <span id="newCount">0</span></span>
      <span class="summary-item deleted">Deleted: <span id="deletedCount">0</span></span>
    </div>
  </div>
</div>

<!-- Modal Legal Notice -->
<div id="legalNoticeModal" class="modal-overlay hidden">
  <div class="modal-panel" style="max-width:600px;">
    <div class="modal-header">
      <div class="header-left">
        <img src="LOGOTAB_rounded.png" alt="Logo" class="modal-logo">
        <h3 class="panel-header-title dashboard-title" style="margin:0;font-size:2rem;">Legal Notice</h3>
      </div>
      <button id="closeLegalNoticeBtn" class="close-btn">X</button>
    </div>
    <div class="modal-content" style="font-size:1em; color:#15364A;">
      <p>This website is owned and maintained by Pablo Benéitez, located in Valencia, Spain.</p>
      <p>All content on this site is protected by intellectual property laws. Unauthorized use is not allowed.</p>
      <p>Use of this site implies acceptance of these terms. Legal matters are governed by the laws of Spain.</p>
    </div>
  </div>
</div>


<!-- Modal Select Version -->
<div id="selectVersionModal" class="modal-overlay hidden" style="z-index: 10001;">
  <div class="modal-panel" style="max-width:700px;">
    <div class="modal-header" style="flex-direction: column; align-items: center; text-align: center; padding: 2rem 1.5rem 1.5rem 1.5rem;">
      <button id="closeSelectVersionBtn" class="close-btn" style="position: absolute; top: 1rem; right: 1rem;">X</button>
      <!-- Logo eliminado -->
      <h3 class="panel-header-title dashboard-title" style="margin: 0 0 8px 0; font-size: 2rem;">Welcome to The Bridge!</h3>
      <p style="margin: 0; font-size: 1.1em; color: #5A9FD4; font-weight: 400;">Choose a saved data version to load</p>
    </div>
    <div class="modal-content">
      <div class="version-search-section">
        <input type="text" id="versionSearchInput" class="input" placeholder="Search versions..." style="margin-bottom: 1rem;">
      </div>
      <div id="versionsList" class="versions-list">
        <!-- Las versiones se cargarán aquí dinámicamente -->
      </div>
    </div>
  </div>
</div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
  
  <!-- Script para verificar jsPDF -->
  <script>
    // Verificar que jsPDF se carga correctamente
    window.addEventListener('load', function() {
      // Verificar si se acaban de cargar filtros y renderizarlos
      const filtersJustLoaded = localStorage.getItem('filtersJustLoaded');
      if (filtersJustLoaded === 'true') {
        console.log('🔄 Detected filtersJustLoaded flag, will render filters after FilterManager initializes');
        localStorage.removeItem('filtersJustLoaded'); // Limpiar el flag
        
        // Esperar a que FilterManager esté inicializado y luego renderizar
        let attempts = 0;
        const maxAttempts = 20;
        const tryRenderFilters = () => {
          attempts++;
          const myFilters = JSON.parse(localStorage.getItem('myFilters') || '{}');
          if (Object.keys(myFilters).length > 0) {
            if (typeof window.renderMyFiltersSection === 'function') {
              console.log('✅ Rendering myFilters after page load - attempt', attempts);
              window.renderMyFiltersSection();
              return;
            } else if (typeof renderMyFiltersSection === 'function') {
              console.log('✅ Rendering myFilters after page load - attempt', attempts);
              renderMyFiltersSection();
              return;
            }
          }
          
          if (attempts < maxAttempts) {
            setTimeout(tryRenderFilters, 300);
          } else {
            console.warn('⚠️ Could not render filters after page load');
          }
        };
        setTimeout(tryRenderFilters, 2000); // Esperar 2 segundos para que FilterManager se inicialice
      }
      
      setTimeout(() => {
        if (typeof window.jsPDF !== 'undefined') {
          console.log('✅ jsPDF loaded successfully');
          console.log('jsPDF object:', window.jsPDF);
        } else {
          console.error('❌ jsPDF not loaded');
        }
      }, 1000);
    });
  </script>
  
      <script type="module" src="src/components/dashboard/DqHubManager.js"></script>
    <script type="module" src="src/components/dashboard/DqHubSummary.js"></script>
    <script type="module" src="src/components/dashboard/OpsHubManager.js"></script>
      <script type="module" src="src/components/dashboard/OrdersHubManager.js"></script>
    <script type="module" src="src/components/dashboard/OrdersHubSummary.js"></script>
      <script type="module" src="src/components/dashboard/BookingHubManager.js"></script>
    <script type="module" src="src/components/dashboard/BookingHubSummary.js"></script>
    <script type="module" src="src/main.js"></script>
  
  <!-- Script para mantener colores de urgencia -->
  <script>
        function enforceUrgencyColors() {
      const urgencyButtons = document.querySelectorAll('.ops-hub-chip[data-urgency]');
      urgencyButtons.forEach(button => {
        const urgency = button.getAttribute('data-urgency');
        
        // NO sobrescribir si el botón está activo (tiene clase 'active')
        if (button.classList.contains('active')) {
          return; // Salir sin modificar el botón activo
        }
        
        // Remover todos los estilos conflictivos primero (solo si no está activo)
        button.style.removeProperty('background');
        button.style.removeProperty('background-color');
        button.style.removeProperty('border');
        button.style.removeProperty('color');
        button.style.removeProperty('box-shadow');
        
         // Aplicar colores específicos con máxima prioridad
        if (urgency === 'Urgente') {
          button.setAttribute('style', `
            background: rgba(239, 68, 68, 0.15) !important;
            background-color: rgba(239, 68, 68, 0.15) !important;
            border: 1px solid rgba(239, 68, 68, 0.3) !important;
            color: #ff6b6b !important;
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.2) !important;
            border-radius: 25px !important;
            padding: 0.75rem 1.5rem !important;
            font-family: 'Roboto', 'Segoe UI', Arial, sans-serif !important;
            font-weight: 500 !important;
            cursor: pointer !important;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
            backdrop-filter: none !important;
            font-size: 0.9rem !important;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1) !important;
            opacity: 1 !important;
            min-width: auto !important;
            height: auto !important;
          `);
        } else if (urgency === 'Media') {
          button.setAttribute('style', `
            background: rgba(251, 191, 36, 0.15) !important;
            background-color: rgba(251, 191, 36, 0.15) !important;
            border: 1px solid rgba(251, 191, 36, 0.3) !important;
            color: #ffc107 !important;
            box-shadow: 0 0 15px rgba(251, 191, 36, 0.2) !important;
            border-radius: 25px !important;
            padding: 0.75rem 1.5rem !important;
            font-family: 'Roboto', 'Segoe UI', Arial, sans-serif !important;
            font-weight: 500 !important;
            cursor: pointer !important;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
            backdrop-filter: none !important;
            font-size: 0.9rem !important;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1) !important;
            opacity: 1 !important;
            min-width: auto !important;
            height: auto !important;
          `);
        } else if (urgency === 'Baja') {
          button.setAttribute('style', `
            background: rgba(34, 197, 94, 0.15) !important;
            background-color: rgba(34, 197, 94, 0.15) !important;
            border: 1px solid rgba(34, 197, 94, 0.3) !important;
            color: #4caf50 !important;
            box-shadow: 0 0 15px rgba(34, 197, 94, 0.2) !important;
            border-radius: 25px !important;
            padding: 0.75rem 1.5rem !important;
            font-family: 'Roboto', 'Segoe UI', Arial, sans-serif !important;
            font-weight: 500 !important;
            cursor: pointer !important;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
            backdrop-filter: none !important;
            font-size: 0.9rem !important;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1) !important;
            opacity: 1 !important;
            min-width: auto !important;
            height: auto !important;
          `);
        }
      });
    }


    // Ejecutar cuando se carga la página
    document.addEventListener('DOMContentLoaded', () => {
      // Ejecutar inmediatamente
      enforceUrgencyColors();
      
      // Ejecutar con menos frecuencia para mejor rendimiento
      setInterval(enforceUrgencyColors, 3000); // Cambiar de 100ms a 3s
      
      // Ejecutar en eventos con debounce para mejor rendimiento
      let urgencyTimeout;
      document.addEventListener('click', () => {
        clearTimeout(urgencyTimeout);
        urgencyTimeout = setTimeout(enforceUrgencyColors, 100);
      });
      document.addEventListener('mouseenter', () => {
        clearTimeout(urgencyTimeout);
        urgencyTimeout = setTimeout(enforceUrgencyColors, 200);
      }, true);
      document.addEventListener('focus', () => {
        clearTimeout(urgencyTimeout);
        urgencyTimeout = setTimeout(enforceUrgencyColors, 200);
      }, true);
      
      // Observar cambios en el DOM de forma optimizada
      let urgencyObserverTimeout;
      const observer = new MutationObserver((mutations) => {
        clearTimeout(urgencyObserverTimeout);
        urgencyObserverTimeout = setTimeout(() => {
          let shouldUpdate = false;
          mutations.forEach(mutation => {
            if (mutation.type === 'childList') {
              // Solo verificar si se añaden botones de urgencia específicos
              mutation.addedNodes.forEach(node => {
                if (node.nodeType === Node.ELEMENT_NODE) {
                  if (node.classList?.contains('ops-hub-chip') || 
                      (node.id === 'dashboardModal' && node.querySelector?.('.ops-hub-chip[data-urgency]'))) {
                    shouldUpdate = true;
                  }
                }
              });
            } else if (mutation.type === 'attributes') {
              // Solo para botones de urgencia específicos
              if (mutation.target.classList?.contains('ops-hub-chip') && 
                  mutation.target.hasAttribute('data-urgency')) {
                shouldUpdate = true;
              }
            }
          });
          
          if (shouldUpdate) {
            enforceUrgencyColors();
          }
        }, 300); // Debounce de 300ms
      });
      
      // Observar solo el modal del dashboard en lugar de todo el documento
      const dashboardModal = document.getElementById('dashboardModal');
      if (dashboardModal) {
        observer.observe(dashboardModal, {
          childList: true,
          subtree: true,
          attributes: true,
          attributeFilter: ['class', 'style', 'data-urgency']
        });
      }
      
      // También escuchar eventos específicos del dashboard con debounce
      let dashboardEventTimeout;
      document.addEventListener('dashboardOpened', () => {
        clearTimeout(dashboardEventTimeout);
        dashboardEventTimeout = setTimeout(enforceUrgencyColors, 100);
      });
      
      document.addEventListener('opsHubRendered', () => {
        clearTimeout(dashboardEventTimeout);
        dashboardEventTimeout = setTimeout(enforceUrgencyColors, 100);
      });
    });
  </script>
<!-- Analytics Dashboard desactivado por rendimiento -->
<!-- <script type="module" src="src/analytics/AnalyticsDashboard.js"></script> -->
  <script>
  // Cierre del modal de Custom Summary
  const summaryModal = document.getElementById('summaryModal');
  const closeSummaryModalBtn = document.getElementById('closeSummaryModalBtn');
  const closeSummaryModalFooterBtn = document.getElementById('closeSummaryModalFooterBtn');
  if (closeSummaryModalBtn) {
    closeSummaryModalBtn.onclick = () => summaryModal.classList.add('hidden');
  }
  if (closeSummaryModalFooterBtn) {
    closeSummaryModalFooterBtn.onclick = () => summaryModal.classList.add('hidden');
  }

  // FORZAR FUNCIONALIDAD DE BOTONES X EN CUSTOM SUMMARY
  function forceRemoveButtonsInSummary() {
    // Buscar todos los botones X en el modal de summary
    const summaryModal = document.getElementById('summaryModal');
    if (!summaryModal || summaryModal.classList.contains('hidden')) return;

    // FORZAR Z-INDEX DE DROPDOWNS Y LIMITAR A 2 FILAS
    const dropdowns = summaryModal.querySelectorAll('.choices__list--dropdown');
    dropdowns.forEach(dropdown => {
      dropdown.style.setProperty('z-index', '9999999', 'important');
      dropdown.style.setProperty('position', 'absolute', 'important');
      dropdown.style.setProperty('max-height', '96px', 'important'); /* 2 filas */
      dropdown.style.setProperty('overflow-y', 'auto', 'important');
      dropdown.style.setProperty('overflow-x', 'hidden', 'important');
    });

    // FORZAR Z-INDEX DE CONTENEDORES CHOICES Y ELIMINAR SCROLLBARS DUPLICADOS
    const choicesContainers = summaryModal.querySelectorAll('.choices');
    choicesContainers.forEach(container => {
      container.style.setProperty('z-index', '9999999', 'important');
      container.style.setProperty('position', 'relative', 'important');
      container.style.setProperty('overflow', 'visible', 'important'); /* No scroll en contenedor */
    });

    // ELIMINAR SCROLL DE OTROS ELEMENTOS
    const choicesInners = summaryModal.querySelectorAll('.choices__inner');
    choicesInners.forEach(inner => {
      inner.style.setProperty('overflow', 'visible', 'important');
    });

    const choicesLists = summaryModal.querySelectorAll('.choices__list:not(.choices__list--dropdown)');
    choicesLists.forEach(list => {
      list.style.setProperty('overflow', 'visible', 'important');
    });

    const removeButtons = summaryModal.querySelectorAll('.choices__button, .search-choice-close');
    
    removeButtons.forEach(button => {
      // Asegurar que el botón sea visible y funcional
      button.style.setProperty('display', 'flex', 'important');
      button.style.setProperty('background', '#dc3545', 'important');
      button.style.setProperty('color', '#ffffff', 'important');
      button.style.setProperty('cursor', 'pointer', 'important');
      button.style.setProperty('pointer-events', 'auto', 'important');
      button.style.setProperty('opacity', '1', 'important');
      button.style.setProperty('visibility', 'visible', 'important');
      button.style.setProperty('z-index', '999999', 'important');
      button.style.setProperty('width', '20px', 'important');
      button.style.setProperty('height', '20px', 'important');
      button.style.setProperty('border-radius', '3px', 'important');
      button.style.setProperty('align-items', 'center', 'important');
      button.style.setProperty('justify-content', 'center', 'important');
      button.style.setProperty('font-size', '14px', 'important');
      button.style.setProperty('font-weight', '700', 'important');
      button.style.setProperty('border', 'none', 'important');
      button.style.setProperty('margin-left', '8px', 'important');
      
      // Forzar evento click si no existe
      if (!button.hasAttribute('data-click-forced')) {
        button.setAttribute('data-click-forced', 'true');
        
        button.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          
          // Encontrar el item padre y eliminarlo
          const choiceItem = this.closest('.choices__item');
          if (choiceItem) {
            // Simular evento de eliminación
            const removeEvent = new CustomEvent('removeItem', {
              detail: { item: choiceItem },
              bubbles: true
            });
            
            choiceItem.dispatchEvent(removeEvent);
            
            // Si no funciona, remover directamente
            setTimeout(() => {
              if (choiceItem.parentNode) {
                choiceItem.remove();
              }
            }, 50);
          }
          
          // También intentar disparar evento en el select original
          const choicesContainer = this.closest('.choices');
          if (choicesContainer) {
            const originalSelect = choicesContainer.previousElementSibling;
            if (originalSelect && originalSelect.tagName === 'SELECT') {
              // Resetear el select
              originalSelect.selectedIndex = -1;
              originalSelect.value = '';
              
              // Disparar evento change
              const changeEvent = new Event('change', { bubbles: true });
              originalSelect.dispatchEvent(changeEvent);
            }
          }
        });
      }
    });
  }

  // Ejecutar cuando se abre el modal y periódicamente
  document.addEventListener('DOMContentLoaded', () => {
    // Observer para cuando se abre el modal
    const summaryModalObserver = new MutationObserver((mutations) => {
      mutations.forEach(mutation => {
        if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
          const modal = mutation.target;
          if (modal.id === 'summaryModal' && !modal.classList.contains('hidden')) {
            setTimeout(forceRemoveButtonsInSummary, 100);
            setTimeout(forceRemoveButtonsInSummary, 500);
            setTimeout(forceRemoveButtonsInSummary, 1000);
          }
        }
      });
    });

    const summaryModal = document.getElementById('summaryModal');
    if (summaryModal) {
      summaryModalObserver.observe(summaryModal, {
        attributes: true,
        attributeFilter: ['class']
      });
    }

    // También ejecutar cuando se añaden elementos al DOM
    const summaryContentObserver = new MutationObserver(() => {
      setTimeout(forceRemoveButtonsInSummary, 50);
    });

    if (summaryModal) {
      summaryContentObserver.observe(summaryModal, {
        childList: true,
        subtree: true
      });
    }

    // Ejecutar con menos frecuencia cuando el modal esté abierto
    setInterval(() => {
      const modal = document.getElementById('summaryModal');
      if (modal && !modal.classList.contains('hidden')) {
        forceRemoveButtonsInSummary();
      }
    }, 5000); // Cambiar de 1000ms a 5000ms

    // Event listener específico para dropdowns con debounce
    let dropdownStyleTimeout;
    document.addEventListener('click', (e) => {
      const summaryModal = document.getElementById('summaryModal');
      if (summaryModal && !summaryModal.classList.contains('hidden')) {
        // Si se hace click en un dropdown, usar debounce para mejor rendimiento
        if (e.target.closest('.choices')) {
          clearTimeout(dropdownStyleTimeout);
          dropdownStyleTimeout = setTimeout(() => {
            // Solo el dropdown debe tener scroll
            const dropdowns = summaryModal.querySelectorAll('.choices__list--dropdown');
            dropdowns.forEach(dropdown => {
              if (!dropdown.classList.contains('is-hidden')) {
                dropdown.style.setProperty('z-index', '9999999', 'important');
                dropdown.style.setProperty('position', 'absolute', 'important');
                dropdown.style.setProperty('background', '#E3F2FD', 'important');
                dropdown.style.setProperty('border', '2px solid #47B2E5', 'important');
                dropdown.style.setProperty('box-shadow', '0 12px 40px rgba(0, 0, 0, 0.8)', 'important');
                dropdown.style.setProperty('max-height', '96px', 'important'); /* 2 filas */
                dropdown.style.setProperty('overflow-y', 'auto', 'important');
                dropdown.style.setProperty('overflow-x', 'hidden', 'important');
              }
            });

            // Eliminar scroll de otros contenedores
            const choicesContainers = summaryModal.querySelectorAll('.choices');
            choicesContainers.forEach(container => {
              container.style.setProperty('overflow', 'visible', 'important');
            });

            const choicesInners = summaryModal.querySelectorAll('.choices__inner');
            choicesInners.forEach(inner => {
              inner.style.setProperty('overflow', 'visible', 'important');
            });

            const choicesLists = summaryModal.querySelectorAll('.choices__list:not(.choices__list--dropdown)');
            choicesLists.forEach(list => {
              list.style.setProperty('overflow', 'visible', 'important');
            });
          }, 100); // Debounce de 100ms
        }
      }
    });
  });
  </script>
  <script>
  const legalNoticeTrigger = document.getElementById('legalNoticeTrigger');
  const legalNoticeModal = document.getElementById('legalNoticeModal');
  const closeLegalNoticeBtn = document.getElementById('closeLegalNoticeBtn');
  // Desactivar modal al hacer click en el copyright
  if (legalNoticeTrigger) {
    legalNoticeTrigger.style.cursor = 'default';
    legalNoticeTrigger.style.pointerEvents = 'none';
    legalNoticeTrigger.onclick = null;
  }
  if (closeLegalNoticeBtn && legalNoticeModal) {
    closeLegalNoticeBtn.onclick = () => legalNoticeModal.classList.add('hidden');
    // Cerrar al hacer click fuera del panel
    legalNoticeModal.onclick = (e) => {
      if (e.target === legalNoticeModal) legalNoticeModal.classList.add('hidden');
    };
  }
  </script>

  <!-- Copy Options Modal -->
  <div id="copyOptionsModal" class="modal-overlay hidden">
    <div class="modal-panel" style="max-width:600px;">
      <div class="modal-header">
        <div class="header-left">
          <img src="LOGOTAB_rounded.png" alt="Logo" class="modal-logo">
          <h3 class="panel-header-title">Copy Options</h3>
        </div>
        <button id="closeCopyOptionsBtn" class="close-btn">X</button>
      </div>
      <div class="modal-content">
        <div style="margin-bottom:1.5rem;">
          <p style="color:#666; margin-bottom:1rem;">Choose how you want to copy the filtered data:</p>
          
          <div class="copy-option-section">
            <label style="font-weight:600; display:block; margin-bottom:0.5rem;">Remove duplicates by column:</label>
            <div style="font-size:12px; color:#888; margin-bottom:0.75rem;">Only one row will be included for each unique combination of the selected columns.</div>
            <select id="copyDedupeColumnsSelect" multiple class="dedupe-columns-select" style="width:100%; min-width:200px; min-height:120px;"></select>
            <div style="display:flex; gap:0.5rem; margin-top:0.5rem;">
              <button id="selectAllCopyBtn" class="modal-btn secondary small">Select All</button>
              <button id="deselectAllCopyBtn" class="modal-btn secondary small">Deselect All</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button id="copyWithoutDedupeBtn" class="modal-btn secondary">Copy Without Deduplication</button>
        <button id="copyWithDedupeBtn" class="modal-btn primary">Copy with Deduplication</button>
      </div>
    </div>
  </div>

  <!-- CSV Loading Progress Bar -->
  <div id="csvLoadingBar" style="width:0;height:4px;background:linear-gradient(90deg,#47B2E5,#1976d2);margin:0 auto;transition:width 0.3s cubic-bezier(0.4,0,0.2,1);display:none;"></div>
  
  <!-- ULTRA FORCE ONEDRIVE IMMEDIATE - MUST BE FIRST -->
      <!-- TEMPORARILY DISABLED: <script src="ultra-force-onedrive-immediate.js"></script> -->
  
  <!-- Fix Registration Modal Style -->
  <script src="fix-registration-modal-style.js"></script>
  
  <!-- DISABLE RENDER COMPLETELY - ONE DRIVE ONLY -->
  <script src="disable-render-completely.js"></script>
  
  <!-- Backend Configuration -->
  <script src="src/config/backend.js"></script>
  
  <!-- Backend Service -->
  <script src="src/services/backendService.js"></script>
  
  <!-- Backend Configuration Modal -->
  <div id="backendConfigModal" class="modal-overlay hidden" style="background: rgba(0, 0, 0, 0.3); backdrop-filter: blur(5px);">
    <div class="modal-panel" style="max-width:600px; background: #E3F2FD !important; border: 1px solid rgba(71, 178, 229, 0.3); box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5); opacity: 1 !important;">
      <div class="modal-header">
        <div class="header-left">
          <img src="LOGOTAB_rounded.png" alt="Logo" class="modal-logo">
          <h3 class="panel-header-title">Backend Configuration</h3>
        </div>
        <button id="closeBackendConfigBtn" class="close-btn">X</button>
      </div>
      <div class="modal-content">
        <div style="margin-bottom:1.5rem;">
          <p style="color:#E8F4F8; margin-bottom:1rem; font-size:1.1em;">Configure where your data versions will be stored:</p>
          
          <div class="config-section">
            <label style="font-weight:600; display:block; margin-bottom:0.5rem; color:#E8F4F8;">Storage Location:</label>
            <select id="storageLocationSelect" style="width:100%; padding:0.5rem; margin-bottom:1rem; border-radius:4px;">
              <option value="onedrive">OneDrive (Recommended for Windows)</option>
              <option value="documents">Documents (Local only)</option>
              <option value="custom">Custom folder</option>
            </select>
          </div>
          
          <div id="customPathSection" class="config-section" style="display:none; margin-bottom:1rem;">
            <label style="font-weight:600; display:block; margin-bottom:0.5rem; color:#E8F4F8;">Custom Folder Path:</label>
            <input type="text" id="customPathInput" placeholder="C:\Users\YourName\Desktop\MyData" style="width:100%; padding:0.5rem; border-radius:4px;">
            <div style="font-size:0.9em; color:#B0BEC5; margin-top:0.25rem;">Enter the full path to your preferred folder</div>
          </div>
          
          <div class="config-section">
            <label style="font-weight:600; display:block; margin-bottom:0.5rem; color:#E8F4F8;">Password Protection:</label>
            <input type="password" id="backendPasswordInput" placeholder="Enter password to protect your data" style="width:100%; padding:0.5rem; border-radius:4px;">
            <div style="font-size:0.9em; color:#B0BEC5; margin-top:0.25rem;">This password will be required to access your data</div>
          </div>
        </div>
        
        <div id="backendConfigStatus" style="margin-top:1rem; font-size:0.95em; color:#1976d2;"></div>
      </div>
      <div class="modal-footer">
        <button id="testBackendConfigBtn" class="modal-btn secondary">Test Configuration</button>
        <button id="saveBackendConfigBtn" class="modal-btn primary">Save Configuration</button>
      </div>
    </div>
  </div>

  <!-- Team Profile Creation Modal -->
  <div id="teamProfileModal" class="modal-overlay hidden" style="background: rgba(0, 0, 0, 0.8) !important; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); display: flex; justify-content: center; align-items: center; z-index: 10000;">
    <div class="modal-panel" style="max-width:700px; background: #E3F2FD !important; border: 1px solid rgba(0, 0, 0, 0.1); border-radius: 16px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6); opacity: 1 !important; position: relative; overflow: hidden;">
      <div class="modal-header" style="text-align: center; margin-bottom: 2rem; position: relative; padding: 2rem 2rem 0 2rem;">
        <div class="header-left" style="display: flex; align-items: center; justify-content: center; gap: 1rem;">
          <img src="LOGOTAB_rounded.png" alt="Logo" class="modal-logo" style="width: 40px; height: 40px; border-radius: 8px;">
          <h3 class="panel-header-title" style="color: #000000; margin: 0; font-size: 1.8rem; font-weight: 600;">Team Profile Setup</h3>
        </div>
        <button id="closeTeamProfileBtn" class="close-btn" style="
          position: absolute;
          top: 1rem;
          right: 1rem;
          background: rgba(255, 255, 255, 0.1);
          border: none;
          color: #E8F4F8;
          font-size: 1.5rem;
          width: 40px;
          height: 40px;
          border-radius: 50%;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: all 0.3s ease;
        " onmouseover="this.style.background='rgba(255, 255, 255, 0.2)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.1)'">X</button>
      </div>
      <div class="modal-content" style="padding: 0 2rem 2rem 2rem;">
        <div style="margin-bottom:2rem;">
          <p style="color:#E8F4F8; margin-bottom:1.5rem; font-size:1.1em; line-height:1.6;">
            Welcome to The Bridge! Let's set up your team profile. This will create a dedicated folder for your team's data versions.
          </p>
          
          <div class="team-section" style="margin-bottom:2rem;">
            <h4 style="color:#47B2E5; margin-bottom:1rem; font-size:1.2em;">Create Your Team</h4>
            
            <div class="form-group" style="margin-bottom:1.5rem;">
              <label style="font-weight:600; display:block; margin-bottom:0.5rem; color:#E8F4F8;">Team Name:</label>
              <input type="text" id="teamNameInput" placeholder="e.g., Operations Team, Data Quality Team" style="width:100%; padding:0.75rem; border-radius:6px; border:1px solid rgba(71,178,229,0.3); background:rgba(26,35,50,0.8); color:#E8F4F8;">
              <div style="font-size:0.9em; color:#B0BEC5; margin-top:0.25rem;">This will be your team's workspace name</div>
            </div>
            
            <div class="form-group" style="margin-bottom:1.5rem;">
              <label style="font-weight:600; display:block; margin-bottom:0.5rem; color:#E8F4F8;">Your Email:</label>
              <input type="email" id="adminEmailInput" placeholder="your.email@company.com" style="width:100%; padding:0.75rem; border-radius:6px; border:1px solid rgba(71,178,229,0.3); background:rgba(26,35,50,0.8); color:#E8F4F8;">
              <div style="font-size:0.9em; color:#B0BEC5; margin-top:0.25rem;">You'll be the administrator of this team</div>
            </div>
          </div>
          
          <div style="background: rgba(71, 178, 229, 0.1); border: 1px solid #47B2E5; border-radius: 8px; padding: 1.5rem; margin-bottom: 1.5rem;">
            <h5 style="margin: 0 0 1rem 0; color: #47B2E5; font-size: 1.1em;">What happens next?</h5>
            <ul style="margin: 0; padding-left: 1.5rem; color: #E8F4F8; line-height: 1.6;">
              <li>Your team workspace will be created</li>
              <li>You'll be set as the team administrator</li>
              <li>All your data will be synced to OneDrive</li>
              <li>You can invite team members later</li>
            </ul>
          </div>
        </div>
        
        <div id="teamProfileStatus" style="margin-top:1rem; font-size:0.95em; color:#1976d2;"></div>
      </div>
      <div class="modal-footer" style="padding: 1.5rem 2rem; border-top: 1px solid rgba(255, 255, 255, 0.1); display: flex; gap: 1rem; justify-content: flex-end;">

        <button id="createTeamProfileBtn" class="modal-btn primary" style="
          background: linear-gradient(135deg, #47B2E5 0%, #1976d2 100%);
          border: none;
          color: white;
          padding: 0.75rem 1.5rem;
          border-radius: 8px;
          cursor: pointer;
          font-weight: 600;
          transition: all 0.3s ease;
          box-shadow: 0 2px 8px rgba(71, 178, 229, 0.3);
        " onmouseover="this.style.background='linear-gradient(135deg, #1976d2 0%, #1565c0 100%)'" onmouseout="this.style.background='linear-gradient(135deg, #47B2E5 0%, #1976d2 100%)'">Create Team Profile</button>
      </div>
    </div>
  </div>

  <!-- Team Login Modal -->
  <div id="teamLoginModal" class="modal-overlay hidden" style="background: rgba(0, 0, 0, 0.8) !important; backdrop-filter: none; -webkit-backdrop-filter: none; display: flex; justify-content: center; align-items: center; z-index: 10000;">
    <div style="
      background: #1a2332 !important;
      background-color: #1a2332 !important;
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: 16px;
      padding: 2.5rem;
      max-width: 500px;
      width: 90%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.4);
      position: relative;
      overflow: hidden;
    ">
      
      <!-- Header -->
      <div style="text-align: center; margin-bottom: 2rem; position: relative;">
        <h3 style="color: #E8F4F8; margin: 0 0 0.5rem 0; font-size: 1.8rem; font-weight: 600;">Team Access</h3>
        <p style="color: #7BA7CC; margin: 0; font-size: 1rem;">Access your team's workspace</p>
        
        <!-- Close button -->
        <button id="closeTeamLoginBtn" class="close-btn" style="position: absolute; top: -1rem; right: -1rem;">X</button>
      </div>
      
      <!-- Tabs -->
      <div style="display: flex; margin-bottom: 2rem; background: rgba(255, 255, 255, 0.05); border-radius: 12px; padding: 4px; position: relative;">
        <button id="teamLoginTab" style="
          flex: 1;
          padding: 12px 16px;
          background: linear-gradient(135deg, #47B2E5 0%, #1976d2 100%);
          border: none;
          color: white;
          border-radius: 8px;
          cursor: pointer;
          font-weight: 600;
          transition: all 0.3s ease;
          box-shadow: 0 2px 8px rgba(71, 178, 229, 0.3);
        ">Access Team</button>
        <button id="teamJoinTab" style="
          flex: 1;
          padding: 12px 16px;
          background: transparent;
          border: none;
          color: #B0BEC5;
          border-radius: 8px;
          cursor: pointer;
          font-weight: 600;
          transition: all 0.3s ease;
        ">Join New Team</button>
      </div>
      
      <!-- Login Panel -->
      <div id="teamLoginPanel" style="position: relative;">
        <div style="margin-bottom: 1.5rem;">
          <label style="display: block; margin-bottom: 0.5rem; color: #E8F4F8; font-weight: 600;">Select Your Team:</label>
          <select id="teamLoginSelect" style="
            width: 100%;
            padding: 12px 16px;
            border-radius: 12px;
            border: 1px solid rgba(71, 178, 229, 0.3);
            background: rgba(255, 255, 255, 0.05);
            color: #E8F4F8;
            font-size: 1rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
          " onfocus="this.style.borderColor='#47B2E5'; this.style.boxShadow='0 0 0 3px rgba(71, 178, 229, 0.1)'" onblur="this.style.borderColor='rgba(71, 178, 229, 0.3)'; this.style.boxShadow='none'">
            <option value="">Select your team...</option>
          </select>
        </div>
        
        <div style="margin-bottom: 1.5rem;">
          <label style="display: block; margin-bottom: 0.5rem; color: #E8F4F8; font-weight: 600;">Your Email:</label>
          <input type="email" id="teamLoginEmail" placeholder="your@email.com" style="
            width: 100%;
            padding: 12px 16px;
            border-radius: 12px;
            border: 1px solid rgba(71, 178, 229, 0.3);
            background: rgba(255, 255, 255, 0.05);
            color: #E8F4F8;
            font-size: 1rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
          " onfocus="this.style.borderColor='#47B2E5'; this.style.boxShadow='0 0 0 3px rgba(71, 178, 229, 0.1)'" onblur="this.style.borderColor='rgba(71, 178, 229, 0.3)'; this.style.boxShadow='none'">
        </div>
        
        <div style="
          margin-bottom: 2rem;
          padding: 1rem;
          background: rgba(16, 185, 129, 0.1);
          border-radius: 12px;
          border: 1px solid rgba(16, 185, 129, 0.3);
        ">
          <div style="color: #10B981; font-size: 0.9rem; display: flex; align-items: center; gap: 0.5rem;">
            <span style="
              width: 20px;
              height: 20px;
              background: rgba(16, 185, 129, 0.2);
              border-radius: 50%;
              display: flex;
              align-items: center;
              justify-content: center;
              font-size: 0.8rem;
            ">✓</span>
            <span>No password required - direct access to your teams</span>
          </div>
        </div>
      </div>
          
      <!-- Join Team Panel -->
      <div id="teamJoinPanel" style="display: none; position: relative;">
        <div style="margin-bottom: 1.5rem;">
          <label style="display: block; margin-bottom: 0.5rem; color: #E8F4F8; font-weight: 600;">Team Code:</label>
          <input type="text" id="teamJoinCode" placeholder="Enter the team code provided by your admin" style="
            width: 100%;
            padding: 12px 16px;
            border-radius: 12px;
            border: 1px solid rgba(71, 178, 229, 0.3);
            background: rgba(255, 255, 255, 0.05);
            color: #E8F4F8;
            font-size: 1rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
          " onfocus="this.style.borderColor='#47B2E5'; this.style.boxShadow='0 0 0 3px rgba(71, 178, 229, 0.1)'" onblur="this.style.borderColor='rgba(71, 178, 229, 0.3)'; this.style.boxShadow='none'">
        </div>
        
        <div style="margin-bottom: 1.5rem;">
          <label style="display: block; margin-bottom: 0.5rem; color: #E8F4F8; font-weight: 600;">Your Email:</label>
          <input type="email" id="teamJoinEmail" placeholder="your@email.com" style="
            width: 100%;
            padding: 12px 16px;
            border-radius: 12px;
            border: 1px solid rgba(71, 178, 229, 0.3);
            background: rgba(255, 255, 255, 0.05);
            color: #E8F4F8;
            font-size: 1rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
          " onfocus="this.style.borderColor='#47B2E5'; this.style.boxShadow='0 0 0 3px rgba(71, 178, 229, 0.1)'" onblur="this.style.borderColor='rgba(71, 178, 229, 0.3)'; this.style.boxShadow='none'">
        </div>
        
        <div style="margin-bottom: 1.5rem;">
          <label style="display: block; margin-bottom: 0.5rem; color: #E8F4F8; font-weight: 600;">Your Name:</label>
          <input type="text" id="teamJoinName" placeholder="Your full name" style="
            width: 100%;
            padding: 12px 16px;
            border-radius: 12px;
            border: 1px solid rgba(71, 178, 229, 0.3);
            background: rgba(255, 255, 255, 0.05);
            color: #E8F4F8;
            font-size: 1rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
          " onfocus="this.style.borderColor='#47B2E5'; this.style.boxShadow='0 0 0 3px rgba(71, 178, 229, 0.1)'" onblur="this.style.borderColor='rgba(71, 178, 229, 0.3)'; this.style.boxShadow='none'">
        </div>
        
        <div style="margin-bottom: 1.5rem;">
          <label style="display: block; margin-bottom: 0.5rem; color: #E8F4F8; font-weight: 600;">Password:</label>
          <input type="password" id="teamJoinPassword" placeholder="Create a password for your account" style="
            width: 100%;
            padding: 12px 16px;
            border-radius: 12px;
            border: 1px solid rgba(71, 178, 229, 0.3);
            background: rgba(255, 255, 255, 0.05);
            color: #E8F4F8;
            font-size: 1rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
          " onfocus="this.style.borderColor='#47B2E5'; this.style.boxShadow='0 0 0 3px rgba(71, 178, 229, 0.1)'" onblur="this.style.borderColor='rgba(71, 178, 229, 0.3)'; this.style.boxShadow='none'">
        </div>
        
        <div style="margin-bottom: 2rem;">
          <div style="
              background: rgba(16, 185, 129, 0.1);
              border: 1px solid rgba(16, 185, 129, 0.3);
              border-radius: 12px;
            padding: 1rem;
            text-align: center;
          ">
            <div style="color: #10B981; font-size: 0.9rem; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
              <span style="
                width: 20px;
                height: 20px;
                background: rgba(16, 185, 129, 0.2);
                border-radius: 50%;
              display: flex;
              align-items: center;
                justify-content: center;
                font-size: 0.8rem;
              ">👤</span>
              <span>You will join as a <strong>User</strong> - View and work with team data</span>
          </div>
          </div>
        </div>
      </div>
          

      
      <!-- Status Message -->
      <div id="teamLoginStatus" style="
        margin-bottom: 1.5rem;
        padding: 1rem;
        border-radius: 12px;
        display: none;
        text-align: center;
        font-weight: 600;
      "></div>
      
      <!-- Action Buttons -->
      <button id="teamLoginBtn" style="
        width: 100%;
        padding: 14px 24px;
        background: linear-gradient(135deg, #47B2E5 0%, #1976d2 100%);
        border: none;
        border-radius: 12px;
        color: white;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(71, 178, 229, 0.4);
        position: relative;
        overflow: hidden;
      " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(71, 178, 229, 0.5)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(71, 178, 229, 0.4)'">
        Access Team
      </button>
      
      <button id="teamJoinBtn" style="
        width: 100%;
        padding: 14px 24px;
        background: linear-gradient(135deg, #10B981 0%, #059669 100%);
        border: none;
        border-radius: 12px;
        color: white;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        position: relative;
        overflow: hidden;
        display: none;
      " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(16, 185, 129, 0.5)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(16, 185, 129, 0.4)'">
        Join New Team
      </button>
    </div>
  </div>


  
  <!-- DQ Hub Search Script -->
  <script>
  // Set up DQ duplicate columns search functionality
  document.addEventListener('DOMContentLoaded', function() {
    // Observer for when DQ modal opens
    const dqModalObserver = new MutationObserver((mutations) => {
      mutations.forEach(mutation => {
        if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
          const modal = mutation.target;
          if (modal.id === 'dqSummaryModal' && !modal.classList.contains('hidden')) {
            setTimeout(setupDqSearch, 100);
            setTimeout(setupDqSearch, 500);
          }
        }
      });
    });

    const dqModal = document.getElementById('dqSummaryModal');
    if (dqModal) {
      dqModalObserver.observe(dqModal, {
        attributes: true,
        attributeFilter: ['class']
      });
    }

    function setupDqSearch() {
      const searchInput = document.getElementById('dqDuplicateColumnsSearch');
      if (searchInput && !searchInput.hasAttribute('data-search-setup')) {
        searchInput.setAttribute('data-search-setup', 'true');
        console.log('DQ Setting up search input event listener');
        
        searchInput.addEventListener('input', function() {
          console.log('DQ Search input event triggered from script');
          if (window.dqHubSummaryInstance) {
            window.dqHubSummaryInstance.filterDuplicateColumns();
          }
        });
      }
    }
  });
  </script>
  <script>
// Simple button setup for debugging - Using setTimeout to ensure all elements are loaded
setTimeout(function() {
    console.log('Setting up dashboard buttons...');
    
    // Find buttons with multiple attempts
    function findButtons() {
        const saveDashboardConfigBtn = document.getElementById('saveDashboardConfigBtn');
        console.log('Save button found:', !!saveDashboardConfigBtn);
        
        if (!saveDashboardConfigBtn) {
            console.log('Buttons not found, retrying in 500ms...');
            setTimeout(findButtons, 500);
            return;
        }
        
        // Setup Save to OneDrive button - now uses the dedicated function
        console.log('Setting up Save to OneDrive button...');
        saveDashboardConfigBtn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('Save to OneDrive button clicked - calling saveToOneDrive()');
            if (typeof saveToOneDrive === 'function') {
                saveToOneDrive();
            } else {
                console.error('saveToOneDrive function not available');
            }
        });
        
        // Setup Load from OneDrive button
        const loadDashboardConfigBtn = document.getElementById('loadDashboardConfigBtn');
        console.log('Load button found:', !!loadDashboardConfigBtn);
        
        if (loadDashboardConfigBtn) {
            console.log('Setting up Load from OneDrive button...');
            loadDashboardConfigBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Load from OneDrive button clicked - calling loadFromOneDrive()');
                if (typeof loadFromOneDrive === 'function') {
                    loadFromOneDrive();
                } else {
                    console.error('loadFromOneDrive function not available');
                }
            });
        }
        
        // Setup Save to Folder button
        const saveToFolderBtn = document.getElementById('saveToFolderBtn_user');
        console.log('Save to Folder button found:', !!saveToFolderBtn);
        
        if (saveToFolderBtn) {
            console.log('Setting up Save to Folder button...');
            saveToFolderBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Save to Folder button clicked - calling executeSaveToFolder()');
                executeSaveToFolder();
            });
        }
        
        // Setup Load from Folder button
        const loadFromFolderBtn = document.getElementById('loadFromFolderBtn_user');
        console.log('Load from Folder button found:', !!loadFromFolderBtn);
        
        if (loadFromFolderBtn) {
            console.log('Setting up Load from Folder button...');
            loadFromFolderBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Load from Folder button clicked - calling executeLoadFromFolder()');
                executeLoadFromFolder();
            });
        }
        
        // Setup Set OneDrive Path button
        const setOneDrivePathBtn = document.getElementById('setOneDrivePathBtn');
        console.log('Set OneDrive Path button found:', !!setOneDrivePathBtn);
        
        if (setOneDrivePathBtn) {
            console.log('Setting up Set OneDrive Path button...');
            setOneDrivePathBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Set OneDrive Path button clicked - calling setOneDrivePath()');
                if (typeof setOneDrivePath === 'function') {
                    setOneDrivePath();
                } else {
                    console.error('setOneDrivePath function not available');
                }
            });
        }
        
        console.log('✅ All buttons configured successfully!');
    }
    
    findButtons();
}, 500); // Wait 0.5 seconds for everything to load

// Simple verification that buttons are working
setTimeout(function() {
    console.log('🔧 Button verification complete - Ready to use!');
    console.log('🔧 Function test:', {
        saveToOneDrive: typeof saveToOneDrive,
        loadFromOneDrive: typeof loadFromOneDrive,
        setOneDrivePath: typeof setOneDrivePath
    });
    
            // Test the functions are accessible
        if (typeof saveToOneDrive === 'function' && typeof loadFromOneDrive === 'function' && typeof setOneDrivePath === 'function') {
            console.log('✅ All OneDrive functions are ready and accessible!');
        } else {
            console.error('❌ OneDrive functions not accessible! Check for errors.');
            console.log('Available functions:', {
                saveToOneDrive: typeof saveToOneDrive,
                loadFromOneDrive: typeof loadFromOneDrive,
                setOneDrivePath: typeof setOneDrivePath
            });
        }
}, 2000);

// Add click test for debugging
document.addEventListener('click', function(e) {
    if (e.target.id === 'saveDashboardConfigBtn' || e.target.id === 'loadDashboardConfigBtn' || e.target.id === 'setOneDrivePathBtn') {
        console.log('Button clicked via document listener:', e.target.id);
        
        // Execute button functionality directly
        if (e.target.id === 'saveDashboardConfigBtn') {
            console.log('Save to OneDrive button clicked - executing functionality');
            e.preventDefault();
            e.stopPropagation();
            if (typeof saveToOneDrive === 'function') {
                saveToOneDrive();
            }
        } else if (e.target.id === 'loadDashboardConfigBtn') {
            console.log('Load from OneDrive button clicked - executing functionality');
            e.preventDefault();
            e.stopPropagation();
            if (typeof loadFromOneDrive === 'function') {
                loadFromOneDrive();
            }
        } else if (e.target.id === 'setOneDrivePathBtn') {
            console.log('Set OneDrive Path button clicked - executing functionality');
            e.preventDefault();
            e.stopPropagation();
            if (typeof setOneDrivePath === 'function') {
                setOneDrivePath();
            }
        }
    }
});

// Test button availability when modal opens
document.addEventListener('DOMContentLoaded', function() {
    const userSetUpBtn = document.getElementById('userSetUpBtn');
    if (userSetUpBtn) {
        userSetUpBtn.addEventListener('click', function() {
            console.log('User modal opening, checking buttons...');
            setTimeout(async function() {
                const saveBtn = document.getElementById('saveDashboardConfigBtn');
                const loadBtn = document.getElementById('loadDashboardConfigBtn');
                const manageBtn = document.getElementById('manageDashboardConfigBtn');
                console.log('Modal opened - Save button:', !!saveBtn);
                console.log('Modal opened - Load button:', !!loadBtn);
                console.log('Modal opened - Manage button:', !!manageBtn);
                
                // Check backend status and update UI
                await updateBackendStatusUI();
            }, 100);
        });
    }
});

// AUTO-SAVE FUNCTIONALITY
let autoSaveTimeout = null;
let autoSaveEnabled = true;

// Función de guardado automático con debounce
async function autoSaveConfiguration() {
    if (!autoSaveEnabled) {
        console.log('🔄 Auto-save disabled, skipping...');
        return;
    }
    
    // Clear existing timeout
    if (autoSaveTimeout) {
        clearTimeout(autoSaveTimeout);
    }
    
    // Set new timeout for auto-save (2 seconds delay)
    autoSaveTimeout = setTimeout(async () => {
        console.log('🔄 Auto-saving configuration...');
        
        // Update indicator to show saving state
        const autoSaveIndicator = document.getElementById('autoSaveIndicator');
        if (autoSaveIndicator) {
            autoSaveIndicator.textContent = 'Saving...';
            autoSaveIndicator.className = 'auto-save-saving';
        }
        
        try {
            // Call the actual save logic without recursion
            await performActualSave();
            console.log('✅ Auto-save completed successfully');
            
            // Update indicator to show saved state briefly
            if (autoSaveIndicator) {
                autoSaveIndicator.textContent = 'Saved';
                autoSaveIndicator.className = 'auto-save-on';
                
                // Reset to normal state after 2 seconds
                setTimeout(() => {
                    if (autoSaveEnabled) {
                        autoSaveIndicator.textContent = 'Auto-save ON';
                        autoSaveIndicator.className = 'auto-save-on';
                    } else {
                        autoSaveIndicator.textContent = 'Auto-save OFF';
                        autoSaveIndicator.className = 'auto-save-off';
                    }
                }, 2000);
            }
        } catch (error) {
            console.error('❌ Auto-save failed:', error);
            
            // Update indicator to show error state
            if (autoSaveIndicator) {
                autoSaveIndicator.textContent = 'Save failed';
                autoSaveIndicator.className = 'auto-save-off';
                
                // Reset to normal state after 3 seconds
                setTimeout(() => {
                    if (autoSaveEnabled) {
                        autoSaveIndicator.textContent = 'Auto-save ON';
                        autoSaveIndicator.className = 'auto-save-on';
                    } else {
                        autoSaveIndicator.textContent = 'Auto-save OFF';
                        autoSaveIndicator.className = 'auto-save-off';
                    }
                }, 3000);
            }
        }
    }, 2000); // 2 second delay
}

// Función para habilitar/deshabilitar auto-save
function toggleAutoSave(enabled) {
    autoSaveEnabled = enabled;
    console.log(`🔄 Auto-save ${enabled ? 'enabled' : 'disabled'}`);
    
    // Update UI if needed
    const autoSaveIndicator = document.getElementById('autoSaveIndicator');
    if (autoSaveIndicator) {
        autoSaveIndicator.textContent = autoSaveEnabled ? 'Auto-save ON' : 'Auto-save OFF';
        autoSaveIndicator.className = autoSaveEnabled ? 'auto-save-on' : 'auto-save-off';
    }
}

// Función para configuraciones que deben disparar auto-save
function triggerAutoSave() {
    if (autoSaveEnabled) {
        console.log('🔄 Configuration changed, triggering auto-save...');
        autoSaveConfiguration();
    }
}

// Make auto-save functions available globally
window.triggerAutoSave = triggerAutoSave;
window.toggleAutoSave = toggleAutoSave;
window.autoSaveEnabled = autoSaveEnabled;

// Función que contiene la lógica real de guardado
async function performActualSave() {
    console.log('🔄 Performing actual save to backend...');
    console.log('🔍 Current backendUrl:', window.backendUrl);
    
    // Ensure backendUrl is set
    if (!window.backendUrl) {
        console.log('⚠️ BackendUrl not set, initializing...');
        initializeBackendConfig();
    }
    
    console.log('✅ Using backendUrl:', window.backendUrl);
    
    // Get current user info - try multiple sources
    let userEmail = 'default@user.com';
    let teamId = 'default-team';
    
    console.log('🔍 Detecting user info...', {
        'window.currentUser': window.currentUser,
        'window.currentTeam': window.currentTeam,
        'localStorage thebridge_current_user': localStorage.getItem('thebridge_current_user'),
        'localStorage thebridge_current_team': localStorage.getItem('thebridge_current_team')
    });
    
    // Try to get user from window object first
    if (window.currentUser && window.currentUser.email) {
        userEmail = window.currentUser.email;
        console.log('✅ Found user in window.currentUser:', userEmail);
    } else {
        // Try localStorage as fallback with correct key
        try {
            const storedUser = localStorage.getItem('thebridge_current_user');
            if (storedUser) {
                const parsedUser = JSON.parse(storedUser);
                if (parsedUser && parsedUser.email) {
                    userEmail = parsedUser.email;
                    console.log('✅ Found user in localStorage:', userEmail);
                }
            }
        } catch (e) {
            console.log('⚠️ Error parsing stored user:', e);
        }
    }
    
    // Try to get team info
    if (window.currentTeam && window.currentTeam.id) {
        teamId = window.currentTeam.id;
        console.log('✅ Found team in window.currentTeam:', teamId);
    } else {
        // Try localStorage as fallback with correct key
        try {
            const storedTeam = localStorage.getItem('thebridge_current_team');
            if (storedTeam) {
                const parsedTeam = JSON.parse(storedTeam);
                if (parsedTeam && parsedTeam.id) {
                    teamId = parsedTeam.id;
                    console.log('✅ Found team in localStorage:', teamId);
                }
            }
        } catch (e) {
            console.log('⚠️ Error parsing stored team:', e);
        }
    }
    
    console.log('🎯 Using user info:', { userEmail, teamId });
    
    try {
                 // Prepare configuration data
         let userName = 'Default User';
         let teamName = 'Default Team';
         
         // Get user name
         if (window.currentUser && window.currentUser.name) {
             userName = window.currentUser.name;
         } else {
             try {
                 const storedUser = localStorage.getItem('thebridge_current_user');
                 if (storedUser) {
                     const parsedUser = JSON.parse(storedUser);
                     if (parsedUser && parsedUser.name) {
                         userName = parsedUser.name;
                     }
                 }
             } catch (e) {
                 console.log('⚠️ Error getting user name:', e);
             }
         }
         
         // Get team name
         if (window.currentTeam && window.currentTeam.name) {
             teamName = window.currentTeam.name;
         } else {
             try {
                 const storedTeam = localStorage.getItem('thebridge_current_team');
                 if (storedTeam) {
                     const parsedTeam = JSON.parse(storedTeam);
                     if (parsedTeam && parsedTeam.name) {
                         teamName = parsedTeam.name;
                     }
                 }
             } catch (e) {
                 console.log('⚠️ Error getting team name:', e);
             }
         }
         
         // Recopilar TODA la configuración del usuario
         const config = {
             timestamp: new Date().toISOString(),
             
             // Configuración del dashboard
             dashboard: JSON.parse(localStorage.getItem('dashboardConfig') || '{}'),
             
            // Filtros y vistas
            filters: JSON.parse(localStorage.getItem('myFilters') || '{}'),
             quickFilters: JSON.parse(localStorage.getItem('quickFilters') || '{}'),
             tableViews: JSON.parse(localStorage.getItem('tableViews') || '{}'),
             
             // Resúmenes personalizados
             customSummaries: JSON.parse(localStorage.getItem('customSummaries') || '{}'),
             
             // Columnas y configuración de tabla
             columnConfig: JSON.parse(localStorage.getItem('columnConfig') || '{}'),
             visibleColumns: JSON.parse(localStorage.getItem('visibleColumns') || '[]'),
             columnOrder: JSON.parse(localStorage.getItem('columnOrder') || '[]'),
             
             // Favoritos y marcadores
             favoritos: JSON.parse(localStorage.getItem('favoritos') || '[]'),
             
             // Configuración de notificaciones
             notifications: JSON.parse(localStorage.getItem('notifications') || '{}'),
             
             // Configuración de tema y UI
             theme: localStorage.getItem('theme') || 'dark',
             language: localStorage.getItem('language') || 'es',
             
             // Configuración de backend
             backendSettings: JSON.parse(localStorage.getItem('backendSettings') || '{}'),
             
             // Datos de sesión actual (sin datos sensibles)
             currentSession: {
                 lastActivity: new Date().toISOString(),
                 dataVersion: localStorage.getItem('currentDataVersion') || null,
                 activeFilters: JSON.parse(localStorage.getItem('activeFilters') || '[]')
             },
             
             // Información del usuario y equipo
             userEmail: userEmail,
             userName: userName,
             teamId: teamId,
             teamName: teamName,
             
             // Metadatos
             version: '1.0',
             description: 'Configuración completa del usuario incluyendo filtros, vistas, resúmenes y preferencias'
         };
         
         console.log('📋 Final configuration data:', {
             userEmail,
             userName,
             teamId,
             teamName,
             configSize: JSON.stringify(config).length
         });
        
        // Create filename with timestamp
        const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
        const filename = `dashboard-config-${userEmail}-${timestamp}.json`;
        
        console.log('Saving configuration to backend...', filename);
        
        // Verificar que backendUrl sea válido antes de intentar guardar
        if (!window.backendUrl || window.backendUrl === 'offline' || window.backendUrl.includes('offline')) {
            throw new Error('Backend not available - use Save to Folder instead');
        }
        
        // Save to backend using new dashboard API
        const response = await fetch(`${window.backendUrl}/api/dashboard/save`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                filename: filename,
                settings: config,
                teamId: teamId,
                userEmail: userEmail
            })
        });
        
        if (response.ok) {
            const result = await response.json();
            console.log('✅ Configuration saved to backend:', result);
            
            // Show success notification
            if (typeof showNotification === 'function') {
                showNotification('Configuration saved to backend successfully!', 'success');
            } else {
                alert('✅ Configuration saved to your backend folder successfully!');
            }
        } else {
            throw new Error('Backend save failed');
        }
        
    } catch (error) {
        console.error('Error saving to backend:', error);
        if (typeof showNotification === 'function') {
            showNotification('Error saving to backend. Check if backend is available.', 'error');
        } else {
            alert('❌ Error saving to backend. Check if backend is available.');
        }
    }
}

// BUTTON FUNCTIONALITY FUNCTIONS
async function executeSaveToBackend() {
    console.log('🔄 Executing Save to Backend...');
    await performActualSave();
}

async function executeOpenBackendFolder() {
    console.log('🔄 Executing Open Backend Folder...');
    
    // Ensure backendUrl is set
    if (!window.backendUrl) {
        initializeBackendConfig();
    }
    
    // Get current user info - try multiple sources
    let userEmail = 'default@user.com';
    let teamId = 'default-team';
    
    console.log('🔍 Detecting user info for folder access...', {
        'window.currentUser': window.currentUser,
        'window.currentTeam': window.currentTeam,
        'localStorage thebridge_current_user': localStorage.getItem('thebridge_current_user'),
        'localStorage thebridge_current_team': localStorage.getItem('thebridge_current_team')
    });
    
    // Try to get user from window object first
    if (window.currentUser && window.currentUser.email) {
        userEmail = window.currentUser.email;
        console.log('✅ Found user in window.currentUser:', userEmail);
    } else {
        // Try localStorage as fallback with correct key
        try {
            const storedUser = localStorage.getItem('thebridge_current_user');
            if (storedUser) {
                const parsedUser = JSON.parse(storedUser);
                if (parsedUser && parsedUser.email) {
                    userEmail = parsedUser.email;
                    console.log('✅ Found user in localStorage:', userEmail);
                }
            }
        } catch (e) {
            console.log('⚠️ Error parsing stored user:', e);
        }
    }
    
    // Try to get team info
    if (window.currentTeam && window.currentTeam.id) {
        teamId = window.currentTeam.id;
        console.log('✅ Found team in window.currentTeam:', teamId);
    } else {
        // Try localStorage as fallback with correct key
        try {
            const storedTeam = localStorage.getItem('thebridge_current_team');
            if (storedTeam) {
                const parsedTeam = JSON.parse(storedTeam);
                if (parsedTeam && parsedTeam.id) {
                    teamId = parsedTeam.id;
                    console.log('✅ Found team in localStorage:', teamId);
                }
            }
        } catch (e) {
            console.log('⚠️ Error parsing stored team:', e);
        }
    }
    
    console.log('🎯 Using user info for folder access:', { userEmail, teamId });
    
    try {
        console.log('Opening backend folder for user configurations...');
        
        // Open user's backend folder using new dashboard API
        const response = await fetch(`${window.backendUrl}/api/dashboard/open-folder`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                teamId: teamId,
                userEmail: userEmail
            })
        });
        
        if (response.ok) {
            const result = await response.json();
            console.log('✅ Backend folder opened:', result);
            
            // Show success notification
            if (typeof showNotification === 'function') {
                showNotification('Backend folder opened successfully!', 'success');
            } else {
                alert('✅ Opening your backend folder with configurations...');
            }
            
            // Show available configurations
            if (result.files && result.files.length > 0) {
                const filesList = result.files.map(file => `• ${file}`).join('\n');
                setTimeout(() => {
                    if (typeof showNotification === 'function') {
                        showNotification(`Found ${result.files.length} saved configurations`, 'info');
                    } else {
                        alert(`📁 Your saved configurations:\n${filesList}`);
                    }
                }, 1000);
            } else {
                setTimeout(() => {
                    if (typeof showNotification === 'function') {
                        showNotification('No configurations found. Use "Save to Backend" to save configurations first!', 'info');
                    } else {
                        alert('📁 Folder opened but no configurations found yet.\nUse "Save to Backend" to save configurations first!');
                    }
                }, 1000);
            }
        } else {
            throw new Error('Backend folder access failed');
        }
        
    } catch (error) {
        console.error('Error opening backend folder:', error);
        if (typeof showNotification === 'function') {
            showNotification('Cannot access backend folder. Check if backend is running on port 3002.', 'error');
        } else {
            alert('❌ Cannot access your backend folder. Check if backend is running on port 3002.');
        }
    }
}

async function executeLoadFromBackend() {
    console.log('🔄 Executing Load from Backend...');
    
    // Ensure backendUrl is set
    if (!window.backendUrl) {
        initializeBackendConfig();
    }
    
    // Get current user info - try multiple sources
    let userEmail = 'default@user.com';
    let teamId = 'default-team';
    
    console.log('🔍 Detecting user info for loading...', {
        'window.currentUser': window.currentUser,
        'window.currentTeam': window.currentTeam,
        'localStorage thebridge_current_user': localStorage.getItem('thebridge_current_user'),
        'localStorage thebridge_current_team': localStorage.getItem('thebridge_current_team')
    });
    
    // Try to get user from window object first
    if (window.currentUser && window.currentUser.email) {
        userEmail = window.currentUser.email;
        console.log('✅ Found user in window.currentUser:', userEmail);
    } else {
        // Try localStorage as fallback
        try {
            const storedUser = localStorage.getItem('thebridge_current_user');
            if (storedUser) {
                const parsedUser = JSON.parse(storedUser);
                if (parsedUser && parsedUser.email) {
                    userEmail = parsedUser.email;
                    console.log('✅ Found user in localStorage:', userEmail);
                }
            }
        } catch (e) {
            console.log('⚠️ Error parsing stored user:', e);
        }
    }
    
    // Try to get team info
    if (window.currentTeam && window.currentTeam.id) {
        teamId = window.currentTeam.id;
        console.log('✅ Found team in window.currentTeam:', teamId);
    } else {
        // Try localStorage as fallback
        try {
            const storedTeam = localStorage.getItem('thebridge_current_team');
            if (storedTeam) {
                const parsedTeam = JSON.parse(storedTeam);
                if (parsedTeam && parsedTeam.id) {
                    teamId = parsedTeam.id;
                    console.log('✅ Found team in localStorage:', teamId);
                }
            }
        } catch (e) {
            console.log('⚠️ Error parsing stored team:', e);
        }
    }
    
    console.log('🎯 Using user info for loading:', { userEmail, teamId });
    
    try {
        // First, get list of available configurations
        console.log('Fetching available configurations...');
        
        const listResponse = await fetch(`${window.backendUrl}/api/dashboard/list?teamId=${teamId}&userEmail=${userEmail}`);
        
        if (!listResponse.ok) {
            throw new Error('Failed to fetch configurations list');
        }
        
        const listResult = await listResponse.json();
        console.log('Available configurations:', listResult);
        
        if (!listResult.success) {
            throw new Error(listResult.error || 'Failed to get configurations list');
        }
        
        if (!listResult.files || listResult.files.length === 0) {
            if (typeof showNotification === 'function') {
                showNotification('No saved configurations found. Save a configuration first!', 'warning');
            } else {
                alert('📁 No saved configurations found.\nUse "Save to Backend" to save a configuration first!');
            }
            return;
        }
        
        // Sort files by modification date (newest first)
        const sortedFiles = listResult.files.sort((a, b) => new Date(b.modified) - new Date(a.modified));
        
        // Load the most recent configuration
        const latestConfig = sortedFiles[0];
        console.log('Loading latest configuration:', latestConfig.filename);
        
        // Load the configuration
        const loadResponse = await fetch(`${window.backendUrl}/api/dashboard/load/${latestConfig.filename}?teamId=${teamId}&userEmail=${userEmail}`);
        
        if (!loadResponse.ok) {
            throw new Error('Failed to load configuration');
        }
        
        const loadResult = await loadResponse.json();
        console.log('Loaded configuration:', loadResult);
        
        if (!loadResult.success) {
            throw new Error(loadResult.error || 'Failed to load configuration');
        }
        
        const config = loadResult.config;
        
        // Apply the loaded configuration using the existing function
        console.log('Applying loaded configuration...');
        
        // Use the existing applyDashboardConfiguration function
        if (typeof window.applyDashboardConfiguration === 'function') {
            await window.applyDashboardConfiguration(config);
            
            // Asegurar que myFilters se guarda correctamente después de aplicar - SIMPLIFICADO
            if (config.filters) {
                localStorage.setItem('myFilters', JSON.stringify(config.filters));
                console.log('✅ MyFilters saved after applyDashboardConfiguration:', Object.keys(config.filters).length, 'filters');
                
                // Refrescar la UI igual que quickFilters
                if (typeof window.renderMyFiltersSection === 'function') {
                    window.renderMyFiltersSection();
                } else if (typeof renderMyFiltersSection === 'function') {
                    renderMyFiltersSection();
                }
            }
        } else {
            // Fallback: apply basic settings manually
            if (config.dashboard) {
                localStorage.setItem('dashboardConfig', JSON.stringify(config.dashboard));
                console.log('✅ Dashboard config applied');
            }
            
            // Aplicar filtros - SIMPLIFICADO igual que quickFilters
            if (config.filters) {
                localStorage.setItem('myFilters', JSON.stringify(config.filters));
                console.log('✅ MyFilters loaded from backend (fallback):', Object.keys(config.filters).length, 'filters');
                
                // Refrescar la UI igual que quickFilters
                if (typeof window.renderMyFiltersSection === 'function') {
                    window.renderMyFiltersSection();
                } else if (typeof renderMyFiltersSection === 'function') {
                    renderMyFiltersSection();
                }
            }
            
            if (config.quickFilters) {
                localStorage.setItem('quickFilters', JSON.stringify(config.quickFilters));
                console.log('✅ Quick filters applied');
                
                // Refrescar quick filters si existe la función
                if (typeof window.renderDashboardQuickFilters === 'function') {
                    window.renderDashboardQuickFilters();
                } else if (typeof renderDashboardQuickFilters === 'function') {
                    renderDashboardQuickFilters();
                }
            }
            
            if (config.tableViews) {
                localStorage.setItem('tableViews', JSON.stringify(config.tableViews));
                console.log('✅ Table views applied');
            }
            
            if (config.customSummaries) {
                localStorage.setItem('customSummaries', JSON.stringify(config.customSummaries));
                console.log('✅ Custom summaries applied');
            }
            
            if (config.favoritos) {
                localStorage.setItem('favoritos', JSON.stringify(config.favoritos));
                console.log('✅ Favoritos applied');
            }
            
            if (config.theme) {
                localStorage.setItem('theme', config.theme);
                console.log('✅ Theme applied');
            }
            
            if (config.language) {
                localStorage.setItem('language', config.language);
                console.log('✅ Language applied');
            }
        }
        
        // Show success notification
        if (typeof showNotification === 'function') {
            showNotification(`Configuration loaded successfully from ${latestConfig.filename}!`, 'success');
        } else {
            alert(`✅ Configuration loaded successfully from ${latestConfig.filename}!`);
        }
        
    } catch (error) {
        console.error('Error loading from backend:', error);
        if (typeof showNotification === 'function') {
            showNotification('Error loading from backend. Check if backend is available.', 'error');
        } else {
            alert('❌ Error loading from backend. Check if backend is available.');
        }
    }
}

// DEBUG: Make functions globally accessible for testing
window.executeSaveToBackend = executeSaveToBackend;
window.executeOpenBackendFolder = executeOpenBackendFolder;
window.executeLoadFromBackend = executeLoadFromBackend;

// Initialize backend configuration automatically
function initializeBackendConfig() {
    const hostname = window.location.hostname;
    const protocol = window.location.protocol;
    const port = window.location.port;
    
    console.log('🔍 Detecting environment:', { hostname, protocol, port });
    
    // Si estamos en localhost o 127.0.0.1 (cualquier puerto), usar backend local
    if (hostname === 'localhost' || hostname === '127.0.0.1' || protocol === 'file:') {
        // Desarrollo local
        window.backendUrl = 'http://localhost:3000';
        console.log('🔧 Modo desarrollo: usando backend local en puerto 3000');
    } else {
        // Producción (GitHub Pages, etc.)
        window.backendUrl = 'https://the-bridge-9g01.onrender.com';
        console.log('🚀 Modo producción: usando backend Render');
    }
    
    console.log('✅ Backend URL configurada:', window.backendUrl);
}

// Initialize backend config on page load
document.addEventListener('DOMContentLoaded', function() {
    console.log('🚀 DOM loaded, initializing backend config...');
    initializeBackendConfig();
});

// Also initialize immediately if DOM is already loaded
if (document.readyState === 'loading') {
    // DOM is still loading, wait for DOMContentLoaded
} else {
    // DOM is already loaded, initialize immediately
    console.log('🚀 DOM already loaded, initializing backend config immediately...');
    initializeBackendConfig();
}

// Backend status checker
async function checkBackendStatus() {
    console.log('🔍 Checking backend status...');
    
    if (!window.backendUrl) {
        initializeBackendConfig();
    }
    
    try {
        const response = await fetch(`${window.backendUrl}/health`, {
            method: 'GET',
            timeout: 3000
        });
        
        if (response.ok) {
            console.log('✅ Backend is running');
            return true;
        } else {
            console.log('⚠️ Backend responded but not healthy');
            return false;
        }
    } catch (error) {
        console.log('❌ Backend is not available:', error.message);
        return false;
    }
}

// Update UI based on backend status
async function updateBackendStatusUI() {
    const isBackendAvailable = await checkBackendStatus();
    
    const saveBtn = document.getElementById('saveDashboardConfigBtn');
    const loadBtn = document.getElementById('loadDashboardConfigBtn');
    const manageBtn = document.getElementById('manageDashboardConfigBtn');
    
    if (saveBtn) {
        if (isBackendAvailable) {
            saveBtn.style.opacity = '1';
            saveBtn.style.cursor = 'pointer';
            saveBtn.title = 'Save your configuration to backend';
        } else {
            saveBtn.style.opacity = '0.5';
            saveBtn.style.cursor = 'not-allowed';
            saveBtn.title = 'Backend not available. Start the backend server first.';
        }
    }
    
    if (loadBtn) {
        if (isBackendAvailable) {
            loadBtn.style.opacity = '1';
            loadBtn.style.cursor = 'pointer';
            loadBtn.title = 'Load your configuration from backend';
        } else {
            loadBtn.style.opacity = '0.5';
            loadBtn.style.cursor = 'not-allowed';
            loadBtn.title = 'Backend not available. Start the backend server first.';
        }
    }
    
    if (manageBtn) {
        if (isBackendAvailable) {
            manageBtn.style.opacity = '1';
            manageBtn.style.cursor = 'pointer';
            manageBtn.title = 'Open backend folder';
        } else {
            manageBtn.style.opacity = '0.5';
            manageBtn.style.cursor = 'not-allowed';
            manageBtn.title = 'Backend not available. Start the backend server first.';
        }
    }
    
    return isBackendAvailable;
}

// DEBUG: Test function
window.testDashboardButtons = function() {
    console.log('🧪 Testing dashboard buttons...');
    console.log('Save function:', typeof window.executeSaveToBackend);
    console.log('Open function:', typeof window.executeOpenBackendFolder);
    console.log('Load function:', typeof window.executeLoadFromBackend);
    
    // Test save function
    console.log('🧪 Testing save function...');
    window.executeSaveToBackend();
    
    // Test open function after 2 seconds
    setTimeout(() => {
        console.log('🧪 Testing open function...');
        window.executeOpenBackendFolder();
    }, 2000);
    
    // Test load function after 4 seconds
    setTimeout(() => {
        console.log('🧪 Testing load function...');
        window.executeLoadFromBackend();
    }, 4000);
};

// DEBUG: User info debugger
window.debugUserInfo = function() {
    console.log('🔍 USER DEBUG INFO:');
    console.log('===================');
    console.log('window.currentUser:', window.currentUser);
    console.log('window.currentTeam:', window.currentTeam);
    console.log('localStorage thebridge_current_user:', localStorage.getItem('thebridge_current_user'));
    console.log('localStorage thebridge_current_team:', localStorage.getItem('thebridge_current_team'));
    
    // Try to parse localStorage data
    try {
        const storedUser = localStorage.getItem('thebridge_current_user');
        if (storedUser) {
            console.log('Parsed localStorage user:', JSON.parse(storedUser));
        }
    } catch (e) {
        console.log('Error parsing stored user:', e);
    }
    
    try {
        const storedTeam = localStorage.getItem('thebridge_current_team');
        if (storedTeam) {
            console.log('Parsed localStorage team:', JSON.parse(storedTeam));
        }
    } catch (e) {
        console.log('Error parsing stored team:', e);
    }
    
    // Show all localStorage keys that might contain user data
    console.log('All localStorage keys:', Object.keys(localStorage));
    console.log('==================');
};

// TEST: Fix user info and update display
window.testUserInfo = function() {
    console.log('🔍 TESTING USER INFO:');
    console.log('===================');
    
    // Check window objects
    console.log('window.currentUser:', window.currentUser);
    console.log('window.currentTeam:', window.currentTeam);
    
    // Check localStorage
    const storedUser = localStorage.getItem('thebridge_current_user');
    const storedTeam = localStorage.getItem('thebridge_current_team');
    
    console.log('localStorage thebridge_current_user:', storedUser);
    console.log('localStorage thebridge_current_team:', storedTeam);
    
    if (storedUser) {
        try {
            const parsedUser = JSON.parse(storedUser);
            console.log('Parsed user:', parsedUser);
            
            // Update window.currentUser if it's not set
            if (!window.currentUser && parsedUser) {
                window.currentUser = parsedUser;
                console.log('✅ Updated window.currentUser from localStorage');
            }
        } catch (e) {
            console.log('❌ Error parsing user:', e);
        }
    }
    
    if (storedTeam) {
        try {
            const parsedTeam = JSON.parse(storedTeam);
            console.log('Parsed team:', parsedTeam);
            
            // Update window.currentTeam if it's not set
            if (!window.currentTeam && parsedTeam) {
                window.currentTeam = parsedTeam;
                console.log('✅ Updated window.currentTeam from localStorage');
            }
        } catch (e) {
            console.log('❌ Error parsing team:', e);
        }
    }
    
    // Update the user role display
    const userRole = document.getElementById('currentUserRole');
    if (userRole && window.currentUser) {
        const displayName = window.currentUser.name || window.currentUser.email || 'Usuario';
        userRole.textContent = displayName;
        console.log('✅ Updated user role display to:', displayName);
    }
    
    // Test function calls
    console.log('Testing functions:');
    console.log('  window.executeSaveToBackend:', typeof window.executeSaveToBackend);
    console.log('  window.executeOpenBackendFolder:', typeof window.executeOpenBackendFolder);
    
    return {
        currentUser: window.currentUser,
        currentTeam: window.currentTeam,
        localStorage: {
            user: storedUser,
            team: storedTeam
        }
    };
};

console.log('🧪 Test functions available:');
console.log('  window.testDashboardButtons() - Test both buttons');  
console.log('  window.executeSaveToBackend() - Test save function');
console.log('  window.executeOpenBackendFolder() - Test open function');
console.log('  window.debugUserInfo() - Debug user information');
console.log('  window.testUserInfo() - Test and fix user info display');

// IMMEDIATE BUTTON VERIFICATION
(function() {
    function verifyButtons() {
        const saveBtn = document.getElementById('saveDashboardConfigBtn');
        const manageBtn = document.getElementById('manageDashboardConfigBtn');
        
        console.log('✓ Button verification:', {
            saveBtn: !!saveBtn,
            manageBtn: !!manageBtn,
            executeSaveToBackend: typeof executeSaveToBackend === 'function',
            executeOpenBackendFolder: typeof executeOpenBackendFolder === 'function'
        });
        
        if (saveBtn && manageBtn) {
            console.log('✅ All buttons ready!');
        } else {
            console.log('⚠️ Some buttons not found, will retry...');
            setTimeout(verifyButtons, 200);
        }
    }
    
    // Start verification
    setTimeout(verifyButtons, 100);
})();
</script>

<script>
// ÚLTIMA FUNCIONALIDAD CSV - ÚLTIMO CSV Y RESUME SESSION
let lastCsvData = null;
// Usar la configuración global del backend
const CSV_SERVER_URL = window.backendConfig 
  ? window.backendConfig.getCsvBackendUrl()
  : 'http://localhost:3005';

// Función para obtener el último CSV del usuario
async function getLastCsvInfo() {
    try {
        // Obtener datos del usuario
        let userEmail = 'default@user.com';
        let teamId = 'default-team';
        
        // Intentar obtener información del usuario
        if (window.currentUser && window.currentUser.email) {
            userEmail = window.currentUser.email;
        } else {
            try {
                const storedUser = localStorage.getItem('thebridge_current_user');
                if (storedUser) {
                    const parsedUser = JSON.parse(storedUser);
                    if (parsedUser && parsedUser.email) {
                        userEmail = parsedUser.email;
                    }
                }
            } catch (e) {
                console.log('Error parsing stored user:', e);
            }
        }
        
        if (window.currentTeam && window.currentTeam.id) {
            teamId = window.currentTeam.id;
        } else {
            try {
                const storedTeam = localStorage.getItem('thebridge_current_team');
                if (storedTeam) {
                    const parsedTeam = JSON.parse(storedTeam);
                    if (parsedTeam && parsedTeam.id) {
                        teamId = parsedTeam.id;
                    }
                }
            } catch (e) {
                console.log('Error parsing stored team:', e);
            }
        }
        
        console.log('📊 Fetching last CSV for user:', userEmail, 'team:', teamId);
        
        // Hacer petición al endpoint
        const response = await fetch(`${CSV_SERVER_URL}/api/csv/last-upload?teamId=${teamId}&userEmail=${encodeURIComponent(userEmail)}`);
        
        if (!response.ok) {
            console.log('❌ CSV server not available');
            return null;
        }
        
        const data = await response.json();
        
        if (data.success && data.data.lastUpload) {
            lastCsvData = data.data.lastUpload;
            console.log('✅ Last CSV data:', lastCsvData);
            return lastCsvData;
        } else {
            console.log('📄 No previous CSV found');
            return null;
        }
        
    } catch (error) {
        console.log('❌ Error fetching last CSV:', error);
        return null;
    }
}

// Función para actualizar el indicador en la sidebar
function updateLastCsvIndicator(csvData) {
    const sidebarLastCsvInfo = document.getElementById('sidebarLastCsvInfo');
    const sidebarLastCsvText = document.getElementById('sidebarLastCsvText');
    
    if (!sidebarLastCsvInfo || !sidebarLastCsvText) return;
    
    if (csvData) {
        // Formatear fecha para mostrar
        const uploadDate = new Date(csvData.uploadDate);
        const now = new Date();
        const diffTime = now - uploadDate;
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        
        let timeText = '';
        if (diffDays <= 1) {
            timeText = 'Today';
        } else if (diffDays <= 7) {
            timeText = `${diffDays}d ago`;
        } else {
            timeText = uploadDate.toLocaleDateString('en-US', { 
                month: 'short', 
                day: 'numeric' 
            });
        }
        
        const fileName = csvData.fileName.length > 25 ? 
            csvData.fileName.substring(0, 22) + '...' : 
            csvData.fileName;
            
        sidebarLastCsvText.textContent = `${fileName} (${timeText})`;
        sidebarLastCsvInfo.style.display = 'block';
        sidebarLastCsvInfo.title = `Last uploaded: ${csvData.fileName}\nType: ${csvData.csvType}\nDate: ${uploadDate.toLocaleString()}\nSize: ${Math.round(csvData.size / 1024)}KB\n\nClick to resume session`;
        
        // Hacer clickeable para resumir sesión
        sidebarLastCsvInfo.style.cursor = 'pointer';
        sidebarLastCsvInfo.onclick = function() {
            resumeLastSession();
        };
        
        console.log('✅ Updated sidebar last CSV indicator:', fileName, timeText);
    } else {
        sidebarLastCsvInfo.style.display = 'none';
    }
}

// Función para abrir el último CSV (Resume Session)
async function resumeLastSession() {
    console.log('🔄 Resuming last session...');
    
    // Check if there's a persistent session available
    const persistentSession = loadPersistentSession();
    if (!persistentSession || !persistentSession.email) {
        console.log('❌ No persistent session available');
        if (typeof showNotification === 'function') {
            showNotification('No previous session found. Please log in first.', 'warning');
        } else {
            alert('No previous session found. Please log in first.');
        }
        return;
    }
    
    // Check if there's last CSV data as backup
    if (!lastCsvData) {
        console.log('⚠️ No last CSV data available, but session exists');
        // Still try to resume session even without CSV data
    }
    
    try {
        // Simular carga del archivo usando el nombre del archivo
        const fileName = lastCsvData.fileName;
        console.log('📊 Attempting to resume session with:', fileName);
        
        // Cerrar modal de bienvenida si está abierto
        const welcomeModal = document.getElementById('selectVersionModal');
        if (welcomeModal && !welcomeModal.classList.contains('hidden')) {
            welcomeModal.classList.add('hidden');
        }
        
        // Mostrar notificación de que se está cargando
        if (typeof showNotification === 'function') {
            showNotification(`Resuming session with ${fileName}...`, 'info');
        }
        
        // Crear un objeto File simulado con la información del CSV
        const csvContent = `Data from ${fileName}\nResuming session...`;
        const blob = new Blob([csvContent], { type: 'text/csv' });
        const file = new File([blob], fileName, { type: 'text/csv' });
        
        // Usar la función existente de carga de CSV si está disponible
        if (window.loadCSVFromFile) {
            window.loadCSVFromFile(file);
            console.log('✅ Resumed session with:', fileName);
        } else {
            // Fallback: usar el input file normal
            const csvFileInput = document.getElementById('csvFileInput');
            if (csvFileInput) {
                // Crear DataTransfer para simular la selección de archivo
                const dataTransfer = new DataTransfer();
                dataTransfer.items.add(file);
                csvFileInput.files = dataTransfer.files;
                
                // Disparar evento change
                csvFileInput.dispatchEvent(new Event('change', { bubbles: true }));
                console.log('✅ Resumed session using file input');
            }
        }
        
        // Mostrar notificación de éxito
        if (typeof showNotification === 'function') {
            showNotification(`Session resumed with ${fileName}`, 'success');
        }
        
    } catch (error) {
        console.error('❌ Error resuming session:', error);
        if (typeof showNotification === 'function') {
            showNotification('Failed to resume session. Please try uploading the CSV manually.', 'error');
        } else {
            alert('Failed to resume session. Please try uploading the CSV manually.');
        }
    }
}

// Función para verificar si el botón Resume Session debería estar habilitado
function updateResumeButtonState() {
    const resumeBtn = document.getElementById('resumeLastVersionBtn');
    if (!resumeBtn) return;
    
    // Check if there's a persistent session available
    const persistentSession = loadPersistentSession();
    const hasSession = persistentSession && persistentSession.email;
    
    // Check if there's last CSV data
    const hasCsvData = lastCsvData && lastCsvData.fileName;
    
    // Enable button if there's either a session or CSV data
    if (hasSession || hasCsvData) {
        resumeBtn.disabled = false;
        resumeBtn.style.opacity = '1';
        resumeBtn.style.cursor = 'pointer';
        console.log('✅ Resume Session button enabled');
    } else {
        resumeBtn.disabled = true;
        resumeBtn.style.opacity = '0.5';
        resumeBtn.style.cursor = 'not-allowed';
        console.log('❌ Resume Session button disabled - no session or CSV data');
    }
}

// Función para inicializar la funcionalidad del último CSV
async function initializeLastCsvFeature() {
    console.log('📊 Initializing last CSV feature...');
    
    // Obtener información del último CSV
    const csvData = await getLastCsvInfo();
    
    // Actualizar el indicador
    updateLastCsvIndicator(csvData);
    
    // Update resume button state
    updateResumeButtonState();
    
    // Configurar el botón Resume Session
    const resumeBtn = document.getElementById('resumeLastVersionBtn');
    if (resumeBtn) {
        resumeBtn.addEventListener('click', function(e) {
            e.preventDefault();
            console.log('🔄 Resume Session button clicked');
            
            // Use the main.js resumeLastSession function if available
            if (typeof window.resumeLastSession === 'function') {
                window.resumeLastSession();
            } else {
                // Fallback to local function
            resumeLastSession();
            }
        });
        console.log('✅ Resume Session button configured');
    }
    
    // El indicador en la sidebar ya es clickeable desde updateLastCsvIndicator
    console.log('✅ Sidebar CSV indicator will be clickeable when data is loaded');
    
    // Actualizar periódicamente (cada 5 minutos)
    setInterval(async function() {
        const csvData = await getLastCsvInfo();
        updateLastCsvIndicator(csvData);
    }, 5 * 60 * 1000); // 5 minutos
    
    console.log('✅ Last CSV feature initialized');
}

// Inicializar cuando se carga la página
document.addEventListener('DOMContentLoaded', function() {
    // Esperar un poco para que se cargue toda la página
    setTimeout(initializeLastCsvFeature, 2000);
});

// Función global para actualizar manualmente
window.updateLastCsvInfo = async function() {
    const csvData = await getLastCsvInfo();
    updateLastCsvIndicator(csvData);
    return csvData;
};

// Debug functions
window.testLastCsvFeature = function() {
    console.log('🧪 Testing last CSV feature...');
    console.log('Last CSV data:', lastCsvData);
    console.log('Functions available:', {
        getLastCsvInfo: typeof getLastCsvInfo,
        updateLastCsvIndicator: typeof updateLastCsvIndicator,
        resumeLastSession: typeof resumeLastSession
    });
    
    return {
        lastCsvData: lastCsvData,
        elements: {
            sidebarLastCsvInfo: !!document.getElementById('sidebarLastCsvInfo'),
            sidebarLastCsvText: !!document.getElementById('sidebarLastCsvText'),
            resumeBtn: !!document.getElementById('resumeLastVersionBtn')
        }
    };
};

console.log('📊 Last CSV feature functions available:');
console.log('  window.updateLastCsvInfo() - Update CSV info manually');
console.log('  window.testLastCsvFeature() - Test feature status');

// ===== SAVE/LOAD TO/FROM FOLDER FUNCTIONS =====

// Función para guardar configuración a archivo JSON
async function executeSaveToFolder() {
    console.log('💾 Executing Save to Folder...');
    
    try {
        // Obtener información del usuario y equipo
        let userEmail = 'default@user.com';
        let teamId = 'default-team';
        let userName = 'Default User';
        let teamName = 'Default Team';
        
        // Obtener información del usuario
        if (window.currentUser && window.currentUser.email) {
            userEmail = window.currentUser.email;
            userName = window.currentUser.name || 'User';
        } else {
            try {
                const storedUser = localStorage.getItem('thebridge_current_user');
                if (storedUser) {
                    const parsedUser = JSON.parse(storedUser);
                    if (parsedUser && parsedUser.email) {
                        userEmail = parsedUser.email;
                        userName = parsedUser.name || 'User';
                    }
                }
            } catch (e) {
                console.log('⚠️ Error parsing stored user:', e);
            }
        }
        
        // Obtener información del equipo
        if (window.currentTeam && window.currentTeam.id) {
            teamId = window.currentTeam.id;
            teamName = window.currentTeam.name || 'Team';
        } else {
            try {
                const storedTeam = localStorage.getItem('thebridge_current_team');
                if (storedTeam) {
                    const parsedTeam = JSON.parse(storedTeam);
                    if (parsedTeam && parsedTeam.id) {
                        teamId = parsedTeam.id;
                        teamName = parsedTeam.name || 'Team';
                    }
                }
            } catch (e) {
                console.log('⚠️ Error parsing stored team:', e);
            }
        }
        
        // Recopilar toda la configuración actual
        const config = {
            // Información del usuario y equipo
            userInfo: {
                email: userEmail,
                name: userName,
                teamId: teamId,
                teamName: teamName
            },
            
            // Configuración de equipos (todos los equipos del usuario)
            teams: JSON.parse(localStorage.getItem('thebridge_teams') || '[]'),
            currentTeam: JSON.parse(localStorage.getItem('thebridge_current_team') || '{}'),
            
            // Configuración de filtros
            filters: (() => {
                const myFilters = JSON.parse(localStorage.getItem('myFilters') || '{}');
                console.log('💾 Saving filters to JSON:', Object.keys(myFilters).length, 'filters');
                console.log('📋 Filter names being saved:', Object.keys(myFilters));
                // Verificar filtros de comparación
                const comparisonFilters = Object.entries(myFilters).filter(([name, obj]) => 
                    obj.fieldComparisons && Object.keys(obj.fieldComparisons).length > 0
                );
                if (comparisonFilters.length > 0) {
                    console.log('🔄 Saving comparison filters:', comparisonFilters.map(([name]) => name));
                }
                return myFilters;
            })(),
            quickFilters: JSON.parse(localStorage.getItem('quickFilters') || '{}'),
            
            // Configuración de vistas de tabla (usar la clave correcta)
            tableViews: JSON.parse(localStorage.getItem('tableViews') || '{}'),
            currentTableView: localStorage.getItem('thebridge_current_table_view'),
            
            // Configuración de columnas
            columnConfig: JSON.parse(localStorage.getItem('thebridge_column_config') || '{}'),
            visibleColumns: JSON.parse(localStorage.getItem('thebridge_visible_columns') || '[]'),
            columnOrder: JSON.parse(localStorage.getItem('thebridge_column_order') || '[]'),
            
            // Configuración de resúmenes personalizados (usar la clave correcta)
            customSummaries: JSON.parse(localStorage.getItem('customSummaries') || '{}'),
            
            // Favoritos
            favorites: JSON.parse(localStorage.getItem('thebridge_favorites') || '[]'),
            
            // Configuración de tema y idioma
            theme: localStorage.getItem('thebridge_theme') || 'dark',
            language: localStorage.getItem('thebridge_language') || 'es',
            
            // Configuración de auto-save
            autoSave: window.autoSaveEnabled !== undefined ? window.autoSaveEnabled : true,
            
            // Configuración de backend
            backendUrl: window.backendUrl || 'https://the-bridge-9g01.onrender.com',
            
            // Metadatos
            timestamp: new Date().toISOString(),
            version: '1.0',
            description: `Configuration exported from The Bridge for ${userName} (${userEmail}) in team ${teamName}`
        };
        
        // Crear nombre de archivo con timestamp
        const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
        const filename = `the-bridge-config-${userEmail}-${teamId}-${timestamp}.json`;
        
        // Crear blob y descargar
        const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        console.log('✅ Configuration saved to file:', filename);
        
        // Mostrar notificación de éxito
        if (typeof showNotification === 'function') {
            showNotification('Configuration saved to file successfully!', 'success');
        } else {
            alert('✅ Configuration saved to file successfully!');
        }
        
    } catch (error) {
        console.error('❌ Error saving to file:', error);
        if (typeof showNotification === 'function') {
            showNotification('Error saving configuration to file.', 'error');
        } else {
            alert('❌ Error saving configuration to file.');
        }
    }
}

// Función para cargar configuración desde archivo JSON
async function executeLoadFromFolder() {
    console.log('📂 Executing Load from Folder...');
    
    try {
        // Crear input file oculto
        const fileInput = document.createElement('input');
        fileInput.type = 'file';
        fileInput.accept = '.json';
        fileInput.style.display = 'none';
        
        // Manejar la selección de archivo
        fileInput.onchange = async (event) => {
            const file = event.target.files[0];
            if (!file) return;
            
            try {
                // Leer el archivo
                const text = await file.text();
                const config = JSON.parse(text);
                
                console.log('📂 Loading configuration from file:', file.name);
                
                // Validar que es un archivo de configuración válido (más flexible)
                // Aceptar archivos con userInfo O con filters directamente (formato antiguo)
                if (!config.userInfo && !config.filters && !config.filtros && !config.filtrosGuardados) {
                    console.warn('⚠️ File may not be a valid configuration file, but attempting to load anyway');
                    // No lanzar error, intentar cargar de todas formas
                }
                
                // Aplicar la configuración
                await applyConfigurationFromFile(config);
                
                // Mostrar notificación de éxito
                if (typeof showNotification === 'function') {
                    showNotification('Configuration loaded from file successfully!', 'success');
                } else {
                    alert('✅ Configuration loaded from file successfully!');
                }
                
            } catch (error) {
                console.error('❌ Error loading from file:', error);
                if (typeof showNotification === 'function') {
                    showNotification('Error loading configuration from file. Invalid format.', 'error');
                } else {
                    alert('❌ Error loading configuration from file. Invalid format.');
                }
            }
            
            // Limpiar el input
            document.body.removeChild(fileInput);
        };
        
        // Agregar al DOM y hacer click
        document.body.appendChild(fileInput);
        fileInput.click();
        
    } catch (error) {
        console.error('❌ Error setting up file input:', error);
        if (typeof showNotification === 'function') {
            showNotification('Error setting up file selection.', 'error');
        } else {
            alert('❌ Error setting up file selection.');
        }
    }
}

// Función para aplicar configuración desde archivo
async function applyConfigurationFromFile(config) {
    console.log('🔄 Applying configuration from file...');
    
    try {
        // Aplicar configuración de filtros - SIMPLIFICADO igual que quickFilters
        if (config.filters) {
            localStorage.setItem('myFilters', JSON.stringify(config.filters));
            console.log('✅ MyFilters loaded from JSON:', Object.keys(config.filters).length, 'filters');
            
            // Refrescar la UI igual que quickFilters
            if (typeof window.renderMyFiltersSection === 'function') {
                window.renderMyFiltersSection();
            } else if (typeof renderMyFiltersSection === 'function') {
                renderMyFiltersSection();
            }
        }
        
        if (config.quickFilters) {
            localStorage.setItem('quickFilters', JSON.stringify(config.quickFilters));
            // Intentar refrescar quick filters si existe la función
            if (typeof window.renderDashboardQuickFilters === 'function') {
                window.renderDashboardQuickFilters();
            } else if (typeof renderDashboardQuickFilters === 'function') {
                renderDashboardQuickFilters();
            }
        }
        
        // Aplicar configuración de vistas de tabla
        if (config.tableViews) {
            localStorage.setItem('thebridge_table_views', JSON.stringify(config.tableViews));
        }
        
        if (config.currentTableView) {
            localStorage.setItem('thebridge_current_table_view', config.currentTableView);
        }
        
        // Aplicar configuración de columnas
        if (config.columnConfig) {
            localStorage.setItem('thebridge_column_config', JSON.stringify(config.columnConfig));
        }
        
        if (config.visibleColumns) {
            localStorage.setItem('thebridge_visible_columns', JSON.stringify(config.visibleColumns));
        }
        
        if (config.columnOrder) {
            localStorage.setItem('thebridge_column_order', JSON.stringify(config.columnOrder));
        }
        
        // Aplicar configuración de resúmenes personalizados
        if (config.customSummaries) {
            localStorage.setItem('thebridge_custom_summaries', JSON.stringify(config.customSummaries));
        }
        
        // Aplicar favoritos
        if (config.favorites) {
            localStorage.setItem('thebridge_favorites', JSON.stringify(config.favorites));
        }
        
        // Aplicar configuración de tema y idioma
        if (config.theme) {
            localStorage.setItem('thebridge_theme', config.theme);
        }
        
        if (config.language) {
            localStorage.setItem('thebridge_language', config.language);
        }
        
        // Aplicar configuración de auto-save
        if (config.autoSave !== undefined) {
            window.autoSaveEnabled = config.autoSave;
            if (typeof window.toggleAutoSave === 'function') {
                window.toggleAutoSave(config.autoSave);
            }
        }
        
        // Aplicar configuración de backend
        if (config.backendUrl) {
            window.backendUrl = config.backendUrl;
        }
        
        // Guardar un flag para indicar que se acaban de cargar filtros
        // Esto permitirá que después de recargar, se rendericen automáticamente
        if (config.filters && Object.keys(config.filters).length > 0) {
            localStorage.setItem('filtersJustLoaded', 'true');
            console.log('📋 Filters loaded, flag set for post-reload rendering');
            console.log('📋 Filters saved before reload:', Object.keys(config.filters).length);
        }
        console.log('🔄 Configuration applied, reloading page...');
        setTimeout(() => {
            window.location.reload();
        }, 1000);
        
    } catch (error) {
        console.error('❌ Error applying configuration:', error);
        throw error;
    }
}

// Make folder functions available globally
window.executeSaveToFolder = executeSaveToFolder;
window.executeLoadFromFolder = executeLoadFromFolder;
</script>

<!-- ===== FIX FILES ===== -->
<!-- Fix for offline mode and backend detection - DISABLED -->
<!-- <script src="fix-offline-mode.js"></script> -->

<!-- Fix for user registration backend -->
<script src="fix-user-registration.js"></script>

<!-- Fix for user backend save -->
<script src="fix-user-backend-save.js"></script>

<!-- Direct user save to backend -->
<script src="direct-user-save.js"></script>

<!-- Fix infinite loop -->
<!-- Fix for infinite loop prevention - REMOVED DUE TO LOOP ISSUES -->
<!-- Simple loop prevention - FILE DELETED -->

<!-- Remove problematic intervals -->
<script src="fix-remove-problematic-intervals.js"></script>

<!-- Fix folder buttons and guest access -->
<script src="fix-folder-buttons-and-guest-access.js"></script>

<!-- Fix backend settings button - FILE DELETED -->

<!-- Fix dashboard folder buttons -->
<script src="fix-dashboard-folder-buttons.js"></script>

<!-- Fix hide guest access button -->
<script src="fix-hide-guest-access-button.js"></script>

              <!-- Fix load without reload and guest login -->
              <script src="fix-load-without-reload-and-guest-login.js"></script>
              
              <!-- OneDrive Integration with Custom Paths -->
              <script src="onedrive-custom-path-integration.js"></script>
              
                  <!-- OneDrive Configuration Modal -->
    <script src="onedrive-configuration-modal.js"></script>
    <!-- OneDrive Configuration Functions -->
    <script src="onedrive-configuration-functions.js"></script>
              
                  <!-- Azure AD Authentication - REMOVED -->
    <!-- <script src="azure-ad-authentication.js"></script> -->
              
              <!-- OneDrive Registration System -->
              <script src="onedrive-registration-system.js"></script>
              
              <!-- Integrate OneDrive with Registration -->
              <!-- TEMPORARILY DISABLED: <script src="integrate-onedrive-with-registration.js"></script> -->
              
              <!-- Fix Activate OneDrive Registration -->
              <!-- TEMPORARILY DISABLED: <script src="fix-activate-onedrive-registration.js"></script> -->
              
              <!-- Force OneDrive Config Button -->
              <!-- TEMPORARILY DISABLED: <script src="force-onedrive-config-button.js"></script> -->
              
              <!-- Fix Backend Status OneDrive -->
              <script src="fix-backend-status-onedrive.js"></script>
              
              <!-- Restart backend -->
<script src="restart-backend.js"></script>

<!-- Local user system -->
<script src="local-user-system.js"></script>

<!-- Fix for all buttons -->
<script src="fix-buttons.js"></script>

<!-- Fix for auto-load configurations -->
<script src="auto-load-config.js"></script>

<!-- Fix for guest user setup access -->
<script src="fix-guest-user-setup.js"></script>

<!-- Fix for registration backend URL -->
<script src="fix-registration-backend-url.js"></script>

<script src="fix-onedrive-consent-error.js"></script>

<script src="fix-onedrive-path-consistency.js"></script>

<!-- Integrate Azure AD into OneDrive modal - FILE DELETED -->



<style>
/* Auto-save indicator styles */
.auto-save-on {
  background: rgba(76, 175, 80, 0.2) !important;
  color: #4CAF50 !important;
  border: 1px solid rgba(76, 175, 80, 0.3) !important;
}

.auto-save-off {
  background: rgba(158, 158, 158, 0.2) !important;
  color: #9E9E9E !important;
  border: 1px solid rgba(158, 158, 158, 0.3) !important;
}

.auto-save-saving {
  background: rgba(255, 193, 7, 0.2) !important;
  color: #FFC107 !important;
  border: 1px solid rgba(255, 193, 7, 0.3) !important;
  animation: pulse 1.5s infinite;
}

@keyframes pulse {
  0% { opacity: 1; }
  50% { opacity: 0.7; }
  100% { opacity: 1; }
}

/* ULTIMATE LOGO OVERRIDE - HIGHEST PRIORITY */
img[src*="LOGOTAB_rounded.png"],
.modal-logo,
.modal-header img,
.modal-header .modal-logo,
#opsSummaryModal .modal-header .modal-logo,
#dqSummaryModal .modal-header .modal-logo,
#comparisonResultsModal .modal-header .modal-logo,
#opsDashboardModal .modal-header .modal-logo,
#dqDashboardModal .modal-header .modal-logo {
  border-radius: 8px !important;
  border-radius: 8px !important;
  border-radius: 8px !important;
  border-radius: 8px !important;
}

/* ========================================
   FORZAR ESTILOS UNIFICADOS EN TODOS LOS BOTONES DE SIDEBAR
   MÁXIMA PRIORIDAD - SE APLICA DESPUÉS DE TODO
   ======================================== */
html body .sidebar .sidebar-button,
html body .sidebar button.sidebar-button,
html body .sidebar label.sidebar-button,
html body .sidebar #toggleFiltersBtn,
html body .sidebar #dashboardToggleBtn,
html body .sidebar #dqDashboardToggleBtn,
html body .sidebar #columnsBtn,
html body .sidebar #generateReportBtn,
html body .sidebar #dataVersionBtn,
html body .sidebar #compareCSVBtn,
html body .sidebar #openCustomSummaryBtn,
html body .sidebar #showDuplicatesBtn,
html body .sidebar label[for="csvFileInput"],
html body .sidebar label.sidebar-button[for="csvFileInput"],
html body .sidebar #uploadCsvFileBtn,
html body .sidebar #userSetUpBtn,
html body .sidebar #teamManagementBtn {
  background: rgba(255, 255, 255, 0.3) !important;
  background-color: rgba(255, 255, 255, 0.3) !important;
  color: #000000 !important;
  border: 1px solid rgba(0, 0, 0, 0.1) !important;
  border-radius: 6px !important;
  padding: 0.5rem 0.75rem !important;
  display: flex !important;
  align-items: center !important;
  gap: 0.5rem !important;
  width: 100% !important;
  font-size: 0.9rem !important;
  font-weight: 500 !important;
  font-family: 'Roboto', 'Segoe UI', Arial, sans-serif !important;
  text-align: left !important;
  margin-bottom: 0.2rem !important;
  box-shadow: none !important;
  opacity: 1 !important;
}

/* Asegurar que todos los botones de toolbar también usen Roboto */
html body .toolbar-button,
html body .toolbar .toolbar-button,
html body button.toolbar-button {
  font-family: 'Roboto', 'Segoe UI', Arial, sans-serif !important;
}

html body .sidebar .sidebar-button:hover,
html body .sidebar button.sidebar-button:hover,
html body .sidebar label.sidebar-button:hover,
html body .sidebar #toggleFiltersBtn:hover,
html body .sidebar #dashboardToggleBtn:hover,
html body .sidebar #dqDashboardToggleBtn:hover,
html body .sidebar #columnsBtn:hover,
html body .sidebar #generateReportBtn:hover,
html body .sidebar #dataVersionBtn:hover,
html body .sidebar #compareCSVBtn:hover,
html body .sidebar #openCustomSummaryBtn:hover,
html body .sidebar #showDuplicatesBtn:hover,
html body .sidebar label[for="csvFileInput"]:hover,
html body .sidebar label.sidebar-button[for="csvFileInput"]:hover,
html body .sidebar #uploadCsvFileBtn:hover,
html body .sidebar #userSetUpBtn:hover,
html body .sidebar #teamManagementBtn:hover {
  background: rgba(255, 255, 255, 0.5) !important;
  background-color: rgba(255, 255, 255, 0.5) !important;
  border-color: rgba(0, 0, 0, 0.2) !important;
  transform: translateY(-1px) !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
  color: #000000 !important;
  opacity: 1 !important;
}

html body .sidebar .sidebar-button svg,
html body .sidebar button.sidebar-button svg,
html body .sidebar label.sidebar-button svg,
html body .sidebar #toggleFiltersBtn svg,
html body .sidebar #dashboardToggleBtn svg,
html body .sidebar #dqDashboardToggleBtn svg,
html body .sidebar #columnsBtn svg,
html body .sidebar #generateReportBtn svg,
html body .sidebar #dataVersionBtn svg,
html body .sidebar #compareCSVBtn svg,
html body .sidebar #openCustomSummaryBtn svg,
html body .sidebar #showDuplicatesBtn svg,
html body .sidebar label[for="csvFileInput"] svg,
html body .sidebar #uploadCsvFileBtn svg,
html body .sidebar #userSetUpBtn svg,
html body .sidebar #teamManagementBtn svg {
  width: 1.2em !important;
  height: 1.2em !important;
  min-width: 1.2em !important;
  min-height: 1.2em !important;
  max-width: 1.2em !important;
  max-height: 1.2em !important;
  fill: #000000 !important;
  color: #000000 !important;
  flex-shrink: 0 !important;
}

/* ========================================
   ALINEACIÓN DE TÍTULOS DE COLUMNA AL REDIMENSIONAR
   ======================================== */
.data-table th,
.data-table th[style*="width"],
.data-table th[style*="min-width"] {
  text-align: left !important;
}

.data-table th > span,
.data-table th > *:not(.column-resize-handle):not(.excel-filter-icon):not(.hide-column-x-btn) {
  text-align: left !important;
  display: inline-block !important;
  vertical-align: middle !important;
}

/* ========================================
   BORDER-RADIUS PARA TODOS LOS DESPLEGABLES
   ======================================== */
html body select,
html body select[class],
html body select[id],
html body .toolbar-select,
html body .toolbar-select[style],
html body #rowsPerPageSelect,
html body #rowsPerPageSelect[style],
html body #viewSelect,
html body #viewSelect[style],
html body .view-controls select,
html body .rows-per-page-control select,
html body .table-toolbar select,
html body .toolbar-left select,
html body #dedupeColumnsSelect,
html body .dedupe-columns-select,
html body select[id*="team"],
html body select[id*="Team"],
html body #teamLoginSelect,
html body #teamStorageLocationSelect,
html body .team-select,
html body .filter-select,
html body .choices,
html body .choices__inner {
  border-radius: 6px !important;
}

/* ========================================
   FIX SCROLL HORIZONTAL EN DROPDOWNS DE FILTROS
   ======================================== */
.excel-filter-dropdown,
.excel-filter-options,
.excel-filter-dropdown .excel-filter-options {
  overflow-x: hidden !important;
  word-wrap: break-word !important;
  overflow-wrap: break-word !important;
}

.excel-filter-dropdown label,
.excel-filter-options label,
.excel-filter-dropdown .excel-filter-options label {
  word-wrap: break-word !important;
  overflow-wrap: break-word !important;
  white-space: normal !important;
  min-width: 0 !important;
  flex: 1 !important;
}

.excel-filter-dropdown label span,
.excel-filter-options label span,
.excel-filter-dropdown .excel-filter-options label span {
  word-wrap: break-word !important;
  overflow-wrap: break-word !important;
  white-space: normal !important;
  min-width: 0 !important;
  flex: 1 !important;
  display: inline-block !important;
}

/* ========================================
   MEJORAS AL TÍTULO "THE BRIDGE"
   ======================================== */
.thebridge-title {
  font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif !important;
  font-weight: 400 !important;
  font-size: 1.8em !important;
  letter-spacing: 0.03em !important;
  color: #15364A !important;
  text-shadow: none !important;
  text-transform: none !important;
  margin-left: 0.5rem !important;
  position: relative !important;
  display: inline-block !important;
  transition: color 0.3s ease !important;
}

.toolbar-logo:hover .thebridge-title {
  color: #1976D2 !important;
}

/* Ocultar botón Create Team */
#teamManagementBtn {
  display: none !important;
  visibility: hidden !important;
}

/* Ocultar botón Copy Summary */
#copySummaryBtnToolbar {
  display: none !important;
  visibility: hidden !important;
}

/* Ocultar botón de filtro de duplicados en encabezados de columna */
.data-table th button[title="Filter by duplicate columns"],
.data-table th button[title*="duplicate columns"] {
  display: none !important;
  visibility: hidden !important;
}

/* Scrollbars de la tabla más anchos */
#tableContainer::-webkit-scrollbar,
.table-scroll-container::-webkit-scrollbar {
  width: 18px !important;
  height: 18px !important;
}

/* Iconos interactivos del sidebar - animación al hover */
.sidebar-button:hover svg {
  transform: scale(1.1) !important;
}

.sidebar-button:active svg {
  transform: scale(0.95) !important;
}

/* Asegurar que los iconos sean opacos y profesionales */
.sidebar-button svg {
  background: #ffffff !important;
  background-color: #ffffff !important;
  border: none !important;
  outline: none !important;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.08) !important;
  padding: 2px !important;
  margin: 0 !important;
  border-radius: 3px !important;
  opacity: 1 !important;
  display: inline-block !important;
  box-sizing: content-box !important;
  flex-shrink: 0 !important;
  position: relative !important;
}

/* Forzar opacidad en los paths y strokes de los SVG */
.sidebar-button svg path,
.sidebar-button svg rect,
.sidebar-button svg circle,
.sidebar-button svg polyline,
.sidebar-button svg line {
  fill-opacity: 1 !important;
  stroke-opacity: 1 !important;
  opacity: 1 !important;
}

/* Efectos hover mejorados para los botones especiales */
#dataQualityBtn:hover,
#bookingDashboardToggleBtn:hover,
#ordersHubBtn:hover {
  transform: translateY(-1px) !important;
}

#dataQualityBtn:hover {
  background: rgba(139, 92, 246, 0.25) !important;
  background-color: rgba(139, 92, 246, 0.25) !important;
  box-shadow: 0 4px 8px rgba(139, 92, 246, 0.2) !important;
}

#bookingDashboardToggleBtn:hover {
  background: rgba(245, 158, 11, 0.25) !important;
  background-color: rgba(245, 158, 11, 0.25) !important;
  box-shadow: 0 4px 8px rgba(245, 158, 11, 0.2) !important;
}

#ordersHubBtn:hover {
  background: rgba(16, 185, 129, 0.25) !important;
  background-color: rgba(16, 185, 129, 0.25) !important;
  box-shadow: 0 4px 8px rgba(16, 185, 129, 0.2) !important;
}

/* Estilos para títulos de modales - igual que The Bridge */
.dashboard-title,
.panel-header-title.dashboard-title,
#dqDashboardModal .dashboard-title,
#ordersDashboardModal .dashboard-title,
#bookingDashboardModal .dashboard-title,
#opsSummaryModal .dashboard-title,
#bookingSummaryModal .dashboard-title,
#dqSummaryModal .dashboard-title,
#ordersSummaryModal .dashboard-title,
#csvComparisonModal .dashboard-title,
#comparisonResultsModal .dashboard-title,
#columnManagerModal .dashboard-title,
#savedViewsModal .dashboard-title,
#reportGenerationModal .dashboard-title,
#legalNoticeModal .dashboard-title,
#selectVersionModal .dashboard-title,
#userSetUpModal .dashboard-title,
#filterModal .dashboard-title,
#filterModal .modal-header h2.dashboard-title,
#filterModal h2.dashboard-title {
  font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif !important;
  font-weight: 400 !important;
  letter-spacing: 0.03em !important;
  color: #15364A !important;
  text-shadow: none !important;
  text-transform: none !important;
  position: relative !important;
  display: inline-block !important;
  transition: color 0.3s ease !important;
  font-size: 1.5rem !important;
}

.dashboard-title::after,
.panel-header-title.dashboard-title::after,
#dqDashboardModal .dashboard-title::after,
#ordersDashboardModal .dashboard-title::after,
#bookingDashboardModal .dashboard-title::after,
#opsSummaryModal .dashboard-title::after,
#bookingSummaryModal .dashboard-title::after,
#dqSummaryModal .dashboard-title::after,
#ordersSummaryModal .dashboard-title::after,
#csvComparisonModal .dashboard-title::after,
#comparisonResultsModal .dashboard-title::after,
#columnManagerModal .dashboard-title::after,
#savedViewsModal .dashboard-title::after,
#reportGenerationModal .dashboard-title::after,
#legalNoticeModal .dashboard-title::after,
#selectVersionModal .dashboard-title::after,
#userSetUpModal .dashboard-title::after,
#filterModal .dashboard-title::after,
#filterModal .modal-header h2.dashboard-title::after,
#filterModal h2.dashboard-title::after {
  content: '' !important;
  position: absolute !important;
  bottom: -2px !important;
  left: 0 !important;
  width: 100% !important;
  height: 2px !important;
  background: linear-gradient(90deg, transparent 0%, #47B2E5 50%, transparent 100%) !important;
  opacity: 0.3 !important;
  transition: opacity 0.3s ease !important;
}

</style>

  <!-- Script para conectar los nuevos botones Data Quality y Orders Hub con sus modales -->
  <script>
    function setupNewSidebarButtons() {
      // Conectar Data Quality button con DQ Hub Manager
      const dataQualityBtn = document.getElementById('dataQualityBtn');
      if (dataQualityBtn && !dataQualityBtn.hasAttribute('data-listener-added')) {
        dataQualityBtn.setAttribute('data-listener-added', 'true');
        dataQualityBtn.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          if (window.dqHubManager && typeof window.dqHubManager.toggleDqDashboard === 'function') {
            window.dqHubManager.toggleDqDashboard();
          } else {
            // Fallback: buscar el botón original y hacer click
            const originalBtn = document.getElementById('dqDashboardToggleBtn');
            if (originalBtn) {
              originalBtn.click();
            }
          }
        });
      }

      // Conectar Orders Hub button con Orders Hub Manager
      const ordersHubBtn = document.getElementById('ordersHubBtn');
      if (ordersHubBtn && !ordersHubBtn.hasAttribute('data-listener-added')) {
        ordersHubBtn.setAttribute('data-listener-added', 'true');
        ordersHubBtn.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          if (window.ordersHubManager && typeof window.ordersHubManager.toggleOrdersDashboard === 'function') {
            window.ordersHubManager.toggleOrdersDashboard();
          } else {
            // Fallback: buscar el botón original y hacer click
            const originalBtn = document.getElementById('ordersDashboardToggleBtn');
            if (originalBtn) {
              originalBtn.click();
            }
          }
        });
      }
    }

    // Ejecutar cuando el DOM esté listo
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        setTimeout(setupNewSidebarButtons, 500);
        setTimeout(setupNewSidebarButtons, 1000);
        setTimeout(setupNewSidebarButtons, 2000);
      });
    } else {
      setTimeout(setupNewSidebarButtons, 500);
      setTimeout(setupNewSidebarButtons, 1000);
      setTimeout(setupNewSidebarButtons, 2000);
    }

    // También intentar periódicamente para asegurar que los managers estén cargados
    setInterval(setupNewSidebarButtons, 1000);
  </script>

  <!-- Script para ocultar botones Operations Hub y Ops Hub Manager del sidebar -->
  <script>
    function hideOpsHubButtons() {
      // Buscar botones por ID
      const opsDashboardToggleBtn = document.getElementById('opsDashboardToggleBtn');
      if (opsDashboardToggleBtn) {
        opsDashboardToggleBtn.style.display = 'none';
        opsDashboardToggleBtn.style.visibility = 'hidden';
        opsDashboardToggleBtn.style.opacity = '0';
        opsDashboardToggleBtn.style.width = '0';
        opsDashboardToggleBtn.style.height = '0';
        opsDashboardToggleBtn.style.padding = '0';
        opsDashboardToggleBtn.style.margin = '0';
        opsDashboardToggleBtn.style.position = 'absolute';
        opsDashboardToggleBtn.style.left = '-9999px';
      }
      
      // Buscar botones por texto en el sidebar
      const sidebarButtons = document.querySelectorAll('.sidebar button, .sidebar-scrollable button');
      sidebarButtons.forEach(button => {
        const text = button.textContent || button.innerText || '';
        if (text.includes('Operations Hub') || text.includes('Ops Hub Manager')) {
          button.style.display = 'none';
          button.style.visibility = 'hidden';
          button.style.opacity = '0';
          button.style.width = '0';
          button.style.height = '0';
          button.style.padding = '0';
          button.style.margin = '0';
          button.style.position = 'absolute';
          button.style.left = '-9999px';
        }
      });
    }
    
    // Ejecutar cuando el DOM esté listo
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', hideOpsHubButtons);
    } else {
      hideOpsHubButtons();
    }
    
    // Ejecutar periódicamente para capturar botones creados dinámicamente
    setInterval(hideOpsHubButtons, 500);
    
    // Observar cambios en el DOM
    const observer = new MutationObserver(() => {
      hideOpsHubButtons();
    });
    
    observer.observe(document.body, {
      childList: true,
      subtree: true
    });
  </script>

  <!-- Script para el botón Reset Filters en el sidebar -->
  <script>
    (function() {
      function setupResetFiltersButton() {
        const resetFiltersBtn = document.getElementById('resetFiltersSidebarBtn');
        if (resetFiltersBtn && !resetFiltersBtn.hasAttribute('data-listener-added')) {
          resetFiltersBtn.setAttribute('data-listener-added', 'true');
          resetFiltersBtn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            // Resetear todos los filtros - mismo comportamiento que el botón del modal
            try {
              // Resetear filtros del modal de filtros
              if (typeof resetFilterManager === 'function') {
                resetFilterManager();
              }
              
              // Regenerar el sidebar de filtros
              if (typeof generateFilterSidebar === 'function' && typeof getCurrentHeaders === 'function') {
                generateFilterSidebar(getCurrentHeaders());
              } else if (typeof window.generateFilterSidebar === 'function' && typeof window.getCurrentHeaders === 'function') {
                window.generateFilterSidebar(window.getCurrentHeaders());
              }
              
              // Mostrar notificación (igual que el modal)
              if (typeof window.showUnifiedNotification === 'function') {
                window.showUnifiedNotification('All filters cleared!', 'info');
              }
              
              // Actualizar la tabla después de resetear los filtros (igual que el modal)
              if (typeof getOriginalData === 'function') {
                const data = getOriginalData();
                if (data && typeof displayTable === 'function') {
                  displayTable(data);
                } else if (data && typeof window.displayTable === 'function') {
                  window.displayTable(data);
                }
              } else if (typeof window.getOriginalData === 'function') {
                const data = window.getOriginalData();
                if (data && typeof window.displayTable === 'function') {
                  window.displayTable(data);
                }
              }
              
              console.log('✅ All filters reset successfully');
            } catch (error) {
              console.error('Error resetting filters:', error);
              if (typeof window.showUnifiedNotification === 'function') {
                window.showUnifiedNotification('Error resetting filters. Please try again.', 'error');
              }
            }
          });
          
          // Efecto hover para el icono
          resetFiltersBtn.addEventListener('mouseenter', function() {
            const svg = resetFiltersBtn.querySelector('svg');
            if (svg) {
              svg.style.transform = 'rotate(180deg)';
            }
          });
          resetFiltersBtn.addEventListener('mouseleave', function() {
            const svg = resetFiltersBtn.querySelector('svg');
            if (svg) {
              svg.style.transform = 'rotate(0deg)';
            }
          });
        }
      }
      
      // Intentar configurar inmediatamente
      setupResetFiltersButton();
      
      // Retry si el botón aún no existe
      if (!document.getElementById('resetFiltersSidebarBtn')) {
        const intervalId = setInterval(() => {
          if (document.getElementById('resetFiltersSidebarBtn')) {
            setupResetFiltersButton();
            clearInterval(intervalId);
          }
        }, 500);
      }
      
      // También intentar cuando el DOM esté listo
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', setupResetFiltersButton);
      } else {
        setupResetFiltersButton();
      }
    })();
  </script>

  <!-- Script para asegurar que el botón Data Comparison funcione -->
  <script>
    (function() {
      let csvComparisonInstance = null;
      
      function setupDataComparisonButton() {
        const compareCSVBtn = document.getElementById('compareCSVBtn');
        if (!compareCSVBtn) {
          console.log('Data Comparison button not found yet');
          return false;
        }
        
        if (compareCSVBtn.hasAttribute('data-listener-added')) {
          console.log('Data Comparison button listener already added');
          return true;
        }
        
        compareCSVBtn.setAttribute('data-listener-added', 'true');
        compareCSVBtn.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          console.log('Data Comparison button clicked');
          
          // Esperar a que CSVComparison esté disponible
          let retryCount = 0;
          const maxRetries = 50; // 5 segundos máximo
          
          function tryOpenModal() {
            if (typeof window.CSVComparison !== 'undefined' || typeof CSVComparison !== 'undefined') {
              try {
                const CSVClass = window.CSVComparison || CSVComparison;
                if (!csvComparisonInstance) {
                  csvComparisonInstance = new CSVClass();
                  console.log('CSVComparison instance created');
                }
                // Usar showModal() para asegurar que todo esté correctamente inicializado
                csvComparisonInstance.showModal();
                console.log('Data Comparison modal opened');
              } catch (error) {
                console.error('Error creating/opening CSVComparison:', error);
                alert('Error opening Data Comparison. Please check the console for details.');
              }
            } else {
              retryCount++;
              if (retryCount < maxRetries) {
                console.log(`CSVComparison class not available yet, retrying... (${retryCount}/${maxRetries})`);
                setTimeout(tryOpenModal, 100);
              } else {
                console.error('CSVComparison class not available after maximum retries');
                alert('Data Comparison module failed to load. Please refresh the page and try again.');
              }
            }
          }
          
          tryOpenModal();
        });
        console.log('Data Comparison button listener added.');
        return true;
      }

      // Función para intentar configurar cuando todo esté listo
      function attemptSetup() {
        if (setupDataComparisonButton()) {
          return true;
        }
        return false;
      }

      // Intentar configurar cuando el DOM esté listo
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
          setTimeout(attemptSetup, 100);
        });
      } else {
        setTimeout(attemptSetup, 100);
      }

      // Retry si el botón aún no existe
      let retryCount = 0;
      const maxRetries = 20; // 10 segundos máximo
      const retryInterval = setInterval(() => {
        if (attemptSetup() || retryCount >= maxRetries) {
          clearInterval(retryInterval);
        }
        retryCount++;
      }, 500);
    })();
  </script>

  </body>
  </html>
